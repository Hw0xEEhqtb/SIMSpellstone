!function(){var r={};window.define=function(e,t,a){var n=t.map(function(e){return r[e]});r[e]=a.apply(this,n)},window.require=function(e){var t=r[e];if(t)return t;throw"Module '"+e+"' is not defined yet."}}(),"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var a=arguments[t];if(null!=a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}),Function.prototype.debounce=function(a){var n,r=this;return function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){n=null,r.apply(e,t)},a)}},Function.prototype.throttle=function(a){var n,r=this;return function(){var e=this,t=arguments;if(!n){r.apply(e,t);n=setTimeout(function(){n=null,r.apply(e,t)},a)}}},define("factions",[],function(){return{names:{0:"Factionless",1:"Aether",2:"Chaos",3:"Wyld",4:"Frog",5:"Elemental",6:"Angel",7:"Undead",8:"Void",9:"Dragon",10:"Avian",11:"Goblin",12:"Seafolk",13:"Insect",14:"Bear",15:"Token",16:"Mecha",17:"Knight",999:"Tower"},IDs:{Factionless:0,Aether:1,Chaos:2,Wyld:3,Frog:4,Elemental:5,Angel:6,Undead:7,Void:8,Dragon:9,Avian:10,Goblin:11,Seafolk:12,Insect:13,Bear:14,Token:15,Mecha:16,Knight:17,Tower:999}}}),define("skillApi",[],function(){function d(e,t){var a=t.id;switch(SKILL_DATA[a].type){case"toggle":return void(e[a]=!0);case"passive":e[t.id]=(0|e[t.id])+t.x;break;case"flurry":e[t.id]=t;break;case"onDeath":e.onDeathSkills.push(t);break;case"earlyActivation":e.earlyActivationSkills.push(t);break;case"activation":default:e.skill.push(t)}}function o(e){var t={};return t.id=e.id,t.x=e.x,t.mult=e.mult,t.on_delay_mult=e.on_delay_mult,t.all=e.all,t.y=e.y,t.z=e.z,t.c=e.c,t.s=e.s,t}return{setSkill:d,copySkill:o,copySkills:function(e,t,a){e.skill=[],e.earlyActivationSkills=[],e.onDeathSkills=[];var n=[],r=!0;for(var i in t){var s=t[i];if(s.c){var l=o(s);d(e,l),n.push(l),r=!1}else if(a){var l=o(s);l.x=Math.ceil(l.x*a),d(e,l)}else d(e,s)}e.reusableSkills=r,e.skillTimers=n},nameFromId:function(e){var t=SKILL_DATA[e];return t?t.name:e}}}),define("runeApi",[],function(){function d(e){return RUNES[e]}return{addRunes:function(e,t){e.runes||(e.runes=[]);for(var a=0,n=t.length;a<n;a++){var r=t[a].id,i=d(r).stat_boost;for(var s in e.runes.push({id:r,stat_boost:i}),i){var l=i[s];"skill"===s||(isNaN(l)&&(l=Math.max(Math.ceil(e[s]*l.mult),l.min_bonus||1)),e[s]+=parseInt(l))}}},canUseRune:function(e,t){var a=d(t),n=a.stat_boost;if(a.faction_req&&!e.isInFaction(a.faction_req))return!1;for(var r in n)if("skill"===r){var i=n[r],s=i.all?1:0;if(!e.hasSkill(i.id,s))return!1}return!0},getRune:d}}),define("cardInfo",[],function(){function a(e){return CARDS[e]}return{loadCard:a,isCommander:function(e){var t=a(e);return t&&"1"==t.card_type},isAssault:function(e){var t=a(e);return t&&"2"==t.card_type},isTrap:function(e){var t=a(e);return t&&"3"==t.card_type}}}),define("matchTimer",[],function(){function a(e,t){return((t-e)/1e3).toFixed(3)}return{elapsed:function(){var e=this.timeStop||Date.now();return a(this.timeStart,e)},batchElapsed:function(e){return t=e||this.batchStarted,a(t,Date.now());var t},startBatch:function(){this.batchStarted=Date.now()},stop:function(){this.timeStop=Date.now()},reset:function(){this.timeStart=Date.now(),this.timeStop=0}}}),define("urlHelpers",[],function(){"use strict";return{paramDefined:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(decodeURIComponent(n[0])==e)return!0}return!1},paramValue:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(decodeURIComponent(n[0])==e)return decodeURIComponent(n[1]?n[1]:"")}return},getCurrentPage:function(){var e=window.location.href,t=e.indexOf(".html"),a=(e=e.substring(0,t)).lastIndexOf("/")+1;return e=e.substring(a).toLowerCase()}}}),define("storageAPI",["urlHelpers"],function(s){"use strict";var e,l={},t="SavedDecks";return!function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?function(){l.initialize=function(){l.getSavedDecks=function(){return{}},l.loadDeck=e,l.deleteDeck=e,l.clearDecks=e,l.getField=function(e,t,a){return a},l.setField=function(){},l.savedDecks={},l.setShowTutorial=function(e){l.shouldShowTutorial=e},l.shouldShowTutorial=!0};var e=function(){alert("Your browser does not support this feature.")}}():function(){var n="SavedDecks",r="Tutorial";function i(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){t={}}else t={};return l.data[e]=t}l.initialize=function(){var e,t=s.getCurrentPage();void 0===(e=i(n)).savedDecks&&l.setField(n,"savedDecks",e),l.getField(n,"savedDecks",{}),l.shouldShowTutorial=l.getField(r,t,!0)[t];var a=l.onUpdateDecks;l.onUpdateDecks=function(e){a(),l.setField(n,"savedDecks",e)},l.setShowTutorial=function(e){l.shouldShowTutorial=e,l.setField(r,t,e)}},l.getField=function(e,t,a){var n=i(e)[t];return void 0===n&&(n=a,l.setField(e,t,n)),n},l.setField=function(e,t,a){var n=i(e);n[t]=a,localStorage.setItem(e,JSON.stringify(n))},window.addEventListener("storage",function(e){"__storage_test__"!==e.key&&localStorage.getItem(e.key)!==e.newValue&&angular.element("#loadDeckDialog").scope().$apply(localStorage.setItem(e.key,e.newValue))})}(),l.data={},l.getSavedDecks=function(){return l.getField(t,"savedDecks",{})},l.saveDeck=function(e,t){var a=l.getSavedDecks();a[e]=t,l.onUpdateDecks(a)},l.loadDeck=function(e){return l.getSavedDecks()[e]},l.deleteDeck=function(e){var t=l.getSavedDecks();delete t[e],l.onUpdateDecks(t)},l.clearDecks=function(e){var t=l.getSavedDecks();for(var e in t)delete t[e];l.onUpdateDecks(t)},l.onUpdateDecks=function(){e||(e=angular.element("#loadDeckDialog").scope()),e.$apply()},l.initialize(),l}),define("loadCardCache",["storageAPI"],function(a){"use strict";return function(){var e=a.getField("GameData","CardCache");if(e&&e.lastUpdated>DataUpdated)e.newCards&&($.extend(CARDS,e.newCards),$.extend(FUSIONS,e.newFusions)),DataUpdated=e.lastUpdated;else{var t={newCards:{},newFusions:{},lastUpdated:Date.now()};a.setField("GameData","CardCache",t)}}}),define("dataUpdater",["storageAPI"],function(i){"use strict";var e={updateData:function(e,t){$("body").addClass("loading"),$("#loadingSplash").html("Checking for New Cards...");var a=Date.now();if(!l||6e4<l-a||t){l=a,h={};var n=[];n.push(function(){for(var e=[],t=0;t<d.length;t++){var a=jQuery.ajax({url:s+"/assets/"+d[t],success:function(e){for(var t="undefined"!=typeof spoilers,a=e.getElementsByTagName("unit"),n=0;n<a.length;n++){var r=a[n],i=k(r,"id"),s=v(r),l=!1;CARDS[i]?JSON.stringify(CARDS[i])!==JSON.stringify(s)&&(l=!0):l=!0,l&&(t&&(spoilers[i]=!0),h[i]=s),CARDS[i]=s}for(var d=e.getElementsByTagName("fusion_recipe"),n=0;n<d.length;n++){var o=d[n],c=k(o,"card_id",!1),u=o.getElementsByTagName("resource")[0];if(u){var f=k(u,"card_id",!0);FUSIONS[f]&&FUSIONS[f]===c||(p[f]=c,FUSIONS[f]=c)}}},async:!0,cache:!1});e.push(a)}return $.when.apply($,e)}());var r=function(){!function(){if(void 0!==i){var e=i.getField("GameData","CardCache");e?(e.newCards=e.newCards||{},e.newFusions=e.newFusions||{},$.extend(e.newCards,h),$.extend(e.newFusions,p)):e={newCards:h,newFusions:p},e.lastUpdated=Date.now(),i.setField("GameData","CardCache",e)}}(),$("body").removeClass("loading"),e&&e()};$.when.apply($,n).then(r,r)}else e&&e()}},s="https://spellstone.synapse-games.com",h={},p={},l=null;var d=["cards_heroes.xml","cards_premium_aether.xml","cards_premium_chaos.xml","cards_premium_wyld.xml","cards_reward.xml","cards_shard.xml","cards_special.xml","cards_standard.xml","cards_story.xml","fusion_recipes_cj2.xml"];function v(e){var t,a,n={};if(n.id=k(e,"id"),n.name=k(e,"name"),f(n,e,"desc"),n.picture=k(e,"picture")||(t=k(e,"asset_prefab"),a="prefab_",t?a+t:t),!n.picture){var r=k(e,"portrait");n.picture=r?"portrait_"+r.toLowerCase().replace("portrait_",""):"NotFound"}var i=k(e,"hidden_until")||k(e,"hidden_until_time");i&&(n.hidden_until=i+"000"),n.rarity=k(e,"rarity"),n.set=k(e,"set"),n.card_type=k(e,"card_type"),m(n,e,"shard_card"),n.type=k(e,"type")||0,n.sub_type=g(e,"sub_type")||[],m(n,e,"health"),"1"!==n.card_type&&(m(n,e,"attack"),m(n,e,"cost"));var s=function(e){for(var t=e.getElementsByTagName("upgrade"),a={},n=0;n<t.length;n++)a[n+2]=u(t[n]);return a}(e);return n.maxLevel=1+Object.keys(s).length,n.skill=o(e),n.upgrades=s,n}function o(e){for(var t=e.childNodes,a=[],n=0;n<t.length;n++){var r=t[n];"skill"===r.nodeName&&a.push(c(r))}return a}function c(e){var t={id:k(e,"id",!0)};return m(t,e,"x",!0),m(t,e,"mult",!0),m(t,e,"on_delay_mult",!0),f(t,e,"y",!0),m(t,e,"z",!0),m(t,e,"c",!0),f(t,e,"s",!0),f(t,e,"all",!0),t}function u(e){var t={};return m(t,e,"attack"),m(t,e,"health"),m(t,e,"cost"),f(t,e,"desc"),t.skill=o(e),t}function f(e,t,a,n){var r=k(t,a,n);null!=r&&0<r.length&&(e[a]=r)}function m(e,t,a,n){var r,i=null!=(r=k(t,a,n))?Number(r):-1;0<=i&&(e[a]=i)}function k(e,t,a){if(a)return e.getAttribute(t);var n=g(e,t);return n?n[0]:null}function g(e,t){var a=null,n=$(e).children(t);if(0<n.length){a=[];for(var r=0;r<n.length;r++)a.push(n[r].textContent)}return a}return e}),define("cardApi",["cardInfo","skillApi","runeApi"],function(l,y,d){var e={byId:r,byIdSlim:function(e,t){var a=l.loadCard(e.id),n={};"1"==a.card_type?(n.isCommander=function(){return!0},n.isAssault=function(){return!1}):(n.isCommander=function(){return!1},n.isAssault=function(){return!0});if(a){if(n.id=a.id,n.name=a.name,n.rarity=a.rarity,n.maxLevel=a.maxLevel,e.level?(n.level=e.level,n.level>n.maxLevel&&(n.level=n.maxLevel)):n.level=1,t){if(n.attack=a.attack,n.health=a.health,n.cost=a.cost,n.set=a.set,n.card_type=a.card_type,n.type=a.type,n.sub_type=a.sub_type||[],n.skill=a.skill,1<n.level)for(var r in a.upgrades){var i=a.upgrades[r];if(void 0!==i.cost&&(n.cost=i.cost),void 0!==i.health&&(n.health=i.health),void 0!==i.attack&&(n.attack=i.attack),void 0!==i.desc&&(n.desc=i.desc),0<i.skill.length&&(n.skill=i.skill),r==n.level)break}var s=e.runes;s&&(n.skill=n.skill.slice(),o(n,s),f(n.skill,s))}}else n.id=void 0,n.name=void 0,n.card_type=void 0,n.set=void 0,n.type=void 0,n.sub_type=[],n.level=void 0,n.maxLevel=void 0,t&&(n.skill=[]);return n},byIdWithBgeApplied:function(e,t,a){return t=t||SIMULATOR.battlegrounds.onCreate,r(e,t,null,a)},makeBattleground:t,applyDefaultStatuses:n},a={attack_berserk:0,attack_valor:0,attack_rally:0,attack_weaken:0,attack_corroded:0,corrosion_timer:0,mark_target:0,barrier_ice:0,corroded:0,enfeebled:0,enraged:0,envenomed:0,heartseeker:0,imbued:0,invisible:0,nullified:0,poisoned:0,protected:0,scorched:0,warded:0,jammed:!1,jammedSelf:!1,silenced:!1,valor_triggered:!1,dualstrike_triggered:!1,ondeath_triggered:!1,reanimated:!1};function n(e){for(var t in e.removeImbue(),e.enhanced={},a)e[t]=a[t]}function o(e,t){e.runes||(e.runes=[]);for(var a=0,n=t.length;a<n;a++){var r=t[a].id,i=d.getRune(r).stat_boost;for(var s in e.runes.push({id:r,stat_boost:i}),i){var l=i[s];"skill"===s||(isNaN(l)&&(l=Math.max(Math.ceil(e[s]*l.mult),l.min_bonus||1)),e[s]+=parseInt(l))}}}function r(e,t,a,n){var r=l.loadCard(e.id);if(r){r.skill||(r.skill=[]);var i=s(r,e.level,e.runes,t,a,n);return e.priority&&(i.priority=e.priority),i}return console.log(e.id+" not found"),(r={}).id=e.id,r.level=e.level,r.name=void 0,r.health=void 0,r.skill=[],r}function f(e,t,a){if(t)for(var n=0,r=t.length;n<r;n++){var i=t[n].id,s=RUNES[i].stat_boost;for(var l in s){var d=s[l];if("skill"===l)for(var o=d.id,c=d.x,u=d.mult,f=0;f<e.length;f++){var h=e[f];if(h.id===o&&(h.all||0)==(d.all||0)){h=y.copySkill(h),!c&&u&&(c=Math.ceil(h.x*u)),d.min_bonus&&(c=Math.max(c,d.min_bonus)),c&&(h.x+=parseInt(c)*a),d.c&&(h.c-=Math.min(h.c,parseInt(d.c)*a)),h.boosted=!0,e[f]=h;break}}}}}var i,s=function(){var u;function k(e,t){return r({id:e.id,level:e.level})[t]}function g(e,t,a){for(var n in t){var r=t[n];r.x&&((r=y.copySkill(r)).x+=Math.ceil(r.x*a),r.boosted=!0,t[n]=r,e.highlighted.push(r.id))}}for(var e in u={p:null,health_left:0,timer:0,key:void 0,isCommander:function(){return"1"==this.card_type},isAssault:function(){return"2"==this.card_type},isTrap:function(){return"3"==this.card_type},isAlive:function(){return 0<this.health_left},isDamaged:function(){return this.health_left<this.health},isActive:function(){return 0==this.timer},isActiveNextTurn:function(){return this.timer<=1},isInactive:function(){return 1<=this.timer},isUnjammed:function(){return!this.jammed},isUnsilenced:function(){return!this.silenced},imbue:function(e){this.imbued||(this.imbued={});var t,a=this.imbued,n=e.id;switch(SKILL_DATA[n].type){case"toggle":return this[n]=!0,void(this.imbued[n]=1);case"passive":return this[n]+=parseInt(e.x),void(this.imbued[n]=(this.imbued[n]||0)+e.x);case"flurry":return void(this.flurry||(this.flurry=e,this.flurry.countdown=0,this.imbued.flurry=!0));case"onDeath":t="onDeathSkills";break;case"earlyActivation":t="earlyActivationSkills";break;case"activation":default:t="skill"}if(void 0===a[t]){var r=this[t];a[t]=r.length,this[t]=r.slice()}this[t].push(e)},scorch:function(e){var t=this.scorched;t?(t.amount+=e,t.timer=2):this.scorched={amount:e,timer:2}},removeImbue:function(){var e=this.imbued;if(e){for(var t in e){var a=e[t];"skill"===t||"earlyActivationSkills"===t||"onDeathSkills"===t?this[t]=this[t].slice(0,a):this[t]-=a}this.imbued=0}},hasSkill:function(e,t){var a;switch(SKILL_DATA[e].type){case"toggle":case"passive":case"flurry":return this[e];case"onDeath":a=this.onDeathSkills;break;case"earlyActivation":a=this.earlyActivationSkills;break;case"activation":default:a=this.skill}for(var n in a){var r=a[n];if(r.id===e&&(void 0===t||(r.all||0)==t))return!0}return!1},hasAttack:function(){return 0<this.adjustedAttack()},attackPlusBuffs:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor},adjustedAttack:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor-this.attack_weaken-this.attack_corroded},permanentAttack:function(){return this.attack+this.attack_berserk+this.attack_valor},isInFaction:function(e){if(void 0===e)return 1;var t=e.split(",");if(t.length<=1)return this.type==e?1:0<=this.sub_type.indexOf(e.toString())?1:0;for(var a=0;a<t.length;a++)if(!this.isInFaction(t[a]))return 0;return 1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0},addRunes:function(e){o(this,e)}},SKILL_DATA){var t=SKILL_DATA[e].type;"passive"===t?u[e]=0:"toggle"===t&&(u[e]=!1)}return n(u),function(e,t,a,n,r,i){t||(t=1);var s=Object.create(u);s.id=e.id,s.name=e.name,s.attack=e.attack,s.health=e.health,s.maxLevel=e.maxLevel,s.level=t>s.maxLevel?s.maxLevel:t,s.cost=e.cost,s.rarity=e.rarity,s.card_type=e.card_type,s.type=e.type,s.sub_type=e.sub_type||[],s.set=e.set;var l,d=e.skill;if(1<s.level)for(var o in e.upgrades)if(void 0!==(l=e.upgrades[o]).cost&&(s.cost=l.cost),void 0!==l.health&&(s.health=l.health),void 0!==l.attack&&(s.attack=l.attack),void 0!==l.desc&&(s.desc=l.desc),0<l.skill.length&&(d=l.skill),o==s.level)break;if(d=d.slice(),n&&n.length&&function(t,e,a,n){t.highlighted=[];for(var r=0;r<a.length;r++){var i=a[r];if("statChange"==i.modifierType&&!n)for(var s=0;s<i.effects.length;s++){var l=i.effects[s];t.isInFaction(l.y)&&Object.keys(l).forEach(function(e){t[e]=l[e]})}}}(s,0,n,i),a){s.addRunes(a);var c=1;n&&n.forEach(function(e){"runeMultiplier"==e.modifierType&&e.effects.forEach(function(e){s.isInFaction(e.y)&&(c=parseInt(e.mult))})}),f(d,a,c)}else s.runes=[];return n&&n.length&&function(e,t,a,n){e.highlighted=[];for(var r=0;r<a.length;r++){var i=a[r];if("evolve_skill"===i.modifierType)for(var s=0;s<i.effects.length;s++){var l=i.effects[s];for(var d in t){var o=t[d];o.id==l.id&&o.all==l.all&&((o=y.copySkill(o)).id=l.s,o.boosted=!0,t[d]=o,e.highlighted.push(o.id))}}else if("add_skill"===i.modifierType)for(s=0;s<i.effects.length;s++){var c=i.effects[s];if(e.isInFaction(c.y)){if(c.rarity&&e.rarity!=c.rarity)continue;var u={};if(u.id=c.id,u.x=c.x||0,c.mult)if(c.base){var f=k(e,c.base);u.x+=Math.ceil(c.mult*f)}else u.mult=c.mult;if(u.z=c.z,u.c=c.c,u.s=c.s,u.all=c.all,c.card&&(u.card=c.card),c.level&&(u.level=c.level),u.boosted=!0,c.mult&&c.base&&0==u.x)continue;t.push(u),e.highlighted.push(u.id)}}else if("scale_attributes"!==i.modifierType||n){if("scale_stat"===i.modifierType&&!n)for(s=0;s<i.effects.length;s++)h=i.effects[s],e.isInFaction(h.y)&&(e[i.scaledStat]+=Math.ceil(k(e,h.base)*h.mult))}else for(var s=0;s<i.effects.length;s++){var h=i.effects[s];if(e.isInFaction(h.y)){var p=h.mult,v=Math.ceil(e.attack*p);e.attack+=v;var m=Math.ceil(e.health*p);e.health+=m,g(e,t,p)}}}}(s,d,n,i),r&&g(s,d,r),y.copySkills(s,d),s}}(),t=((i=function(e,t,a){this.name=e,y.copySkills(this,[t],a)}).prototype={p:null,name:null,runes:[],isCommander:function(){return!1},isAssault:function(){return!1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0}},function(e,t,a){return new i(e,t,a)});return e}),define("unitInfo",["cardApi"],function(n){"use strict";function e(e,t,a){var n={id:Number(e),level:Number(t),runes:[]};return a&&(n.runes=a),n}function a(e){return e.runes.length&&e.runes[0].id||0}return{areEqual:function(e,t){return!e==!t&&e.id===t.id&&e.level===t.level&&a(e)===a(t)},getEnhancement:function(e,t,a){var n=e.enhanced,r=n&&n[t]||0;r<0&&(r=Math.ceil(a*-r));return r},initializeUnit:function(e,t,a){e.owner=t,e.timer=e.cost,e.health_left=e.health,n.applyDefaultStatuses(e),e.key=a,e.reusableSkills||e.resetTimers()},isImbued:function(e,t,a){var n;switch(SKILL_DATA[t].type){case"flurry":case"toggle":return e.imbued[t];case"passive":return e[t]===e.imbued[t];case"onDeath":n="onDeathSkills";break;case"earlyActivation":n="earlyActivationSkills";break;case"activation":default:n="skill"}return void 0!==e.imbued[n]&&a>=e.imbued[n]},create:e,defaultCommander:e(202,1)}}),define("cardUI",["cardApi","cardInfo","runeApi","factions","unitInfo"],function(v,R,B,H,m){"use strict";var t="";function n(e,t,a){var n=[],r=v.byId(e.commander);n.push(g(r,!1,!1));for(var i=0,s=e.deck.length;i<s;i++){var l=e.deck[i];if(a)var d=v.byIdWithBgeApplied(l,a);else d=v.byId(l);n.push(g(d,!1,!1))}if(!t)for(;i<15;i++)n.push(J("card blank"));return n}function d(e,t,a,n,r,i){var s,l,d;r=r||0;for(var o=0,c=[],u=0,f=e.length;u<f&&(!i||o<i);u++){var h=e[u],p=v.byId(h);m.areEqual(p,l)?d++:(r<=o&&(k(s,d),(s=g(p,t,!(d=1),a,n,null,u)).setAttribute("data-i",u),void 0!==h.index&&s.setAttribute("data-index",h.index),c.push(s)),l=p,o++)}return k(s,d),c}function i(e,t,a,n,r){t||(t=[]);var i=[];if(n){var s=document.createElement("h1");s.innerHTML="Turn: "+n+" (Currently at "+SIMULATOR.calculatePoints(!0)+" points)",i.push(s)}var l=J("field"),d=null;if(r){d=r.owner;r=r.isCommander()?-1:r.key}return"player"===d?(l.appendChild(o(e.cpu)),l.appendChild(o(e.player,r))):(l.appendChild(o(e.cpu,r)),l.appendChild(o(e.player))),i.push(l),i.push(c(t,a,n)),i.push(document.createElement("br")),i.push(document.createElement("br")),i}function o(e,t){var a=J("float-left"),n=g(e.commander,!1,!0);-1===t&&u(n),a.appendChild(n);var r=e.assaults;if(r)for(var i=0,s=r.length;i<s;i++){var l=r[i];n=g(l,!1,!0);l.timer&&n.classList.add("inactive"),t===i&&u(n),a.appendChild(n)}return a}function c(e,t,a){for(var n=J("float-left hand"),r=0,i=e.length;r<i;r++){var s=e[r];if(s){var l=g(s,!1);0===r?l.classList.add("left"):2===r?l.classList.add("right"):2<r&&l.classList.add("inactive");t&&l.addEventListener("click",function(e){return function(){choice=e,t(a)}}(r)),n.appendChild(l)}}return n}function u(e){e.style.outline="5px solid LawnGreen"}function k(e,t){var a=parseInt(t);if(a==t&&(t=1<a?a:null),t){var n=J("multiplier","x"+t);n.setAttribute("data-count",t);var r=W(V("cardAssets")+"multiplier.png","multiplier");e.appendChild(r),e.appendChild(n)}}function g(e,t,a,n,r,i,s){var l=J("card");l.setAttribute("data-id",e.id),l.setAttribute("data-level",e.level);for(var d=e.runes,o=[],c={},u=0,f=d.length;u<f;u++){var h=d[u].id;o.push(d[u].id);var p=B.getRune(h);for(var v in p.stat_boost)"skill"==v&&(v=p.stat_boost.skill.id),c[v]=!0}var m=e.highlighted;if(m)for(u=0;u<m.length;u++){c[v=m[u]]=!0}l.setAttribute("data-runeids",o.join(","));var k=R.loadCard(e.id).picture;if(k){var g=document.createElement("i");0==k.indexOf("portrait_")?g.className="portrait portrait-"+k:g.className="sprite sprite-"+k,l.appendChild(g)}e.isCommander()&&l.classList.add("commander"),l.classList.add(H.names[e.type].toLowerCase());var y=J("card-name",(void 0!==e.uid?"("+e.uid+") ":"")+e.name),b=J("card-id","("+e.id+")");if(y.appendChild(b),l.appendChild(y),!e.isCommander()){if(0<=e.attack){if(a){e.isUnjammed()||l.classList.add("frozen");var _=J("card-attack",e.adjustedAttack().toString());e.adjustedAttack()>e.attack?_.classList.add("increased"):e.adjustedAttack()<e.attack?_.classList.add("decreased"):c.attack&&_.classList.add("increased")}else _=J("card-attack",e.attack.toString());l.appendChild(W(V("cardAssets")+"Attack.png","attack")),l.appendChild(_)}0<=e.cost&&(a?e.timer&&(l.appendChild(J("delay",e.timer)),l.appendChild(W(V("cardAssets")+"Timer.png","timer"))):(l.appendChild(J("delay",e.cost)),l.appendChild(W(V("cardAssets")+"Timer.png","timer"))))}if(0<=e.health){if(a){var C=J("card-health",e.health_left.toString());e.health_left<e.health?C.classList.add("decreased"):c.health&&C.classList.add("increased")}else{C=J("card-health",e.health.toString());c.health&&C.classList.add("increased")}l.appendChild(W(V("cardAssets")+"Health.png","health")),l.appendChild(C)}var S=J("card-skills"),A=J("card-skills-short");e.earlyActivationSkills&&K(e,S,A,e.earlyActivationSkills,a),K(e,S,A,e.skill,a),e.onDeathSkills&&K(e,S,A,e.onDeathSkills,a),function(t,a,n,r,i){Object.getOwnPropertyNames(SKILL_DATA).filter(function(e){return 0<=["passive","toggle"].indexOf(SKILL_DATA[e].type)}).forEach(function(e){!function(e,t,a,n,r,i){var s=n[r];if(s){var l={id:r,x:s,boosted:i[r]};e.appendChild(P(n,l,a)),e.appendChild(document.createElement("br")),t.appendChild(z(l.id))}}(t,a,r,n,e,i)});var e=n.flurry;e&&(t.appendChild(P(n,e,r)),t.appendChild(document.createElement("br")),a.appendChild(z(e.id)))}(S,A,e,a,c);var w,D,I=S.cloneNode(!0);if(I.className="card-skills-detailed",A.hasChildNodes()&&(t?(l.appendChild(A),l.appendChild(S)):l.appendChild(I)),l.appendChild(J("faction")),a){var L=function(e){var t=[];if(e.enfeebled){var a=G("enfeeble",e.enfeebled);t.push(a)}if(e.marked){var a=G("enfeeble",e.marked);t.push(a)}if(e.nullified){var a=G("nullify",e.nullified);t.push(a)}if(e.poisoned){var a=G("poison",e.poisoned);t.push(a)}if(e.scorched&&e.scorched.amount){var a=G("burn",e.scorched.amount);t.push(a)}var n=[];if(e.enraged){var a=G("enrage",e.enraged);t.push(a)}if(e.protected){var a=G("protect",e.protected);n.push(a)}if(e.invisible){var a=G("evade",e.invisible);n.push(a)}var r=[];if(0<t.length){for(var i=J("card-debuffs"),s=0,l=t.length;s<l;s++)i.appendChild(t[s]);r.push(i)}if(0<n.length){for(var d=J("card-buffs"),s=0,l=n.length;s<l;s++)d.appendChild(n[s]);r.push(d)}return r}(e);if(0<L.length){l.appendChild(J("hidden","..."));var x=J("card-statuses");for(u=0;u<L.length;u++){var T=L[u];x.appendChild(T)}l.appendChild(x)}}if(e.set){var F=(w=e.set,D=Q[w],W(V("cardAssets")+D+".png"));F.className="set",l.appendChild(F)}var N=e.sub_type;if(N.length){var U=J("subfaction");for(u=0;u<N.length;u++){var E=N[u];if(E){var M=q(E);U.appendChild(M)}}l.appendChild(U)}if(0<e.rarity){if(e.maxLevel>Number(e.rarity)+2)var O=W(V("cardAssets")+"Level_"+e.rarity+"_"+e.maxLevel+"_"+e.level+".png");else O=W(V("cardAssets")+"Level_"+e.rarity+"_"+e.level+".png");if(O.className="level",9999<e.id){var j="1"==e.id.toString()[0]?"Dualfuse":"Quadfuse";(j=W(V("cardAssets")+j+".png")).className="fusion",l.appendChild(j)}l.appendChild(O)}else if(1<e.maxLevel){(O=W(V("cardAssets")+e.maxLevel+"_"+e.level+".png")).className="level",l.appendChild(O)}return n&&l.addEventListener("click",function(){return n(l,s)}),r&&(l.oncontextmenu=function(){return r(l,s)}),i&&(l.onmouseover=function(){return i(l,s)}),l}function K(e,t,a,n,r){for(var i=0;i<n.length;i++){var s=n[i];t.appendChild(P(e,s,r,i)),t.appendChild(document.createElement("br")),a.appendChild(z(s.id))}}function P(e,t,a,n){var r=document.createElement("span");r.className="skill",r.appendChild(z(t.id));var i=m.isImbued(e,t.id,n),s=m.getEnhancement(e,t.id,t.x);i?r.classList.add("imbued"):(t.boosted||s)&&r.classList.add("increased"),t.all&&(r.innerHTML+=" All "),t.y&&r.appendChild(q(t.y)),t.s&&r.appendChild(z(t.s));var l=(0|t.x)+s;return l&&(r.innerHTML+=" "+l+" "),t.c&&(r.innerHTML+=t.c,a&&(r.innerHTML+=" ("+(t.countdown?t.countdown:"0")+")")),r}function z(e){var t=V("skills"),a=SKILL_DATA[e],n=W(t+=(a?a.icon:e)+".png");switch(e){case"weakenself":case"enlarge":n.classList.add("affect-self")}return n.title=a?a.name:e,n}function G(e,t){var a=document.createElement("span");return a.appendChild(z(e)),t&&(a.innerHTML+=t),a}function q(e){var t=H.names[e];return W(V("factions")+t+".png")}function V(e){return t+"res/"+e+"/"}function W(e,t){return $("<img>").addClass(t).attr("src",e)[0]}function J(e,t){return $("<div>").addClass(e).html(t)[0]}var Q={1e3:"Basic",1100:"Legacy",7e3:"Basic",2e3:"Reward",2100:"Reward",3e3:"Premium",4e3:"BoxOnly",5e3:"Champion",5100:"Champion",9999:"StoryElements"},e={clearCardSpace:function(){$("#cardSpace").empty()},clearDeckSpace:function(){document.getElementById("deck").innerHTML=""},draw_deck:function(e,t){var a=$("#deck");return a.children().remove(),a.append(n(e,t)),a},create_card_html:g,makeDeckHTML:n,makeCardListHTML:function(e,t,a){for(var n=J("float-left"),r=0,i=e.deck.length;r<i;r++){var s=e.deck[r],l=g(v.byId(s),!1,!1,t,a,null,r);void 0!==s.index&&l.setAttribute("data-index",s.index),n.appendChild(l)}return n},draw_card_list:function(e,t,a,n,r,i){var s=d(e,t,null,null,r,i),l=$("#cardSpace");return l.empty(),l.append(s),l},draw_cards:function(e,t,a,n){var r=i(e,t,a,n);$("#cardSpace").children().remove().end().append(r)},doDrawField:i,draw_inventory:function(e){var t=d(e.deck),a=$("#deck");return a.children().remove(),a.append(d([e.commander])),a.append(t),a},draw_hand:c,createItemHTML:function(e,t,a){var n=J("card item"),r=document.createElement("i");r.className="sprite sprite-Item",n.appendChild(r),a&&((a=W(V("items")+a+".png")).className="item-image",n.appendChild(a));var i=J("card-name",e);return n.appendChild(i),n.classList.add("factionless"),n.appendChild(J("faction")),k(n,t),n},addMult:k,addWeight:function(e,t){if(0<t){var a=J("weight",(100*t).toFixed(2)+"%");a.setAttribute("data-count",t);var n=W(V("cardAssets")+"multiplier.png","weight");e.appendChild(n),e.appendChild(a)}}};return Object.defineProperties(e,{assetsRoot:{get:function(){return t},set:function(e){t=e}}}),e}),define("base64",["cardInfo","unitInfo"],function(i,l){"use strict";var e={encodeHash:function(e){var t=[];e.commander&&t.push(e.commander);return t.concat(e.deck).map(n).join("")},decodeHash:function(e){for(var t,a={deck:[]},n=0;n<e.length;n+=5){var r=e.substr(n,5);(t=c(r))&&(i.loadCard(t.id)?!a.commander&&i.isCommander(t.id)?a.commander=t:a.deck.push(t):console.log("Could not decode '"+r+"' ("+t.id+")"))}a.commander||(a.commander=l.defaultCommander);return a},fromDecimal:u,toDecimal:f,fromUnitInfo:n},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!~",d={};for(var t in CARDS)if(t<1e4){var a=FUSIONS[t];(!a||Number(a)<1e4)&&(d[t]=!0)}var o=1e3;function n(e){var t=parseInt(e.id),a=parseInt(e.level)-1;if(d[t]){var n=Math.floor(a/7);a=a%7}else{n=Math.floor(t/1e4);t%=1e4}var r=0;e.runes.length&&(r=parseInt(e.runes[0].id),r%=5e3);var i=t;return u(i=(i=7*(i=3*i+n)+a)*o+r,5)}function c(e){var t=f(e),a=t%o,n=(t=(t-a)/o)%7,r=(t=(t-n++)/7)%3,i=t=(t-r)/3;d[i]?n+=7*r:0<r&&(i=Number(r+""+i));var s=l.create(i,n);return 0<a&&s.runes.push({id:a+5e3}),s}function u(e,t){for(var a="",n=0;n<t;n++){var r=e%64;a+=s[r],e=(e-r)/64}return a}function f(e){for(var t=0,a=e.length-1;0<=a;a--){t*=64,t+=s.indexOf(e[a])}return t}return e});
//# sourceMappingURL=shared.min.js.map