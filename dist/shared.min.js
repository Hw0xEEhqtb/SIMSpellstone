!function(){var n={};window.define=function(e,t,a){var r=t.map(function(e){return n[e]});n[e]=a.apply(this,r)},window.require=function(e){var t=n[e];if(t)return t;throw"Module '"+e+"' is not defined yet."}}(),"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var a=arguments[t];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}),Function.prototype.debounce=function(a){var r,n=this;return function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n.apply(e,t)},a)}},Function.prototype.throttle=function(a){var r,n=this;return function(){var e=this,t=arguments;if(!r){n.apply(e,t);r=setTimeout(function(){r=null,n.apply(e,t)},a)}}},define("factions",[],function(){return{names:{0:"Factionless",1:"Aether",2:"Chaos",3:"Wyld",4:"Frog",5:"Elemental",6:"Angel",7:"Undead",8:"Void",9:"Dragon",10:"Avian",11:"Goblin",12:"Seafolk",13:"Insect",14:"Bear",15:"Token",16:"Mecha",17:"Knight",999:"Tower"},IDs:{Factionless:0,Aether:1,Chaos:2,Wyld:3,Frog:4,Elemental:5,Angel:6,Undead:7,Void:8,Dragon:9,Avian:10,Goblin:11,Seafolk:12,Insect:13,Bear:14,Token:15,Mecha:16,Knight:17,Tower:999}}}),define("skillApi",[],function(){function d(e,t){var a=t.id;switch(SKILL_DATA[a].type){case"toggle":return void(e[a]=!0);case"passive":e[t.id]=(0|e[t.id])+t.x;break;case"flurry":e[t.id]=t;break;case"onDeath":e.onDeathSkills.push(t);break;case"earlyActivation":e.earlyActivationSkills.push(t);break;case"activation":default:e.skill.push(t)}}function o(e){var t={};return t.id=e.id,t.x=e.x,t.mult=e.mult,t.on_delay_mult=e.on_delay_mult,t.all=e.all,t.y=e.y,t.z=e.z,t.c=e.c,t.s=e.s,t}return{setSkill:d,copySkill:o,copySkills:function(e,t,a){e.skill=[],e.earlyActivationSkills=[],e.onDeathSkills=[];var r=[],n=!0;for(var i in t){var s=t[i];if(s.c){var l=o(s);d(e,l),r.push(l),n=!1}else if(a){var l=o(s);l.x=Math.ceil(l.x*a),d(e,l)}else d(e,s)}e.reusableSkills=n,e.skillTimers=r},nameFromId:function(e){var t=SKILL_DATA[e];return t?t.name:e}}}),define("runeApi",[],function(){function d(e){return RUNES[e]}return{addRunes:function(e,t){e.runes||(e.runes=[]);for(var a=0,r=t.length;a<r;a++){var n=t[a].id,i=d(n).stat_boost;for(var s in e.runes.push({id:n,stat_boost:i}),i){var l=i[s];"skill"===s||(isNaN(l)&&(l=Math.max(Math.ceil(e[s]*l.mult),l.min_bonus||1)),e[s]+=parseInt(l))}}},canUseRune:function(e,t){var a=d(t),r=a.stat_boost;if(a.faction_req&&!e.isInFaction(a.faction_req))return!1;for(var n in r)if("skill"===n){var i=r[n],s=i.all?1:0;if(!e.hasSkill(i.id,s))return!1}return!0},getRune:d}}),define("cardInfo",[],function(){function a(e){return CARDS[e]}return{loadCard:a,isCommander:function(e){var t=a(e);return t&&"1"==t.card_type},isAssault:function(e){var t=a(e);return t&&"2"==t.card_type},isTrap:function(e){var t=a(e);return t&&"3"==t.card_type}}}),define("matchTimer",[],function(){function a(e,t){return((t-e)/1e3).toFixed(3)}return{elapsed:function(){var e=this.timeStop||Date.now();return a(this.timeStart,e)},batchElapsed:function(e){return t=e||this.batchStarted,a(t,Date.now());var t},startBatch:function(){this.batchStarted=Date.now()},stop:function(){this.timeStop=Date.now()},reset:function(){this.timeStart=Date.now(),this.timeStop=0}}}),define("urlHelpers",[],function(){"use strict";return{paramDefined:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var r=t[a].split("=");if(decodeURIComponent(r[0])==e)return!0}return!1},paramValue:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var r=t[a].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1]?r[1]:"")}return},getCurrentPage:function(){var e=window.location.href,t=e.indexOf(".html"),a=(e=e.substring(0,t)).lastIndexOf("/")+1;return e=e.substring(a).toLowerCase()}}}),define("storageAPI",["urlHelpers"],function(s){"use strict";var e,l={},t="SavedDecks";return!function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?function(){l.initialize=function(){l.getSavedDecks=function(){return{}},l.loadDeck=e,l.deleteDeck=e,l.clearDecks=e,l.getField=function(e,t,a){return a},l.setField=function(){},l.savedDecks={},l.setShowTutorial=function(e){l.shouldShowTutorial=e},l.shouldShowTutorial=!0};var e=function(){alert("Your browser does not support this feature.")}}():function(){var r="SavedDecks",n="Tutorial";function i(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){t={}}else t={};return l.data[e]=t}l.initialize=function(){var e,t=s.getCurrentPage();void 0===(e=i(r)).savedDecks&&l.setField(r,"savedDecks",e),l.getField(r,"savedDecks",{}),l.shouldShowTutorial=l.getField(n,t,!0)[t];var a=l.onUpdateDecks;l.onUpdateDecks=function(e){a(),l.setField(r,"savedDecks",e)},l.setShowTutorial=function(e){l.shouldShowTutorial=e,l.setField(n,t,e)}},l.getField=function(e,t,a){var r=i(e)[t];return void 0===r&&(r=a,l.setField(e,t,r)),r},l.setField=function(e,t,a){var r=i(e);r[t]=a,localStorage.setItem(e,JSON.stringify(r))},window.addEventListener("storage",function(e){"__storage_test__"!==e.key&&localStorage.getItem(e.key)!==e.newValue&&angular.element("#loadDeckDialog").scope().$apply(localStorage.setItem(e.key,e.newValue))})}(),l.data={},l.getSavedDecks=function(){return l.getField(t,"savedDecks",{})},l.saveDeck=function(e,t){var a=l.getSavedDecks();a[e]=t,l.onUpdateDecks(a)},l.loadDeck=function(e){return l.getSavedDecks()[e]},l.deleteDeck=function(e){var t=l.getSavedDecks();delete t[e],l.onUpdateDecks(t)},l.clearDecks=function(e){var t=l.getSavedDecks();for(var e in t)delete t[e];l.onUpdateDecks(t)},l.onUpdateDecks=function(){e||(e=angular.element("#loadDeckDialog").scope()),e.$apply()},l.initialize(),l}),define("loadCardCache",["storageAPI"],function(a){"use strict";return function(){var e=a.getField("GameData","CardCache");if(e&&e.lastUpdated>DataUpdated)e.newCards&&($.extend(CARDS,e.newCards),$.extend(FUSIONS,e.newFusions)),DataUpdated=e.lastUpdated;else{var t={newCards:{},newFusions:{},lastUpdated:Date.now()};a.setField("GameData","CardCache",t)}}}),define("dataUpdater",["storageAPI"],function(i){"use strict";var e={updateData:function(e,t){$("body").addClass("loading"),$("#loadingSplash").html("Checking for New Cards...");var a=Date.now();if(!l||6e4<l-a||t){l=a,h={};var r=[];r.push(function(){for(var e=[],t=0;t<d.length;t++){var a=jQuery.ajax({url:s+"/assets/"+d[t],success:function(e){for(var t="undefined"!=typeof spoilers,a=e.getElementsByTagName("unit"),r=0;r<a.length;r++){var n=a[r],i=k(n,"id"),s=v(n),l=!1;CARDS[i]?JSON.stringify(CARDS[i])!==JSON.stringify(s)&&(l=!0):l=!0,l&&(t&&(spoilers[i]=!0),h[i]=s),CARDS[i]=s}for(var d=e.getElementsByTagName("fusion_recipe"),r=0;r<d.length;r++){var o=d[r],c=k(o,"card_id",!1),u=o.getElementsByTagName("resource")[0];if(u){var f=k(u,"card_id",!0);FUSIONS[f]&&FUSIONS[f]===c||(p[f]=c,FUSIONS[f]=c)}}},async:!0,cache:!1});e.push(a)}return $.when.apply($,e)}());var n=function(){!function(){if(void 0!==i){var e=i.getField("GameData","CardCache");e?(e.newCards=e.newCards||{},e.newFusions=e.newFusions||{},$.extend(e.newCards,h),$.extend(e.newFusions,p)):e={newCards:h,newFusions:p},e.lastUpdated=Date.now(),i.setField("GameData","CardCache",e)}}(),$("body").removeClass("loading"),e&&e()};$.when.apply($,r).then(n,n)}else e&&e()}},s="https://spellstone.synapse-games.com",h={},p={},l=null;var d=["cards_heroes.xml","cards_premium_aether.xml","cards_premium_chaos.xml","cards_premium_wyld.xml","cards_reward.xml","cards_shard.xml","cards_special.xml","cards_standard.xml","cards_story.xml","fusion_recipes_cj2.xml"];function v(e){var t,a,r={};if(r.id=k(e,"id"),r.name=k(e,"name"),f(r,e,"desc"),r.picture=k(e,"picture")||(t=k(e,"asset_prefab"),a="prefab_",t?a+t:t),!r.picture){var n=k(e,"portrait");r.picture=n?"portrait_"+n.toLowerCase().replace("portrait_",""):"NotFound"}var i=k(e,"hidden_until")||k(e,"hidden_until_time");i&&(r.hidden_until=i+"000"),r.rarity=k(e,"rarity"),r.set=k(e,"set"),r.card_type=k(e,"card_type"),m(r,e,"shard_card"),r.type=k(e,"type")||0,r.sub_type=g(e,"sub_type")||[],m(r,e,"health"),"1"!==r.card_type&&(m(r,e,"attack"),m(r,e,"cost"));var s=function(e){for(var t=e.getElementsByTagName("upgrade"),a={},r=0;r<t.length;r++)a[r+2]=u(t[r]);return a}(e);return r.maxLevel=1+Object.keys(s).length,r.skill=o(e),r.upgrades=s,r}function o(e){for(var t=e.childNodes,a=[],r=0;r<t.length;r++){var n=t[r];"skill"===n.nodeName&&a.push(c(n))}return a}function c(e){var t={id:k(e,"id",!0)};return m(t,e,"x",!0),m(t,e,"mult",!0),m(t,e,"on_delay_mult",!0),f(t,e,"y",!0),m(t,e,"z",!0),m(t,e,"c",!0),f(t,e,"s",!0),f(t,e,"all",!0),t}function u(e){var t={};return m(t,e,"attack"),m(t,e,"health"),m(t,e,"cost"),f(t,e,"desc"),t.skill=o(e),t}function f(e,t,a,r){var n=k(t,a,r);null!=n&&0<n.length&&(e[a]=n)}function m(e,t,a,r){var n,i=null!=(n=k(t,a,r))?Number(n):-1;0<=i&&(e[a]=i)}function k(e,t,a){if(a)return e.getAttribute(t);var r=g(e,t);return r?r[0]:null}function g(e,t){var a=null,r=$(e).children(t);if(0<r.length){a=[];for(var n=0;n<r.length;n++)a.push(r[n].textContent)}return a}return e}),define("cardApi",["cardInfo","skillApi","runeApi"],function(l,y,d){var e={byId:n,byIdSlim:function(e,t){var a=l.loadCard(e.id),r={};"1"==a.card_type?(r.isCommander=function(){return!0},r.isAssault=function(){return!1}):(r.isCommander=function(){return!1},r.isAssault=function(){return!0});if(a){if(r.id=a.id,r.name=a.name,r.rarity=a.rarity,r.maxLevel=a.maxLevel,e.level?(r.level=e.level,r.level>r.maxLevel&&(r.level=r.maxLevel)):r.level=1,t){if(r.attack=a.attack,r.health=a.health,r.cost=a.cost,r.set=a.set,r.card_type=a.card_type,r.type=a.type,r.sub_type=a.sub_type||[],r.skill=a.skill,1<r.level)for(var n in a.upgrades){var i=a.upgrades[n];if(void 0!==i.cost&&(r.cost=i.cost),void 0!==i.health&&(r.health=i.health),void 0!==i.attack&&(r.attack=i.attack),void 0!==i.desc&&(r.desc=i.desc),0<i.skill.length&&(r.skill=i.skill),n==r.level)break}var s=e.runes;s&&(r.skill=r.skill.slice(),o(r,s),f(r.skill,s))}}else r.id=void 0,r.name=void 0,r.card_type=void 0,r.set=void 0,r.type=void 0,r.sub_type=[],r.level=void 0,r.maxLevel=void 0,t&&(r.skill=[]);return r},byIdWithBgeApplied:function(e,t,a){return t=t||SIMULATOR.battlegrounds.onCreate,n(e,t,null,a)},makeBattleground:t,applyDefaultStatuses:r},a={attack_berserk:0,attack_valor:0,attack_rally:0,attack_weaken:0,attack_corroded:0,corrosion_timer:0,mark_target:0,barrier_ice:0,corroded:0,enfeebled:0,enraged:0,envenomed:0,heartseeker:0,imbued:0,invisible:0,nullified:0,poisoned:0,protected:0,scorched:0,warded:0,jammed:!1,jammedSelf:!1,silenced:!1,valor_triggered:!1,dualstrike_triggered:!1,ondeath_triggered:!1,reanimated:!1};function r(e){for(var t in e.removeImbue(),e.enhanced={},a)e[t]=a[t]}function o(e,t){e.runes||(e.runes=[]);for(var a=0,r=t.length;a<r;a++){var n=t[a].id,i=d.getRune(n).stat_boost;for(var s in e.runes.push({id:n,stat_boost:i}),i){var l=i[s];"skill"===s||(isNaN(l)&&(l=Math.max(Math.ceil(e[s]*l.mult),l.min_bonus||1)),e[s]+=parseInt(l))}}}function n(e,t,a,r){var n=l.loadCard(e.id);if(n){n.skill||(n.skill=[]);var i=s(n,e.level,e.runes,t,a,r);return e.priority&&(i.priority=e.priority),i}return console.log(e.id+" not found"),(n={}).id=e.id,n.level=e.level,n.name=void 0,n.health=void 0,n.skill=[],n}function f(e,t,a){if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r].id,s=RUNES[i].stat_boost;for(var l in s){var d=s[l];if("skill"===l)for(var o=d.id,c=d.x,u=d.mult,f=0;f<e.length;f++){var h=e[f];if(h.id===o&&(h.all||0)==(d.all||0)){h=y.copySkill(h),!c&&u&&(c=Math.ceil(h.x*u)),d.min_bonus&&(c=Math.max(c,d.min_bonus)),c&&(h.x+=parseInt(c)*a),d.c&&(h.c-=Math.min(h.c,parseInt(d.c)*a)),h.boosted=!0,e[f]=h;break}}}}}var i,s=function(){var u;function k(e,t){return n({id:e.id,level:e.level})[t]}function g(e,t,a){for(var r in t){var n=t[r];n.x&&((n=y.copySkill(n)).x+=Math.ceil(n.x*a),n.boosted=!0,t[r]=n,e.highlighted.push(n.id))}}for(var e in u={p:null,health_left:0,timer:0,key:void 0,isCommander:function(){return"1"==this.card_type},isAssault:function(){return"2"==this.card_type},isTrap:function(){return"3"==this.card_type},isAlive:function(){return 0<this.health_left},isDamaged:function(){return this.health_left<this.health},isActive:function(){return 0==this.timer},isActiveNextTurn:function(){return this.timer<=1},isInactive:function(){return 1<=this.timer},isUnjammed:function(){return!this.jammed},isUnsilenced:function(){return!this.silenced},imbue:function(e){this.imbued||(this.imbued={});var t,a=this.imbued,r=e.id;switch(SKILL_DATA[r].type){case"toggle":return this[r]=!0,void(this.imbued[r]=1);case"passive":return this[r]+=parseInt(e.x),void(this.imbued[r]=(this.imbued[r]||0)+e.x);case"flurry":return void(this.flurry||(this.flurry=e,this.flurry.countdown=0,this.imbued.flurry=!0));case"onDeath":t="onDeathSkills";break;case"earlyActivation":t="earlyActivationSkills";break;case"activation":default:t="skill"}if(void 0===a[t]){var n=this[t];a[t]=n.length,this[t]=n.slice()}this[t].push(e)},scorch:function(e){var t=this.scorched;t?(t.amount+=e,t.timer=2):this.scorched={amount:e,timer:2}},removeImbue:function(){var e=this.imbued;if(e){for(var t in e){var a=e[t];"skill"===t||"earlyActivationSkills"===t||"onDeathSkills"===t?this[t]=this[t].slice(0,a):this[t]-=a}this.imbued=0}},hasSkill:function(e,t){var a;switch(SKILL_DATA[e].type){case"toggle":case"passive":case"flurry":return this[e];case"onDeath":a=this.onDeathSkills;break;case"earlyActivation":a=this.earlyActivationSkills;break;case"activation":default:a=this.skill}for(var r in a){var n=a[r];if(n.id===e&&(void 0===t||(n.all||0)==t))return!0}return!1},hasAttack:function(){return 0<this.adjustedAttack()},attackPlusBuffs:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor},adjustedAttack:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor-this.attack_weaken-this.attack_corroded},permanentAttack:function(){return this.attack+this.attack_berserk+this.attack_valor},isInFaction:function(e){if(void 0===e)return 1;var t=e.split(",");if(t.length<=1)return this.type==e?1:0<=this.sub_type.indexOf(e.toString())?1:0;for(var a=0;a<t.length;a++)if(!this.isInFaction(t[a]))return 0;return 1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0},addRunes:function(e){o(this,e)}},SKILL_DATA){var t=SKILL_DATA[e].type;"passive"===t?u[e]=0:"toggle"===t&&(u[e]=!1)}return r(u),function(e,t,a,r,n,i){t||(t=1);var s=Object.create(u);s.id=e.id,s.name=e.name,s.attack=e.attack,s.health=e.health,s.maxLevel=e.maxLevel,s.level=t>s.maxLevel?s.maxLevel:t,s.cost=e.cost,s.rarity=e.rarity,s.card_type=e.card_type,s.type=e.type,s.sub_type=e.sub_type||[],s.set=e.set;var l,d=e.skill;if(1<s.level)for(var o in e.upgrades)if(void 0!==(l=e.upgrades[o]).cost&&(s.cost=l.cost),void 0!==l.health&&(s.health=l.health),void 0!==l.attack&&(s.attack=l.attack),void 0!==l.desc&&(s.desc=l.desc),0<l.skill.length&&(d=l.skill),o==s.level)break;if(d=d.slice(),r&&r.length&&function(t,e,a,r){t.highlighted=[];for(var n=0;n<a.length;n++){var i=a[n];if("statChange"==i.modifierType&&!r)for(var s=0;s<i.effects.length;s++){var l=i.effects[s];t.isInFaction(l.y)&&Object.keys(l).forEach(function(e){t[e]=l[e]})}}}(s,0,r,i),a){s.addRunes(a);var c=1;r&&r.forEach(function(e){"runeMultiplier"==e.modifierType&&e.effects.forEach(function(e){s.isInFaction(e.y)&&(c=parseInt(e.mult))})}),f(d,a,c)}else s.runes=[];return r&&r.length&&function(e,t,a,r){e.highlighted=[];for(var n=0;n<a.length;n++){var i=a[n];if("evolve_skill"===i.modifierType)for(var s=0;s<i.effects.length;s++){var l=i.effects[s];for(var d in t){var o=t[d];o.id==l.id&&o.all==l.all&&((o=y.copySkill(o)).id=l.s,o.boosted=!0,t[d]=o,e.highlighted.push(o.id))}}else if("add_skill"===i.modifierType)for(s=0;s<i.effects.length;s++){var c=i.effects[s];if(e.isInFaction(c.y)){if(c.rarity&&e.rarity!=c.rarity)continue;var u={};if(u.id=c.id,u.x=c.x||0,c.mult)if(c.base){var f=k(e,c.base);u.x+=Math.ceil(c.mult*f)}else u.mult=c.mult;if(u.z=c.z,u.c=c.c,u.s=c.s,u.all=c.all,c.card&&(u.card=c.card),c.level&&(u.level=c.level),u.boosted=!0,c.mult&&c.base&&0==u.x)continue;t.push(u),e.highlighted.push(u.id)}}else if("scale_attributes"!==i.modifierType||r){if("scale_stat"===i.modifierType&&!r)for(s=0;s<i.effects.length;s++)h=i.effects[s],e.isInFaction(h.y)&&(e[i.scaledStat]+=Math.ceil(k(e,h.base)*h.mult))}else for(var s=0;s<i.effects.length;s++){var h=i.effects[s];if(e.isInFaction(h.y)){var p=h.mult,v=Math.ceil(e.attack*p);e.attack+=v;var m=Math.ceil(e.health*p);e.health+=m,g(e,t,p)}}}}(s,d,r,i),n&&g(s,d,n),y.copySkills(s,d),s}}(),t=((i=function(e,t,a){this.name=e,y.copySkills(this,[t],a)}).prototype={p:null,name:null,runes:[],isCommander:function(){return!1},isAssault:function(){return!1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0}},function(e,t,a){return new i(e,t,a)});return e}),define("unitInfo",["cardApi"],function(r){"use strict";function e(e,t,a){var r={id:Number(e),level:Number(t),runes:[]};return a&&(r.runes=a),r}function a(e){return e.runes.length&&e.runes[0].id||0}return{areEqual:function(e,t){return!e==!t&&e.id===t.id&&e.level===t.level&&a(e)===a(t)},getEnhancement:function(e,t,a){var r=e.enhanced,n=r&&r[t]||0;n<0&&(n=Math.ceil(a*-n));return n},initializeUnit:function(e,t,a){e.owner=t,e.timer=e.cost,e.health_left=e.health,r.applyDefaultStatuses(e),e.key=a,e.reusableSkills||e.resetTimers()},isImbued:function(e,t,a){var r;switch(SKILL_DATA[t].type){case"flurry":case"toggle":return e.imbued[t];case"passive":return e[t]===e.imbued[t];case"onDeath":r="onDeathSkills";break;case"earlyActivation":r="earlyActivationSkills";break;case"activation":default:r="skill"}return void 0!==e.imbued[r]&&a>=e.imbued[r]},create:e,defaultCommander:e(202,1)}}),define("cardUI",["cardApi","cardInfo","runeApi","factions","unitInfo"],function(h,M,O,j,p){"use strict";var t="";function r(e,t,a){var r=[],n=h.byId(e.commander);r.push(m(n,!1,!1));for(var i=0,s=e.deck.length;i<s;i++){var l=e.deck[i];if(a)var d=h.byIdWithBgeApplied(l,a);else d=h.byId(l);r.push(m(d,!1,!1))}if(!t)for(;i<15;i++)r.push(q("card blank"));return r}function s(e,t,a,r){var n,i;a=a||0;for(var s=1,l=0,d=[],o=0,c=e.length;o<c&&(!r||l<r);o++){var u=e[o],f=h.byId(u);p.areEqual(f,i)?s++:(a<=l&&(v(n,s),(n=m(f,t,!(s=1),o)).setAttribute("data-i",o),void 0!==u.index&&n.setAttribute("data-index",u.index),d.push(n)),i=f,l++)}return v(n,s),d}function i(e,t,a,r,n){t||(t=[]);var i=[];if(r){var s=document.createElement("h1");s.innerHTML="Turn: "+r+" (Currently at "+SIMULATOR.calculatePoints(!0)+" points)",i.push(s)}var l=q("field"),d=null,o=null;return n&&("player"===(n=n.isCommander()?-1:n.key).owner?d=n:o=n),l.appendChild(c(e.cpu,d)),l.appendChild(c(e.player,o)),i.push(l),i.push(function(e,t,a){for(var r=q("float-left hand"),n=0,i=e.length;n<i;n++){var s=e[n];if(s){var l=m(s,!1);0===n?l.classList.add("left"):2===n?l.classList.add("right"):2<n&&l.classList.add("inactive"),t&&l.addEventListener("click",function(e){return function(){choice=e,t(a)}}(n)),r.appendChild(l)}}return r}(t,a,r)),i.push(document.createElement("br")),i.push(document.createElement("br")),i}function c(e,t){var a=q("float-left"),r=m(e.commander,!1,!0);-1===t&&d(r),a.appendChild(r);var n=e.assaults;if(n)for(var i=0,s=n.length;i<s;i++){var l=n[i];r=m(l,!1,!0);l.timer&&r.classList.add("inactive"),t===i&&d(r),a.appendChild(r)}return a}function d(e){e.style.outline="5px solid LawnGreen"}function v(e,t){if(1<t){var a=q("multiplier","x"+t);a.setAttribute("data-count",t);var r=G(z("cardAssets")+"multiplier.png","multiplier");e.appendChild(r),e.appendChild(a)}}function m(e,t,a,r){var n=q("card");n.setAttribute("data-id",e.id),n.setAttribute("data-level",e.level);for(var i=e.runes,s=[],l={},d=0,o=i.length;d<o;d++){var c=i[d].id;s.push(i[d].id);var u=O.getRune(c);for(var f in u.stat_boost)"skill"==f&&(f=u.stat_boost.skill.id),l[f]=!0}var h=e.highlighted;if(h)for(d=0;d<h.length;d++){l[f=h[d]]=!0}n.setAttribute("data-runeids",s.join(","));var p=M.loadCard(e.id).picture;if(p){var v=document.createElement("i");0==p.indexOf("portrait_")?v.className="portrait portrait-"+p:v.className="sprite sprite-"+p,n.appendChild(v)}e.isCommander()&&n.classList.add("commander"),n.classList.add(j.names[e.type].toLowerCase());var m=q("card-name",(void 0!==e.uid?"("+e.uid+") ":"")+e.name),k=q("card-id","("+e.id+")");if(m.appendChild(k),n.appendChild(m),!e.isCommander()){if(0<=e.attack){if(a){e.isUnjammed()||n.classList.add("frozen");var g=q("card-attack",e.adjustedAttack().toString());e.adjustedAttack()>e.attack?g.classList.add("increased"):e.adjustedAttack()<e.attack?g.classList.add("decreased"):l.attack&&g.classList.add("increased")}else g=q("card-attack",e.attack.toString());n.appendChild(G(z("cardAssets")+"Attack.png","attack")),n.appendChild(g)}0<=e.cost&&(a?e.timer&&(n.appendChild(q("delay",e.timer)),n.appendChild(G(z("cardAssets")+"Timer.png","timer"))):(n.appendChild(q("delay",e.cost)),n.appendChild(G(z("cardAssets")+"Timer.png","timer"))))}if(0<=e.health){if(a){var y=q("card-health",e.health_left.toString());e.health_left<e.health?y.classList.add("decreased"):l.health&&y.classList.add("increased")}else{y=q("card-health",e.health.toString());l.health&&y.classList.add("increased")}n.appendChild(G(z("cardAssets")+"Health.png","health")),n.appendChild(y)}var b=q("card-skills"),_=q("card-skills-short");e.earlyActivationSkills&&R(e,b,_,e.earlyActivationSkills,a),R(e,b,_,e.skill,a),e.onDeathSkills&&R(e,b,_,e.onDeathSkills,a),function(t,a,r,n,i){Object.getOwnPropertyNames(SKILL_DATA).filter(function(e){return 0<=["passive","toggle"].indexOf(SKILL_DATA[e].type)}).forEach(function(e){!function(e,t,a,r,n,i){var s=r[n];if(s){var l={id:n,x:s,boosted:i[n]};e.appendChild(B(r,l,a)),e.appendChild(document.createElement("br")),t.appendChild(H(l.id))}}(t,a,n,r,e,i)});var e=r.flurry;e&&(t.appendChild(B(r,e,n)),t.appendChild(document.createElement("br")),a.appendChild(H(e.id)))}(b,_,e,a,l);var C,S,A=b.cloneNode(!0);if(A.className="card-skills-detailed",_.hasChildNodes()&&(t?(n.appendChild(_),n.appendChild(b)):n.appendChild(A)),n.appendChild(q("faction")),a){var D=function(e){var t=[];if(e.enfeebled){var a=K("enfeeble",e.enfeebled);t.push(a)}if(e.marked){var a=K("enfeeble",e.marked);t.push(a)}if(e.nullified){var a=K("nullify",e.nullified);t.push(a)}if(e.poisoned){var a=K("poison",e.poisoned);t.push(a)}if(e.scorched&&e.scorched.amount){var a=K("burn",e.scorched.amount);t.push(a)}var r=[];if(e.enraged){var a=K("enrage",e.enraged);t.push(a)}if(e.protected){var a=K("protect",e.protected);r.push(a)}if(e.invisible){var a=K("evade",e.invisible);r.push(a)}var n=[];if(0<t.length){for(var i=q("card-debuffs"),s=0,l=t.length;s<l;s++)i.appendChild(t[s]);n.push(i)}if(0<r.length){for(var d=q("card-buffs"),s=0,l=r.length;s<l;s++)d.appendChild(r[s]);n.push(d)}return n}(e);if(0<D.length){n.appendChild(q("hidden","..."));var w=q("card-statuses");for(d=0;d<D.length;d++){var I=D[d];w.appendChild(I)}n.appendChild(w)}}if(e.set){var L=(C=e.set,S=V[C],G(z("cardAssets")+S+".png"));L.className="set",n.appendChild(L)}var x=e.sub_type;if(x.length){var T=q("subfaction");for(d=0;d<x.length;d++){var F=x[d];if(F){var N=P(F);T.appendChild(N)}}n.appendChild(T)}if(0<e.rarity){if(e.maxLevel>Number(e.rarity)+2)var U=G(z("cardAssets")+"Level_"+e.rarity+"_"+e.maxLevel+"_"+e.level+".png");else U=G(z("cardAssets")+"Level_"+e.rarity+"_"+e.level+".png");if(U.className="level",9999<e.id){var E="1"===e.id.toString()[0]?"Dualfuse":"Quadfuse";(E=G(z("cardAssets")+E+".png")).className="fusion",n.appendChild(E)}n.appendChild(U)}else if(1<e.maxLevel){(U=G(z("cardAssets")+e.maxLevel+"_"+e.level+".png")).className="level",n.appendChild(U)}return n}function R(e,t,a,r,n){for(var i=0;i<r.length;i++){var s=r[i];t.appendChild(B(e,s,n,i)),t.appendChild(document.createElement("br")),a.appendChild(H(s.id))}}function B(e,t,a,r){var n=document.createElement("span");n.className="skill",n.appendChild(H(t.id));var i=p.isImbued(e,t.id,r),s=p.getEnhancement(e,t.id,t.x);i?n.classList.add("imbued"):(t.boosted||s)&&n.classList.add("increased"),t.all&&(n.innerHTML+=" All "),t.y&&n.appendChild(P(t.y)),t.s&&n.appendChild(H(t.s));var l=(0|t.x)+s;return l&&(n.innerHTML+=" "+l+" "),t.c&&(n.innerHTML+=t.c,a&&(n.innerHTML+=" ("+(t.countdown?t.countdown:"0")+")")),n}function H(e){var t=z("skills"),a=SKILL_DATA[e],r=G(t+=(a?a.icon:e)+".png");switch(e){case"weakenself":case"enlarge":r.classList.add("affect-self")}return r.title=a?a.name:e,r}function K(e,t){var a=document.createElement("span");return a.appendChild(H(e)),t&&(a.innerHTML+=t),a}function P(e){var t=j.names[e];return G(z("factions")+t+".png")}function z(e){return t+"res/"+e+"/"}function G(e,t){return $("<img>").addClass(t).attr("src",e)[0]}function q(e,t){return $("<div>").addClass(e).html(t)[0]}var V={1e3:"Basic",1100:"Legacy",7e3:"Basic",2e3:"Reward",2100:"Reward",3e3:"Premium",4e3:"BoxOnly",5e3:"Champion",5100:"Champion",9999:"StoryElements"},e={clearCardSpace:function(){$("#cardSpace").empty()},clearDeckSpace:function(){document.getElementById("deck").innerHTML=""},displayDeck:function(e,t){var a=$("#deck");return a.children().remove(),a.append(r(e,t)),a},cardToHtml:m,deckToHtml:r,displayCardList:function(e,t,a,r){var n=s(e,t,a,r),i=$("#cardSpace");return i.empty(),i.append(n),i},displayCards:function(e,t,a,r){var n=i(e,t,a,r);$("#cardSpace").children().remove().end().append(n)},doDisplayField:i,displayInventory:function(e){var t=s(e.deck),a=$("#deck");return a.children().remove(),a.append(s([e.commander])).append(t),a}};return Object.defineProperties(e,{assetsRoot:{get:function(){return t},set:function(e){t=e}}}),e}),define("base64",["cardInfo","unitInfo"],function(i,l){"use strict";var e={encodeHash:function(e){var t=[];e.commander&&t.push(e.commander);return t.concat(e.deck).map(r).join("")},decodeHash:function(e){for(var t,a={deck:[]},r=0;r<e.length;r+=5){var n=e.substr(r,5);(t=c(n))&&(i.loadCard(t.id)?!a.commander&&i.isCommander(t.id)?a.commander=t:a.deck.push(t):console.log("Could not decode '"+n+"' ("+t.id+")"))}a.commander||(a.commander=l.defaultCommander);return a},fromDecimal:u,toDecimal:f,fromUnitInfo:r},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!~",d={};for(var t in CARDS)if(t<1e4){var a=FUSIONS[t];(!a||Number(a)<1e4)&&(d[t]=!0)}var o=1e3;function r(e){var t=parseInt(e.id),a=parseInt(e.level)-1;if(d[t]){var r=Math.floor(a/7);a=a%7}else{r=Math.floor(t/1e4);t%=1e4}var n=0;e.runes.length&&(n=parseInt(e.runes[0].id),n%=5e3);var i=t;return u(i=(i=7*(i=3*i+r)+a)*o+n,5)}function c(e){var t=f(e),a=t%o,r=(t=(t-a)/o)%7,n=(t=(t-r++)/7)%3,i=t=(t-n)/3;d[i]?r+=7*n:0<n&&(i=Number(n+""+i));var s=l.create(i,r);return 0<a&&s.runes.push({id:a+5e3}),s}function u(e,t){for(var a="",r=0;r<t;r++){var n=e%64;a+=s[n],e=(e-n)/64}return a}function f(e){for(var t=0,a=e.length-1;0<=a;a--){t*=64,t+=s.indexOf(e[a])}return t}return e});
//# sourceMappingURL=shared.min.js.map