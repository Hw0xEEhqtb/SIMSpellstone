for(var skillID in SKILL_DATA){var skillInfo=SKILL_DATA[skillID];"flurry"===skillID?skillInfo.type="flurry":0<=["turnStart","onAttack","onDamaged","turnEnd"].indexOf(skillInfo.type)&&(skillInfo.type="passive")}var REVERSE_FUSIONS={};for(var id in FUSIONS){var fusion=FUSIONS[id];REVERSE_FUSIONS[fusion]=id}var inventory,base64=require("base64"),cardApi=require("cardApi"),runeApi=require("runeApi"),cardInfo=require("cardInfo"),factions=require("factions"),unitInfo=require("unitInfo"),urlHelpers=require("urlHelpers"),cardUI=require("cardUI"),storageAPI=require("storageAPI"),dataUpdater=require("dataUpdater"),loadCardCache=require("loadCardCache"),delayTutorial=!0,fromInventory=!1,deck=[];deck.commander=unitInfo.defaultCommander;var advancedFilters,optionsDialog,saveDeckDialog,loadDeckDialog,detailsDialog,form,$nameFilter,$deck,$cardSpace,inventoryMode=!(deck.deck=[]),attackHidden={},attackRanges=[],healthHidden={},healthRanges=[],delayHidden={},delayRanges=[],delayExclusions=[],skillFilters=[],skillExclusions=[],skillHidden={},skillFiltersAdv=[],skillHiddenAdv={},factionHidden={},subfactionHidden={},dualFactionHidden={},rarityFilters=[],rarityHidden={},typeFilters=[],typeHidden={},setFilters=[],setExclusions=[],setHidden={},fusionFilters=[],fusionHidden={},nameHidden={},allCards=CARDS,showUpgrades=!1,units=[],unitsShown=[],unitsFiltered=[],initDeckBuilder=function(){urlHelpers.paramDefined("fromSim")||($("#header").load("templates/header.html",function(){$("#header").show(),"undefined"!=typeof showTutorial&&$("#help").click(showTutorial)}),$.holdReady(!0),$("#footer").load("templates/footer.html",function(){$("#footer").show(),$.holdReady(!1)})),setupPopups(),stopPropagation("hash"),$("body").addClass("loading"),addDeckEventHandlers($("#deck")),addLibraryEventHandlers($("#cardSpace")),$(window).resize(onResize),window.onwheel=changePage,window.oncontextmenu=hideContext,$("#rows").val(storageAPI.getField("deckBuilder","rows",3)),$("#rows").bind("change",function(){storageAPI.setField("deckBuilder","rows",$("#rows").val())}),$nameFilter=$("#nameFilter").keypress(function(e){13==e.which&&(1==unitsFiltered.length&&addUnitToDeck(unitsFiltered[0],$cardSpace.children()[0]),e.preventDefault())}).autocomplete({source:[]});$("#deck").sortable({items:".card:not(.commander):not(.blank)",tolerance:"intersect",helper:function(e,t){return t.clone()},start:function(e,t){var a=t.placeholder.index()-1;t.item.data("last_pos",a),$(t.item).hide()},change:function(e,t){var a=t.item.index(),i=t.item.data("last_pos")-1,n=t.placeholder.index();a<n&&n--,highlighted=n,t.item.data("last_pos",n),n--;var r=deck.deck;r.splice(n,0,r.splice(i,1)[0]),updateHash(),updateHighlights()}});inventory=urlHelpers.paramValue("inventory")||inventory,$("[name=rarity]").click(function(e){onClickFilter(e,filterRarity,e.altKey)}),$("[name=faction]").click(function(e){onClickFilter(e,filterFaction,e.altKey)}),$("[name=subfaction]").click(function(e){onClickFilter(e,filterSubfaction,e.altKey)}),$("[name=delay]").click(function(e){onClickFilter(e,filterDelay,e.altKey)}),$("[name=set]").click(function(e){onClickFilter(e,filterSet,e.altKey)}),$("#dualfaction").click(function(e){onClickFilter(e,filterDualFaction,e.altKey)}),urlHelpers.paramDefined("spoilers")||urlHelpers.paramDefined("latestCards")?($("#loadingSplash").html("Checking for New Cards..."),updateGameData()):(loadCardCache(),setTimeout(loadCards,1)),urlHelpers.paramDefined("unlimited")&&($deck=$("#deck"),toggleInventoryMode()),$("#graph-accordion").click(updateGraphs)},makeUnitKey=function(e){var t=e.id+"_"+e.level;return e.runes&&e.runes.length&&(t+="_"+e.runes[0].id),t};function updateGameData(){setTimeout(dataUpdater.updateData,1,loadCards,!0)}var loadCards=function(){allCards=CARDS,$("#loadingSplash").html("Loading..."),drawAllCards(),$("body").removeClass("loading"),checkTutorial()},setupPopups=function(){stopPropagation("advancedFilters"),stopPropagation("unitOptions"),$(".accordion").accordion({collapsible:!0,heightStyle:"content"}),$(".start-closed").accordion("option","active",!1).show(),urlHelpers.paramDefined("spoilers")&&$("#deck-container, #filter-container").accordion("option","active",!1).show();for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++);advancedFilters=$("#advancedFilters").dialog({autoOpen:!1,width:150,minHeight:20,modal:!0,resizable:!1,buttons:{OK:function(){filterAdvanced(advancedFilters.skill),advancedFilters.dialog("close")},Cancel:function(){advancedFilters.dialog("close")}},open:closeDialogOnOverlayClick}),optionsDialog=$("#unitOptions").dialog({autoOpen:!1,width:250,minHeight:20,modal:!0,resizable:!1,buttons:{OK:function(){disableTracking=!1,modifyCard(optionsDialog),updateHash(),optionsDialog.dialog("close"),disableTracking=!1},Cancel:function(){resetCard(optionsDialog),optionsDialog.dialog("close"),disableTracking=!1}},open:closeDialogOnOverlayClick}).bind("change",function(){modifyCard(optionsDialog)});var a=$('input[type="image"]:not(.skill-filter)');for(t=0;t<a.length;t++){var i=a[t],n='<div class="tooltip">'+i.getAttribute("title")+"</div>";i.removeAttribute("title");var r='<div style="display:inline; position:relative; overflow:visible;">'+i.outerHTML+n+"</div>";i.outerHTML=r}saveDeckDialog=$("#saveDeckDialog").dialog({autoOpen:!1,modal:!0,resizable:!1,buttons:{Save:function(){var e=$("#saveDeckName").val(),t=$("#hash").val();storageAPI.saveDeck(e,t),saveDeckDialog.dialog("close")},Cancel:function(){saveDeckDialog.dialog("close")}},open:closeDialogOnOverlayClick}),loadDeckDialog=$("#loadDeckDialog").dialog({autoOpen:!1,minWidth:320,modal:!0,resizable:!1,buttons:{Delete:function(){var e=$("#loadDeckName").val();storageAPI.deleteDeck(e)},Load:function(){var e=$("#loadDeckName").val(),t=storageAPI.loadDeck(e);loadDeckDialog.onloaded(t),loadDeckDialog.dialog("close")},Cancel:function(){loadDeckDialog.dialog("close")}},open:closeDialogOnOverlayClick}),detailsDialog=$("#detailedView").dialog({minWidth:480,minHeight:330,padding:0,autoOpen:!1,modal:!0,resizable:!1,open:closeDialogOnOverlayClick,close:function(){cardDetailScope.visible=!1}})},closeDialogOnOverlayClick=function(){var t=$(this);jQuery(".ui-widget-overlay").bind("click contextmenu",function(e){t.dialog("close"),e.preventDefault()})},drawAllCards=function(){drawCardList(),drawDeck()},drawDeck=function(){var e=urlHelpers.paramValue("hash")||$("#hash").val();e&&hash_changed(e);var t=urlHelpers.paramValue("name");t&&setDeckName(t),doDrawDeck()};function doDrawDeck(){$deck=cardUI.draw_deck(deck,inventoryMode),updateHash()}function addDeckEventHandlers(e){addCardEvent(e,"mousedown",duplicate),addCardEvent(e,"mouseover",highlight),addCardEvent(e,"click",deckOnClick),addCardEvent(e,"contextmenu",showCardOptions)}function addLibraryEventHandlers(e){addCardEvent(e,"click",addToDeck),addCardEvent(e,"contextmenu",showDetails)}function addCardEvent(e,t,i){i&&e.on(t,function(e){var t=e.target.closest(".card");if(t&&!t.classList.contains("blank")){var a=$(t).attr("data-i");return i(e,t,a)}})}var showDetails=function(e,t){e.preventDefault();var a=getUnitFromCard(t);cardDetailScope.setUnit(a).$apply(),cardDetailScope.visible=!0,detailsDialog.dialog("option","position",{my:"center",at:"center",of:window}),detailsDialog.dialog("open"),detailsDialog.onloaded=setInventory};function duplicate(e,t){if(e.ctrlKey){var a=$(t);if(!inventoryMode){var i=a.parent().find(".blank");if(!i.length)return;i.first().remove()}var n=a.index(),r=deck.deck[n-1];a.clone().insertBefore(a.parent().children()[n]),deck.deck.splice(n,0,unitInfo.create(r.id,r.level,r.runes||[])),updateHash()}}function deckOnClick(e,t){e.ctrlKey||removeFromDeck(t)}var drawCardList=function(){if(units=[],unitsShown=[],inventory){fromInventory=!0;var e=(inventory=base64.decodeHash(inventory)).commander;inventory=inventory.deck,e&&!unitInfo.areEqual(e,unitInfo.defaultCommander)&&inventory.push(e);for(var t=0;t<inventory.length;t++)addInventoryUnit(inventory[t]);deck.commander=removeFromInventory(deck.commander);for(t=0;t<deck.deck.length;t++){var a=deck.deck[t];deck.deck[t]=removeFromInventory(a)}}else if(urlHelpers.paramDefined("spoilers"))for(var i in spoilers)addUnitLevels(i);else for(var i in allCards)i<1e4&&addUnit(i);sortCards(document.getElementById("sortField")),applyFilters()},page=0,pages=0;function doDrawCardList(e,t){var a=document.getElementById("skillDetails").checked,i=document.getElementById("cardSpace");t&&(page=0);var n=i.offsetWidth,r=document.getElementById("rows").value,l=~~(n/90);l*=r;for(var s=null,o=0,c=0,d=e.length;c<d;c++){var u=e[c];unitInfo.areEqual(u,s)||o++,s=u}if(1<(pages=Math.max(Math.ceil(o/l),1))){var h=l*page;pages<=page&&(h=l*(page=pages-1)),cardUI.draw_card_list(e,a,addToDeck,hideContext,h,h+l)}else page=0,cardUI.draw_card_list(e,a,addToDeck,hideContext);document.getElementById("pageNumber").innerHTML="Page "+(page+1)+"/"+pages;var f=($cardSpace=$("#cardSpace")).find(".card");if(f.length){var v=f[0],g=$(v),p=(v.offsetHeight+parseInt(g.css("marginTop"))+parseInt(g.css("marginBottom")))*parseInt(r);$cardSpace.css("min-height",p+"px")}}var onResize=function(){applyFilters(!0)}.debounce(50);function adjustTable(e){var t=e.parentElement,a=t.parentElement;if(e.offsetWidth<=2){if(1==a.childElementCount){for(var i=[],n=e.nextElementSibling;n;)i.push(n),n=n.nextElementSibling;if(i.length){for(var r=document.createElement("tr"),l=0;l<i.length;l++)r.appendChild(i[l]);a.appendChild(r)}}}else if(1<a.childElementCount&&(r=t.nextElementSibling)){for(l=0;l<r.childNodes.length;l++)t.appendChild(r.childNodes[l]);a.removeChild(r)}}function changePage(e){overInventory(e)&&(e.deltaY<0?pageUp():0<e.deltaY&&pageDown(),e.preventDefault())}function overInventory(e){for(var t=e.srcElement;null!=t;){if("cardSpace"===t.id)return!0;t=t.parentElement}}function pageUp(){--page<0?page=0:applyFilters(!0)}function pageDown(){pages<=++page?page--:applyFilters(!0)}var redrawCardList=function(e){sortCards(document.getElementById("sortField")),applyFilters(e)},addInventoryUnit=function(e){units.push(e),unitsShown.push(e)},addUnit=function(e,t){addUnitLevels(e),t?(t["1"+e]&&addUnitLevels("1"+e),t["2"+e]&&addUnitLevels("2"+e)):999<e&&(addUnitLevels("1"+e),addUnitLevels("2"+e))},addUnitLevels=function(e){var t=allCards[e];if(t)for(var a=1;a<=t.maxLevel;a++){var i=unitInfo.create(e,a);units.push(i),(showUpgrades||a==t.maxLevel)&&unitsShown.push(i)}},resetDeck=function(){hash_changed("oZ0IB")},disableTracking=!1,hash_changed=function(e){if(fromInventory&&(unitInfo.areEqual(deck.commander,unitInfo.defaultCommander)||unitsShown.push(deck.commander),unitsShown.push.apply(unitsShown,deck.deck),redrawCardList(!0)),void 0===e&&(e=document.getElementById("hash").value.trim()),setHash(e),updateSimulator(e),deck=base64.decodeHash(e),e||(deck.commander=null),fromInventory){unitInfo.areEqual(deck.commander,unitInfo.defaultCommander)||removeFromInventory(deck.commander);for(var t=0;t<deck.deck.length;t++)removeFromInventory(deck.deck[t]);applyFilters()}doDrawDeck(),generateLink()},setHash=function(e){$("#hash").val(e),generateLink()},sortDeck=function(){deck.deck.sort(function(e,t){var a,i=cardApi.byId(e),n=cardApi.byId(t);return(a=i.rarity-n.rarity)?a:(a=i.type-n.type)?a:(a=compareByID(e,t))?a:(a=e.level-t.level)?a:a=(e.runes.length?e.runes[0].id:0)-(t.runes.length?t.runes[0].id:0)}),doDrawDeck()},addToDeck=function(e,t){var a=getUnitFromCard(t);addUnitToDeck(a,t)},addUnitToDeck=function(e,t){var a=$(t).clone().find(".multiplier").remove().end();inventoryMode||(e=Object.assign({},e));var i=$("#deck");if(cardInfo.isCommander(e.id)){if(unitInfo.areEqual(deck.commander,e))return;deck.commander=e,replaceCard(i.find(".card").first(),a)}else{if(!inventoryMode&&15==deck.deck.length)return;deck.deck.push(e);var n=i.find(".blank");n.length?replaceCard(n.first(),a):i.append(a)}if(a=$(t),fromInventory){removeFromInventory(e);var r=a.find("div.multiplier");if(0<r.length){var l=Number(r.attr("data-count"))-1;1<l?(r.attr("data-count",l),r.html("x"+l)):a.find(".multiplier").remove()}else a.remove()}else a.stop().hide().fadeIn(100);updateHash()};function replaceCard(e,t){var a=e.hasClass("blank")?1e3:600;$(e).replaceWith(t),t.children().stop().hide().fadeIn(a).promise()}function removeFromInventory(e){for(var t=0;t<unitsShown.length;t++){var a=unitsShown[t];if(unitInfo.areEqual(e,a))return unitsShown.splice(t,1)[0]}return e}var removeFromDeck=function(e){var t,a=$(e),i=a.index();if(0==i){if(t=deck.commander,unitInfo.areEqual(t,unitInfo.defaultCommander))return;deck.commander=unitInfo.defaultCommander;var n=cardApi.byId(unitInfo.defaultCommander);replaceCard(a,$(cardUI.create_card_html(n)))}else t=deck.deck.splice(i-1,1)[0],a.remove(),deck.deck.length<15&&$deck.append("<div class='card blank'></div>");fromInventory&&(unitsShown.push(t),redrawCardList(!0)),updateHash()},highlight=function(e,t){highlighted=$(t).index(),updateHighlights()},highlighted=-1;function updateHighlights(){var e=document.getElementById("hash"),t=e.value,a=5*highlighted,i=a+5,n=t.substring(0,a)+"<span>"+t.substring(a,i)+"</span>"+t.substring(i),r=document.getElementById("hash_highlighter");r.innerHTML=n,$(r).width($(e).width())}var updateHash=function(){var e=base64.encodeHash(deck);setHash(e),updateHighlights(),addChange(e),updateSimulator(e),updateGraphs()},updateSimulator=function(e){},updateGraphs=function(){if(!$("#deckGraphs").is(":visible"))return null;for(var e=[0,0,0,0,0],t=[],a=[],i=[],n={},r={},l=0;l<deck.deck.length;l++){var s=deck.deck[l];e[(w=cardApi.byId(s)).cost]++,n[w.type]=(n[w.type]||0)+1,t.push(Number(w.attack)),a.push(Number(w.health)),i.push(Number(w.cost)),(C=w.sub_type).length||C.push(0);for(var o=0;o<C.length;o++){r[D=C[o]]=(r[D]||0)+1}}var c=function(e,t){return e-t};function d(e,t){return e+t}function u(e){return e.length?(e.reduce(d)/e.length).toFixed(0):0}t.sort(c),a.sort(c),i.sort(c);var h=u(t),f=u(a),v=u(i),g={width:300,height:200,axisY:{onlyInteger:!0},plugins:[Chartist.plugins.legend(),Chartist.plugins.tooltip()],series:{Attack:{lineSmooth:Chartist.Interpolation.simple()},Health:{lineSmooth:Chartist.Interpolation.simple()},Delay:{lineSmooth:Chartist.Interpolation.simple()}}};new Chartist.Line("#statChart",{series:[{name:"Attack",className:"ct-series-attack",data:t},{name:"Health",className:"ct-series-health",data:a},{name:"Delay",className:"ct-series-delay",data:i}]},g);g={width:300,height:200,axisY:{onlyInteger:!0},distributeSeries:!0};var p={labels:["0","1","2","3","4"],series:e};new Chartist.Bar("#delayChart",p,g);p={labels:["Attack","Health","Delay"],series:[{value:h,className:"ct-series-attack"},{value:f,className:"ct-series-health"},{value:v,className:"ct-series-delay"}]};new Chartist.Bar("#averagesChart",p,g).on("draw",function(e){var t,a,i,n;if("bar"===e.type&&(t=e.x1+.5*e.element.width(),a=e.y1+-1*e.element.height()-10,"0"!==(n=e.element.attr("ct:value"))))return(i=new Chartist.Svg("text")).text(n),i.addClass("ct-barlabel"),i.attr({x:t,y:a,"text-anchor":"middle"}),e.group.append(i)});g={width:450,height:200,labelInterpolationFnc:function(e,t){return p.series[t].value},plugins:[Chartist.plugins.legend()]};var m=[];p=[];for(var k in n){var y=factions.names[k];m.push(y),p.push({value:n[k],className:"ct-series-"+y})}p={labels:m,series:p};new Chartist.Pie("#factionChart",p,g),g.labelInterpolationFnc=function(e,t){return b.series[t].value};m=[];var b=[];for(var k in r){y=factions.names[k];m.push(y),b.push({value:r[k],className:"ct-series-"+y})}b={labels:m,series:b};new Chartist.Pie("#subfactionChart",b,g);for(t=[],a=[],i=[],n={},r={},l=0;l<deck.deck.length;l++){var w,C;s=deck.deck[l];e[(w=cardApi.byId(s)).cost]++,n[w.type]=(n[w.type]||0)+1,t.push(Number(w.attack)),a.push(Number(w.health)),i.push(Number(w.cost)),(C=w.sub_type).length||C.push(0);for(o=0;o<C.length;o++){var D;r[D=C[o]]=(r[D]||0)+1}}c=function(e,t){return e-t};function d(e,t){return e+t}function u(e){return e.length?(e.reduce(d)/e.length).toFixed(0):0}t.sort(c),a.sort(c),i.sort(c);h=u(t),f=u(a),v=u(i),g={width:300,height:200,axisY:{onlyInteger:!0},plugins:[Chartist.plugins.legend(),Chartist.plugins.tooltip()],series:{Attack:{lineSmooth:Chartist.Interpolation.simple()},Health:{lineSmooth:Chartist.Interpolation.simple()},Delay:{lineSmooth:Chartist.Interpolation.simple()}}};new Chartist.Line("#statChart",{series:[{name:"Attack",className:"ct-series-attack",data:t},{name:"Health",className:"ct-series-health",data:a},{name:"Delay",className:"ct-series-delay",data:i}]},g);var F=(cardApi.byId(deck.commander).health+a.reduce(function(e,t){return e+t},0))/15,I=(m=[],[]);for(l=0;l<=15;l++)m.push(130-l),I.push(Math.ceil(F*l));g={width:500,height:200,axisY:{onlyInteger:!0},plugins:[Chartist.plugins.legend(),Chartist.plugins.tooltip()]};new Chartist.Line("#hpplChart",{labels:m,series:[{name:"Health Lost",className:"ct-series-attack",data:I}]},g)},changeTracking=[],currentChange=-1;function addChange(e){disableTracking||(changeTracking[++currentChange]=e,changeTracking.length=currentChange+1,100<currentChange&&(currentChange--,changeTracking.splice(0,1)))}function KeyPress(e){var t=window.event?event:e;t.ctrlKey&&(90==t.keyCode?undo():89==t.keyCode&&redo())}function stopPropagation(e){document.getElementById(e).onkeydown=function(e){e.stopPropagation()}}function undo(){if(0<currentChange){var e=$(document.getElementById("hash"));e.on("focus",preventFocus),disableTracking=!0;var t=changeTracking[--currentChange];setHash(t),deck=base64.decodeHash(t),doDrawDeck(),e.off("focus"),disableTracking=!1}}function redo(){if(currentChange<changeTracking.length-1){var e=$(document.getElementById("hash"));e.on("focus",preventFocus),disableTracking=!0;var t=changeTracking[++currentChange];setHash(t),deck=base64.decodeHash(t),doDrawDeck(),e.off("focus"),disableTracking=!1}}document.onkeydown=KeyPress;var preventFocus=function(e){$(this).blur(),e.stopPropagation()},onClickFilter=function(e,t,a){var i=e.target;t(i,i.getAttribute("data-filter"),a)},onContextMenu=function(e){e.preventDefault();var t=e.target.getAttribute("data-filter");showAdvancedFilters(t)},filterAdvanced=function(e){for(var t={id:e,x:void 0,y:void 0,c:void 0,s:void 0,all:void 0},a=0;a<skillFiltersAdv.length;a++)if(skillFiltersAdv[a].id==e){skillFiltersAdv.splice(a,1);break}if("none"!=$("div#amount")[0].style.display){var i=parseInt($("#amount-min")[0].value),n=parseInt($("#amount-max")[0].value);isNaN(i)&&(i=0),isNaN(n)&&(n=99),t.x={min:i,max:n}}if("none"!=$("div#timer")[0].style.display){i=parseInt($("#timer-min")[0].value),n=parseInt($("#timer-max")[0].value);isNaN(i)&&(i=0),isNaN(n)&&(n=99),t.c={min:i,max:n}}if("none"!=$("div#faction")[0].style.display){var r=$("select#faction")[0].value;t.y="Generic"==r?-1:factions.IDs[r]}"none"!=$("div#skill")[0].style.display&&0<$("select#skill")[0].value.length&&(t.s=$("select#skill")[0].value),"none"!=$("label[for=all]")[0].style.display&&(t.all=$("select#all")[0].value);var l=$("input[name=skill][data-filter="+e+"]")[0].classList;l.add("selected-advanced"),skillFiltersAdv.push(t),l.contains("selected")&&(l.remove("selected"),skillFilters.splice(skillFilters.indexOf(e),1),checkBasicSkillFilters()),l.contains("excluded")&&(l.remove("excluded"),skillExclusions.splice(skillFilters.indexOf(e),1),checkBasicSkillFilters()),checkAdvancedFilters()},checkAdvancedFilters=function(){skillHiddenAdv={};for(var e=0;e<units.length;e++)for(var t=units[e],a=0;a<skillFiltersAdv.length;a++)hasSkillAdvanced(t,skillFiltersAdv[a])||(skillHiddenAdv[makeUnitKey(t)]=!0);for(var i in skillFiltersAdv)skillFiltersAdv[i];applyFilters()},filterSkill=function(e,t,a){if(e.classList.contains("selected"))e.classList.remove("selected"),skillFilters.splice(skillFilters.indexOf(t),1);else if(e.classList.contains("excluded"))e.classList.remove("excluded"),skillExclusions.splice(skillFilters.indexOf(t),1);else{if(e.classList.contains("selected-advanced")){e.classList.remove("selected-advanced");for(var i=0;i<skillFiltersAdv.length;i++)if(skillFiltersAdv[i].id==t){skillFiltersAdv.splice(i,1);break}return void checkAdvancedFilters()}a?(e.classList.add("excluded"),skillExclusions.push(t)):(e.classList.add("selected"),skillFilters.push(t))}checkBasicSkillFilters(),applyFilters()};function checkBasicSkillFilters(){if(skillHidden={},0<skillFilters.length+skillExclusions.length)for(var e=0;e<units.length;e++){for(var t=units[e],a=0;a<skillFilters.length;a++)if(!hasSkill(t,skillFilters[a])){skillHidden[makeUnitKey(t)]=!0;break}for(a=0;a<skillExclusions.length;a++)if(hasSkill(t,skillExclusions[a])){skillHidden[makeUnitKey(t)]=!0;break}}}var filterFaction=function(e,t){if(factionHidden={},e.classList.contains("selected"))e.classList.remove("selected"),e.checked=!1;else{e.classList.add("selected");for(var a=0,i=units.length;a<i;a++){var n=units[a];isInFaction(n,t)||(factionHidden[makeUnitKey(n)]=!0)}}var r=document.getElementsByName("faction");for(a=0;a<r.length;a++){var l=r[a];l!=e&&l.classList.remove("selected")}applyFilters()},filterName=function(e){var t=e.value.toLowerCase();if(nameHidden={},t)if(0===t.indexOf("[")||t.indexOf("]")-t.length==-1){0!==t.indexOf("[")&&(t=".*"+t),t.indexOf("]")-t.length!=-1&&(t+=".*");for(var a=new RegExp("^"+t.replace("[","").replace("]","")+"$"),i=0,n=units.length;i<n;i++){var r=(l=units[i]).id;a.test(r.toString())||(nameHidden[makeUnitKey(l)]=!0)}}else for(i=0,n=units.length;i<n;i++){var l=units[i],s=cardApi.byIdSlim(l,!0);s.name&&-1!=s.name.toLowerCase().indexOf(t)||(nameHidden[makeUnitKey(l)]=!0)}applyFilters()}.throttle(250),filterSubfaction=function(e,t,a){e.classList.contains("selected")||e.classList.contains("excluded")?(e.classList.remove("selected"),e.classList.remove("excluded"),e.checked=!1):a?(e.classList.add("excluded"),e.classList.remove("selected")):(e.classList.remove("excluded"),e.classList.add("selected")),subfactionHidden={};for(var i=$("[name=subfaction].selected").toArray().map(function(e){return e.attributes["data-filter"].value}),n=$("[name=subfaction].excluded").toArray().map(function(e){return e.attributes["data-filter"].value}),r=0,l=units.length;r<l;r++){for(var s=units[r],o=0;o<i.length;o++)isInSubfaction(s,i[o])||(subfactionHidden[makeUnitKey(s)]=!0);for(var c=0;c<n.length;c++)isInSubfaction(s,n[c])&&(subfactionHidden[makeUnitKey(s)]=!0)}applyFilters()},filterDualFaction=function(e,t,a){var i;if(e.classList.contains("selected")||e.classList.contains("excluded")?(e.classList.remove("selected"),e.classList.remove("excluded"),e.checked=!1):i=a?(e.classList.add("excluded"),e.classList.remove("selected"),!1):(e.classList.remove("excluded"),e.classList.add("selected"),!0),dualFactionHidden={},void 0!==i)for(var n=0,r=units.length;n<r;n++){var l=units[n];isDualFaction(l)!==i&&(dualFactionHidden[makeUnitKey(l)]=!0)}applyFilters()},filterAttack=function(e,t,a){if(attackHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var i=0;i<attackRanges.length;i++)if(attackRanges[i][0]==t){attackRanges.splice(i,1);break}}else e.classList.add("selected"),attackRanges.push([t,a]);if(0<attackRanges.length){i=0;for(var n=units.length;i<n;i++){for(var r=units[i],l=!0,s=0;s<attackRanges.length;s++){var o=attackRanges[s];if(isInRange(r,"attack",o[0],o[1])){l=!1;break}}l&&(attackHidden[makeUnitKey(r)]=!0)}}applyFilters()},filterHealth=function(e,t,a){if(healthHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var i=0;i<healthRanges.length;i++)if(healthRanges[i][0]==t){healthRanges.splice(i,1);break}}else e.classList.add("selected"),healthRanges.push([t,a]);if(0<healthRanges.length){i=0;for(var n=units.length;i<n;i++){for(var r=units[i],l=!0,s=0;s<healthRanges.length;s++){var o=healthRanges[s];if(isInRange(r,"health",o[0],o[1])){l=!1;break}}l&&(healthHidden[makeUnitKey(r)]=!0)}}applyFilters()},filterDelay=function(e,t,a){if(delayHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var i=0;i<delayRanges.length;i++)if(delayRanges[i]==t){delayRanges.splice(i,1);break}}else if(e.classList.contains("excluded")){e.classList.remove("excluded"),e.checked=!1;for(i=0;i<delayExclusions.length;i++)if(delayExclusions[i]==t){delayExclusions.splice(i,1);break}}else a?(e.classList.add("excluded"),delayExclusions.push(t)):(e.classList.add("selected"),delayRanges.push(t));if(0<delayExclusions.length){i=0;for(var n=units.length;i<n;i++){for(var r=units[i],l=!1,s=0;s<delayExclusions.length;s++){t=delayExclusions[s];if(isInRange(r,"cost",t,t)){l=!0;break}}l&&(delayHidden[makeUnitKey(r)]=!0)}}if(0<delayRanges.length)for(i=0,n=units.length;i<n;i++){for(r=units[i],l=!0,s=0;s<delayRanges.length;s++){t=delayRanges[s];if(isInRange(r,"cost",t,t)){l=!1;break}}l&&(delayHidden[makeUnitKey(r)]=!0)}applyFilters()},filterType=function(e,t){if(typeHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var a=0;a<typeFilters.length;a++)if(typeFilters[a]==t){typeFilters.splice(a,1);break}}else e.classList.add("selected"),typeFilters.push(t);if(0<typeFilters.length){a=0;for(var i=units.length;a<i;a++){for(var n=units[a],r=!0,l=0;l<typeFilters.length;l++){t=typeFilters[l];if(isInRange(n,"card_type",t,t)){r=!1;break}}r&&(typeHidden[makeUnitKey(n)]=!0)}}applyFilters()},filterFusion=function(e,t){if(fusionHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var a=0;a<fusionFilters.length;a++)if(fusionFilters[a]==t){fusionFilters.splice(a,1);break}}else e.classList.add("selected"),fusionFilters.push(t);if(0<fusionFilters.length){a=0;for(var i=units.length;a<i;a++){for(var n=units[a],r=n.id.toString(),l=(t=4<r.length?r[0]:"",!0),s=0;s<fusionFilters.length;s++)if(t==fusionFilters[s]){l=!1;break}l&&(fusionHidden[makeUnitKey(n)]=!0)}}applyFilters()},showAdvancedFilters=function(e){$("label[for=all]").hide(),$("div#amount").hide(),$("div#faction").hide(),$("div#skill").hide(),$("div#timer").hide(),$("#amount-min")[0].value=0,$("#amount-max")[0].value=99,$("#timer-min")[0].value=0,$("#timer-max")[0].value=99,$("select#faction")[0].value="",$("select#skill")[0].value="",$("select#all")[0].value=-1;for(var t=0;t<skillFiltersAdv.length;t++){var a=skillFiltersAdv[t];if(a.id==e){a.x&&($("#amount-min")[0].value=a.x.min,$("#amount-max")[0].value=a.x.max),a.c&&($("#timer-min")[0].value=a.c.min,$("#timer-max")[0].value=a.c.max),a.y&&-1==a.y&&($("select#faction")[0].value="Generic"),a.s&&($("select#skill")[0].value=a.s),a.all&&($("select#all")[0].value=a.all);break}}switch(e){case"absorb":case"armored":case"barrage":case"backlash":case"berserk":case"burn":case"corrosive":case"counter":case"counterburn":case"evade":case"evadebarrier":case"frost":case"fury":case"heartseeker":case"leech":case"nullify":case"pierce":case"poison":case"regenerate":case"scorchbreath":case"stasis":case"taunt":case"valor":$("div#amount").show();break;case"silence":$("div#amount").show(),$("div#faction").show();break;case"fervor":case"legion":case"reanimate":case"resurrect":$("div#amount").show(),$("div#faction").show(),$("div#timer").show();break;case"enrage":case"heal":case"protect":case"protect_ice":case"rally":$("div#amount").show(),$("label[for=all]").show(),$("div#faction").show();break;case"enfeeble":case"poisonstrike":case"strike":case"weaken":case"weakenself":$("div#amount").show(),$("label[for=all]").show();break;case"enhance":case"imbue":$("div#amount").show(),$("label[for=all]").show(),$("div#faction").show(),$("div#skill").show(),$("div#timer").show();break;case"jam":$("label[for=all]").show(),$("div#timer").show();break;case"flurry":$("div#timer").show();break;default:return null}return advancedFilters.dialog("option","position",{mw:"center",at:"center",of:$("[data-filter="+e+"]")[0]}),advancedFilters.dialog("open"),advancedFilters.skill=e,!1},showCardOptions=function(e,t){e.preventDefault();var a=!1,i=$(t).index()-1;if(i<0)var n=deck.commander;else n=deck.deck[i];optionsDialog.index=i;var r=cardApi.byId(n);$("#upgradeDiv").hide();var l=document.getElementById("upgrade");l.max=r.maxLevel,l.value=r.level,1<r.maxLevel&&($("#upgradeDiv").show(),a=!0);var s=document.getElementById("fusion");if(s.value=0,$("#fusionDiv").hide(),!r.isCommander()){var o=1;if(4<(c=r.id.toString()).length){o=parseInt(c[0])+1;var c=c.substring(1)}FUSIONS[c]&&(s.value=o,$("#fusionDiv").show(),a=!0)}return"none"==$("#upgradeDiv").css("display")||"none"==$("#fusionDiv").css("display")?$("#upgradeDiv").add("#fusionDiv").toggleClass("split",!1):$("#upgradeDiv").add("#fusionDiv").toggleClass("split",!0),showRunePicker(r)&&(a=!0),a&&(disableTracking=!0,optionsDialog.dialog("option","position",{my:"left",at:"right",of:t}),optionsDialog.dialog("open"),optionsDialog.unit=n,optionsDialog.originalUnit=$.extend({},n)),!1};function hideContext(e){return e.preventDefault(),!1}var showRunePicker=function(e){var t=document.getElementById("runeChoices");if(t.innerHTML='<option value=""></option>',optionsDialog.hiddenOptions=[],$("#runeChoicesDiv").hide(),3<=e.rarity&&!e.isCommander()){for(var a in RUNES){var i=RUNES[a];if(runeApi.canUseRune(e,i.id)){var n=document.createElement("option");n.appendChild(document.createTextNode(i.desc)),n.value=i.id,t.appendChild(n)}}return e.runes.length?document.getElementById("runeChoices").value=e.runes[0].id:document.getElementById("runeChoices").value="",0<t.childNodes.length&&($("#runeChoicesDiv").show(),!0)}return!1},toggleUnreleasedRunes=function(e){for(var t=optionsDialog.hiddenOptions,a=0,i=t.length;a<i;a++)t[a].hidden=!e.checked,t[a].disabled=!e.checked},modifyCard=function(e){if(void 0!==(a=e.unit)){var t=document.getElementById("runeChoices").value;a.runes=t?[{id:t}]:[]}else var a=deck.commander;a.level=document.getElementById("upgrade").value;var i=document.getElementById("fusion").value;if(i){i=(i-1).toString();var n=a.id.toString();4<n.length&&(n=n.substring(1)),0<=i&&(n=i+n),a.id=parseInt(n)}var r=cardApi.byId(a);showRunePicker(r),setCard(e.index,a),setHash(base64.encodeHash(deck))},resetCard=function(e){setCard(e.index,e.originalUnit),setHash(base64.encodeHash(deck))},setCard=function(e,t){e<0?deck.commander=t:deck.deck[e]=t;var a=cardUI.create_card_html(cardApi.byId(t),!1,!1);$deck.find(".card").eq(e+1).replaceWith(a)},filterSet=function(e,t,a){setHidden={};var i=null;if(e.classList.contains("selected")?(e.classList.remove("selected"),e.checked=!1,i="selected"):e.classList.contains("excluded")?(e.classList.remove("excluded"),e.checked=!1,i="excluded"):a?e.classList.add("excluded"):e.classList.add("selected"),t.split(",").forEach(function(e){switch(i){case"selected":setFilters.splice(setFilters.indexOf(e),1);break;case"excluded":setExclusions.splice(setExclusions.indexOf(e),1);break;default:a?setExclusions.push(e):setFilters.push(e)}}),0<setFilters.length+setExclusions.length)for(var n=0,r=units.length;n<r;n++){for(var l=units[n],s=0===setFilters.length,o=0;o<setFilters.length;o++){var c=setFilters[o];if(isInRange(l,"set",c,c)){s=!0;break}}if(s){var d=!1;for(o=0;o<setExclusions.length;o++){c=setExclusions[o];if(isInRange(l,"set",c,c)){d=!0;break}}}s&&!d||(setHidden[makeUnitKey(l)]=!0)}applyFilters()},filterRarity=function(e,t){if(rarityHidden={},e.classList.contains("selected")){e.classList.remove("selected"),e.checked=!1;for(var a=0;a<rarityFilters.length;a++)if(rarityFilters[a]==t){rarityFilters.splice(a,1);break}}else e.classList.add("selected"),rarityFilters.push(t);if(0<rarityFilters.length){a=0;for(var i=units.length;a<i;a++){for(var n=units[a],r=!0,l=0;l<rarityFilters.length;l++){t=rarityFilters[l];if(isInRange(n,"rarity",t,t)){r=!1;break}}r&&(rarityHidden[makeUnitKey(n)]=!0)}}applyFilters()},applyFilters=function(e,t){unitsFiltered=[];for(var a=[],i={},n=0,r=unitsShown.length;n<r;n++){var l=unitsShown[n],s=makeUnitKey(l);if(skillHidden[s]||factionHidden[s]||subfactionHidden[s]||attackHidden[s]||healthHidden[s]||delayHidden[s]||typeHidden[s]||fusionHidden[s]||setHidden[s]||nameHidden[s]||rarityHidden[s]||skillHiddenAdv[s]||dualFactionHidden[s]);else{unitsFiltered.push(l);var o=cardApi.byId(l);i[o.name]||(a.push(o.name),i[o.name]=!0)}}$nameFilter.autocomplete("option",{source:a}),t||doDrawCardList(unitsFiltered,!e)},hasSkill=function(e,t){for(var a=cardApi.byIdSlim(e,!0).skill,i=0,n=a.length;i<n;i++)if(t==a[i].id)return!0;return!1},hasSkillAdvanced=function(e,t){for(var a=cardApi.byIdSlim(e,!0).skill,i=0,n=a.length;i<n;i++){var r=a[i];if(t.id==r.id){if(t.x&&(r.x<t.x.min||r.x>t.x.max))continue;if(t.c&&(r.c<t.c.min||r.c>t.c.max))continue;if(-1==t.y&&r.y)continue;if(0<t.y&&r.y!=t.y)continue;if(t.s&&r.s!=t.s)continue;if(-1<t.all&&(r.all||"0")!=t.all)continue;return!0}}return!1},clearFilters=function(){attackHidden={},attackRanges=[],healthHidden={},healthRanges=[],delayHidden={},delayRanges=[],delayExclusions=[],skillFilters=[],skillExclusions=[],skillHidden={},skillFiltersAdv=[],skillHiddenAdv={},factionHidden={},subfactionHidden={},dualFactionHidden={},rarityFilters=[],rarityHidden={},typeFilters=[],typeHidden={},setFilters=[],setExclusions=[],setHidden={},fusionFilters=[],fusionHidden={},nameHidden={},$(".selected").removeClass("selected"),$(".excluded").removeClass("excluded"),$(".selected-advanced").removeClass("selected-advanced"),$("#nameFilter").val(""),applyFilters()},isInFaction=function(e,t){var a=factions.IDs[t];return cardApi.byIdSlim(e,!0).type==a},isInSubfaction=function(e,t){var a=factions.IDs[t],i=cardApi.byIdSlim(e,!0);return void 0===a?0===i.sub_type.length:0<=i.sub_type.indexOf(a.toString())},isDualFaction=function(e){return 1<cardApi.byIdSlim(e,!0).sub_type.length},isInRange=function(e,t,a,i){var n=cardApi.byIdSlim(e,!0)[t];return void 0!==n&&(!(0<=a&&n<a)&&!(0<=i&&i<n))},toggleSkillDetails=function(){applyFilters(!0)},toggleUpgrades=function(e){showUpgrades=e.checked,$("body").addClass("loading"),setTimeout(function(){drawCardList(),$("body").removeClass("loading"),applyFilters(!1)},1)};function sortAndDraw(e){doSort(e),applyFilters()}var sortCards=function(e){doSort(e)};function doSort(e){var r=e.value;unitsShown.sort(function(e,t){var a=cardInfo.isCommander(t.id)-cardInfo.isCommander(e.id);if(0!=a)return a;if("id"===r)return compareByID(e,t);var i=cardApi.byId(e),n=cardApi.byId(t);return 0!=(a="sub_type"===r?compareBySubfactions(i,n):(i[r]||0)-(n[r]||0))?a:compareByID(e,t)})}function quicksort(e,t){if(0===e.length)return[];for(var a=[],i=[],n=e[0],r=1;r<e.length;r++)t(e[r],n)<0?a.push(e[r]):i.push(e[r]);return quicksort(a,t).concat(n,quicksort(i,t))}var compareByID=function(e,t){var a,i=e.id,n=t.id;return 0!=(a=i%1e4-n%1e4)?a:0!=(a=i-n)?a:0!=(a=e.level-t.level)?a:sortByRunes(e,t)};function compareBySubfactions(e,t){for(var a=e.sub_type,i=t.sub_type,n=Math.max(a.length,i.length),r=0;r<n;r++){var l=(a[r]||-1)-(i[r]||-1);if(l)return l}return 0}function sortByRunes(e,t){var a=e.runes.length-t.runes.length;return 0!=a?a:e.runes.length?e.runes[0].id-t.runes[0].id:0}var getUnitFromCard=function(e){for(var t={id:e.attributes.getNamedItem("data-id").value,level:e.attributes.getNamedItem("data-level").value},a=e.attributes.getNamedItem("data-runeids").value.split(","),i=[],n=0,r=a.length;n<r;n++){var l=a[n];0<l&&i.push({id:l})}var s=e.attributes.getNamedItem("data-index");return s&&(t.index=s.value),t.runes=i,t},skillStyle=document.createElement("style");function setDeckName(e){document.getElementById("version_label").innerHTML+=" "+e}function saveDeck(){var e=$("#hash").val();$("#saveDeckName").val("");var t=storageAPI.getSavedDecks();for(var a in t){if(e==t[a]){$("#saveDeckName").val(a);break}}saveDeckDialog.dialog("option","position",{my:"center",at:"center",of:window}),saveDeckDialog.dialog("open")}function loadDeck(){$('label[for="loadDeckName"]').html("<strong>Deck:</strong>"),loadDeckDialog.dialog("option","position",{my:"center",at:"center",of:window}),loadDeckDialog.dialog("open"),loadDeckDialog.onloaded=hash_changed}function loadInventory(){$('label[for="loadDeckName"]').html("<strong>Inventory:</strong>"),loadDeckDialog.dialog("option","position",{my:"center",at:"center",of:window}),loadDeckDialog.dialog("open"),loadDeckDialog.onloaded=setInventory}function setInventory(e){inventory=e,drawCardList(),generateLink()}function toggleInventoryMode(){if(inventoryMode=!inventoryMode)$("#inventoryMode").val("Switch to Deck Builder"),$deck.find(".card.blank").remove(),$deck.sortable("disable"),doDrawDeck();else{$("#inventoryMode").val("Switch to Inventory Builder");for(var e=$deck.find(".card").length;e<16;e++)$deck.append("<div class='card blank'></div>");$deck.sortable("enable"),doDrawDeck()}generateLink()}function generateLink(){var e=[],t=urlHelpers.paramValue("name"),a=$("#hash").val();t&&e.push("name="+t),a&&e.push("hash="+a),inventory&&e.push("inventory="+base64.encodeHash({commander:unitInfo.defaultCommander,deck:inventory})),inventoryMode&&e.push("unlimited"),urlHelpers.paramDefined("spoilers")&&e.push("spoilers");var i="http://thesench.github.io/SIMSpellstone/DeckBuilder.html";e.length&&(i+="?"+e.join("&")),$("#link").attr("href",i).text(i)}function externalData(e,t){setHash(e),inventory=t}skillStyle.type="text/css",document.getElementsByTagName("head")[0].appendChild(skillStyle),function(t){"use strict";var a,i=require("storageAPI");try{a=t.module("simulatorApp")}catch(e){a=t.module("simulatorApp",[])}a.controller("DeckStorageCtrl",["$scope","$window",function(e,t){e.getSavedDecks=i.getSavedDecks,e.keys=function(e){return e?Object.keys(e):[]}}])}(angular),function(e){"use strict";var s=require("cardInfo"),o=(require("skillApi"),require("factions")),c=["","Common","Rare","Epic","Legendary","Mythic"];function d(e){var t=e.id,a=e.level,i=CARDS[t],n=Object.assign({},i);if(1<a&&1<a)for(var r in i.upgrades){var l=i.upgrades[r];if(void 0!==l.cost&&(n.cost=l.cost),void 0!==l.health&&(n.health=l.health),void 0!==l.attack&&(n.attack=l.attack),void 0!==l.desc&&(n.desc=l.desc),0<l.skill.length&&(n.skill=l.skill),r==a)break}return n.level=a,n.maxLevel=i.maxLevel,n}e.module("simulatorApp").controller("CardDetailsCtrl",["$scope","$window",function(i,a){var n;(a.cardDetailScope=i).id&&i.level&&(i.unit=a.unitInfo.create(i.id,i.level),i.card=d(i.unit)),i.setUnit=function(e){var t;return i.id=e.id,i.level=e.level,i.unit=a.unitInfo.create(i.id,i.level),i.card=d(i.unit),i.releaseDate=t=(t=i.card.hidden_until)?(t=new Date(Number(t))).getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear():"",this},i.visible=!1,i.getCardImage=function(){var e=new Image;return e.src="res/cardImagesLarge/"+s.loadCard(i.card.id).picture+".jpg",e.onerror=function(){330!==this.naturalHeight&&(this.src=th.replace("ImagesLarge","Images"),this.onload=null),$modal.find("img").attr("src",this.src)},"res/cardImagesLarge/"+s.loadCard(i.card.id).picture+".jpg"},i.imageSrc="res/cardImagesLarge/NotFound.jpg",i.$watch("card.id",function(e,t){if(e){var a=".jpg";s.isCommander(e)&&(a=".png"),(n=new Image).onerror=function(){this.onerror=function(){this.onerror=null,this.src="res/cardImagesLarge/NotFound.jpg"},this.src=this.src.replace("ImagesLarge","Images")},n.onload=function(){this.onerror=null,this.onload=null,i.imageSrc=n.src,i.$apply()},n.src="res/cardImagesLarge/"+s.loadCard(e).picture+a}else i.imageSrc="res/cardImagesLarge/NotFound.jpg"}),i.isCommander=function(){return a.cardInfo.isCommander(i.id)},i.commanderClass=function(){return i.isCommander()?"commander "+i.getFaction(i.card.type).toLowerCase():""},i.getRarityString=function(){return c[i.card.rarity]},i.fontSize=function(){var e=$("#rarity-string").text().length;return{"font-size":Math.ceil(71e3/(e*e))+"px"}},i.showRarity=function(){var e=i.card;return 0<e.rarity||1<e.maxLevel},i.getRarityIcon=function(){var e=i.card;return 0<e.rarity?"res/cardAssets/Level_"+e.rarity+(e.maxLevel>Number(e.rarity)+2?"_"+e.maxLevel:"")+"_"+e.level+".png":1<e.maxLevel?"res/cardAssets/"+e.maxLevel+"_"+e.level+".png":void 0};var t=i.previousFusion=function(){var e=a.FUSIONS;for(var t in e)if(e[t]===i.id)return t;return!1},r=i.nextFusion=function(){return a.FUSIONS[i.id]};i.previousLevel=function(){return 1<i.card.level},i.nextLevel=function(){return i.card.level<i.card.maxLevel};var e=i.getFusion=function(){var e=Number(i.id);return Math.floor(e/1e4)+1};i.fusionText=function(){return{1:"Single",2:"Dual",3:"Quad"}[e()]},i.keyPress=function(e){var t;switch(e.which){case 37:t="decrementLevel";break;case 38:t="incrementFusion";break;case 39:t="incrementLevel";break;case 40:t="decrementFusion"}t&&(i[t](),e.preventDefault(),e.stopPropagation())},i.isFused=function(){return 1<e()},i.getFusionIcon=function(){return"res/cardAssets/"+(2===e()?"Dualfuse":"Quadfuse")+".png"},i.getSkillIcon=function(e){var t=SKILL_DATA[e];return"res/skills/"+(t?t.icon:e)+".png"},i.getSkillDescription=function(e){var t=SKILL_DATA[e];return t?t.desc||t.name:e};var l={1e3:"Basic",7e3:"Basic",2e3:"Reward",3e3:"Premium",4e3:"BoxOnly",9999:"StoryElements"};i.getSetIcon=function(){var e=l[i.card.set];return e||(e=l[9999]),"res/cardAssets/"+e+"_64x64.png"},i.getFaction=function(e){var t=o.names[e];return"Tower"===t&&(t=""),t},i.decrementFusion=function(){var e=t(Number(i.id));e&&(i.id=e,i.unit.id=i.id,i.card=d(i.unit),i.level>i.card.maxLevel&&(i.level=i.card.maxLevel,i.unit.level=i.level,i.card=d(i.unit)))},i.incrementFusion=function(){var e=r(Number(i.id));if(e){var t=i.level==i.card.maxLevel;i.id=e,i.unit.id=i.id,i.card=d(i.unit),t&&i.level<i.card.maxLevel&&(i.level=i.card.maxLevel,i.unit.level=i.level,i.card=d(i.unit))}},i.decrementLevel=function(){i.level=Number(i.level),1<i.level&&i.level--,i.unit.level=i.level,i.card=d(i.unit)},i.incrementLevel=function(){i.level=Number(i.level),i.level<i.card.maxLevel&&i.level++,i.unit.level=i.level,i.card=d(i.unit)}}]).directive("ngRightClick",["$parse",function(n){return{link:function(t,e,a){var i=n(a.ngRightClick);e.contextmenu(function(e){t.$apply(function(){e.preventDefault(),i(t,{$event:e})})})}}}]).directive("cardDetails",function(){return{restrict:"A",replace:!0,templateUrl:"templates/card-template.html",controller:"CardDetailsCtrl"}}).directive("sssAutofocus",function(){return{link:function(e,t,a){t.focus()}}}).filter("capitalize",function(){return function(e){if(e){for(var t=e.split(" "),a=0;a<t.length;a++){var i=t[a];t[a]=i.charAt(0).toUpperCase()+i.substr(1)}return t.join(" ")}return""}}).filter("skillApi.nameFromId",function(){return window.skillApi.nameFromId}).controller("DeckBuilderCtrl",["$scope","$window",function(e,a){e.getSkillIcon=function(e){var t=SKILL_DATA[e];return"res/skills/"+(t?t.icon:e)+".png"},e.supportedSkills=["absorb","armored","backlash","barrage","berserk","burn","corrosive","counter","counterburn","daze","enfeeble","enhance","enrage","evade","evadebarrier","fervor","flurry","frost","fury","heal","heartseeker","imbue","jam","leech","legion","nullify","pierce","poison","poisonstrike","protect","rally","regenerate","scorchbreath","silence","stasis","strike","taunt","valor","weaken","weakenself"].sort(function(e,t){return SKILL_DATA[e].name.localeCompare(SKILL_DATA[t].name)}),e.getSkillName=function(e){var t=SKILL_DATA[e];return t?t.name:e},e.showAdvancedFilters=a.showAdvancedFilters,e.filterSkill=function(e,t){a.filterSkill(e.target,t,e.altKey)}}])}(angular),define("tutorialScript",["urlHelpers"],function(e){"use strict";for(var t=[{msg:"Welcome to SIM Spellstone!  This is a brief tutorial of how to use the Deck Builder."},{ui:"#deckContainer",msg:'The "Deck" section contains your current deck.',actions:[w,r,v,l,s]},{ui:"#hash-container",msg:"If you have a deck hash, you can paste it here to set the current deck.",actions:[w]},{ui:"#deckContainer",msg:"Manually modifying the deck hash will automatically update the deck.",actions:[g]},{ui:"#deckContainer",msg:"Left-click on a card to remove it from your deck.",actions:[p]},{ui:"#deckContainer",msg:'Left-click on the commander will remove it and replace it with "Elaria Captain".',actions:[function(){D("QpLQAQwrxIQWkpBglFpB4jrBC4jrBC4jrBC")}]},{ui:"#deckContainer",msg:'Pressing Ctrl-Z will undo the last change made to your deck.  (Ctrl-Y can be used to "redo" a change as well).',actions:[p]},{ui:"#deckContainer",msg:"Holding Ctrl and left-clicking on a card will add a copy of it to your deck.",actions:[g]},{ui:"#deckContainer",msg:"You can drag-and-drop units in your deck to rearrange them (currently PC-only).",actions:[b,m]},{ui:"#unitOptions",dialog:!0,msg:"Right-click on a card to bring up an edit dialog.",actions:[m,k]},{ui:"#unitOptions",dialog:!0,msg:"Here, you can edit its level, fusion, and runes.",actions:[y]},{ui:"#deck .card:eq(1)",msg:'Changes will made will be shown on the card, but will not be saved until you hit "OK".',actions:[k,y]},{ui:"#deckContainer",msg:'Clicking "Cancel" will revert the unit back to its original stats.',actions:[b,m]},{ui:"#link",msg:"This link will load the DeckBuilder with your current deck to allow for easy sharing of decks.  It is automatically updated whenever you update the deck."},{ui:"#resetDeck",msg:'This will remove all cards from your deck and set the commander back to "Elaria Captain".',actions:[w]},{ui:"#sortDeck",msg:"This will sort all cards in your deck based on faction, rarity, and ID (the same way they are sorted in the game)."},{ui:"#saveDeck",msg:"This will allow you to save a deck locally so that you can easily load it later."},{ui:"#loadDeck",msg:"If you have any saved decks, you can use this button to quickly load one of them into the DeckBuilder.",actions:[s,r]},{ui:"#collection-container",msg:'The "Cards" section contains all of the cards in the game.',actions:[function(){$("#deck-container").accordion("option","active",null)},function(){$("#collection-container").accordion("option","active",0)}]},{ui:"#collection-container",msg:"Left-clicking on a card will add it to your deck.",actions:[o]},{ui:"#detailedView",dialog:!0,msg:"Right-clicking on a card will display a detailed view of the card.",actions:[function(){$("#collection-container").find(".card").first().contextmenu()},l]},{ui:"#filter-container",msg:'The "Filters" section allows you to filter the cards in the collection.',actions:[o,function(){$("#filter-container").accordion("option","active",0)}]},{ui:"#filter-container",msg:"Click on a filter to only show cards that match that filter.",actions:[v]},{ui:"[name=skill][data-filter=fervor]",msg:'For instance, clicking the "Fervor" filter will only show units that have the skill "Fervor".',actions:[c]},{ui:"#collection-container",msg:'Now only units with "Fervor" are visible.',actions:[function(){advancedFilters.dialog("close")}]},{ui:"#advancedFilters",dialog:!0,msg:"Right-clicking on a Skill filter will allow you to perform more advanced filtering.",actions:[u]},{ui:"#advancedFilters",dialog:!0,msg:"Here you can specify specific Skill values to filter by.  Different skills have different advanced filters available.",actions:[c,u,function(){$("#amount-min").val(4),C()}]},{ui:"[name=skill][data-filter=fervor]",dialog:!0,msg:'Clicking "OK" will apply the advanced filtering.',actions:[h]},{ui:"#collection-container",msg:'Now only units with at least "Fervor 4" are visible.'},{ui:"#filter-container",msg:'Holding the "Alt" key while clicking on a filter while hide cards that match that filter (not supported by all filters).',actions:[function(){var e=$("[name=skill][data-filter=enfeeble]");for(;e.hasClass("excluded")||e.hasClass("selected");)e.click()}]},{ui:"[name=skill][data-filter=enfeeble]",msg:'For instance, holding "Alt" and clicking the "Hex" filter will hide all units that have the skill "Hex".',actions:[d]},{ui:"#collection-container",msg:'Now only units with no "Hex" and at least "Fervor 4" are visible.'},{ui:"#name-container",msg:"You can also simply search for a unit by its name.",actions:[function(){$("#nameFilter").val("").trigger(jQuery.Event("keyup"))}]},{ui:"#name-container",msg:'For instance, typing "hide" will filter down to just "Spikehide Dragon" and "Spearhide Dragon".',actions:[f]},{ui:"#name-container",msg:'Tip: If the collection is filtered down to a single card, pressing "Enter" while in the Name Filter will add that card to your deck.',actions:[f,h,d]},{ui:"#clear-filters",msg:'You can click the "Clear All" button to reset all filters.',actions:[v]},{msg:'To view this tutorial again at any time, you can click the "Help" button.  (Note: this will reset the DeckBuilder.)'}],a=e.getCurrentPage(),i=0;i<t.length;i++){var n=t[i];n.showFor&&n.showFor!==a&&t.splice(i--,1)}function r(){$("#deck-container").accordion("option","active",0)}function l(){$("#filter-container").accordion("option","active",null)}function s(){$("#collection-container").accordion("option","active",null)}function o(){detailsDialog.dialog("close")}function c(){for(var e=$("[name=skill][data-filter=fervor]");!e.hasClass("selected");)e.click()}function d(){var e=$("[name=skill][data-filter=enfeeble]"),t=jQuery.Event("click");for(t.altKey=!0;!e.hasClass("excluded");)e.trigger(t)}function u(){$("[name=skill][data-filter=fervor]").contextmenu(),C()}function h(){advancedFilters.dialog("option","buttons").OK.apply(advancedFilters),C()}function f(){$("#nameFilter").val("hide").trigger(jQuery.Event("keyup"))}function v(){$("#clear-filters").click()}function g(){D("g~pAAQwrxIQWkpBglFpBglFpB4jrBC4jrBC4jrBC")}function p(){D("g~pAAQwrxIQWkpBglFpB4jrBC4jrBC4jrBC")}function m(){D("g~pAAQwrxIglFpBQWkpBglFpB4jrBC4jrBC4jrBC")}function k(){$("#deck .card").eq(1).contextmenu(),C()}function y(){$("#fusion").val(3),$("#runeChoices").val("5102").change(),C()}function b(){optionsDialog.dialog("close")}function w(){D("QpLQA")}function C(){$(".ui-dialog-buttonset .ui-button:visible").first().focus()}function D(e){$("#hash").val(e).change()}return t}),$(document).ready(function(){var e=require("storageAPI"),r=require("tutorialScript"),t=$("<div></div>");function a(){e.shouldShowTutorial?i():c()}function i(){s=0,d(),$("#tutorial").show()}$(document.body).append(t),t.load("templates/tutorial-overlay.html",null,function(){t.replaceWith(function(){return $(this).contents()}),$("#tutorial-show").prop("checked",e.shouldShowTutorial).change(function(){e.setShowTutorial(this.checked)}),$("#help").click(i),$("#tutorial-close, #tutorial-skip").click(c),$("#tutorial-next").click(n),$("#tutorial-prev").click(o),void 0===delayTutorial&&a()});var l,s=0;function n(){s++,d()}function o(){s--,d()}function c(){$("#tutorial").hide(),$("#tutorial-permahide").is(":checked")&&e.hideTutorial()}function d(){clearTimeout(l);var e=r[s],t=e.actions;t&&t.forEach(function(e){e()});var a=e.msg,i=e.ui;if(i){var n=$(i);e.dialog&&(n=n.parent()),u(n),t&&(l=setTimeout(u,500,n)),a.indexOf(!1)&&(a=a.replace(/\{0\}/g,n.text()))}else $(".overlay-fog").width(0).height(0);$("#tutorialMessage").text(a),s<r.length-1?($("#tutorial-next").show(),$("#tutorial-close").hide()):($("#tutorial-next").hide(),$("#tutorial-close").show()),0<s?$("#tutorial-prev").removeClass("disabled"):$("#tutorial-prev").addClass("disabled")}function u(e){var t=e.offset();$(".overlay-fog").css({top:t.top-2+"px",left:t.left-2+"px"}).width(e.outerWidth()+4+"px").height(e.outerHeight()+4+"px")}window.showTutorial=i,window.checkTutorial=a});
//# sourceMappingURL=deckbuilder.min.js.map