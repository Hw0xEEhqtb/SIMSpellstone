for(var skillID in function(){var a={};window.define=function(e,t){a[e]="function"==typeof t?t():t},window.require=function(e){var t=a[e];if(t)return t;throw"Module '"+e+"' is not defined yet."}}(),define("factions",{names:{0:"Factionless",1:"Aether",2:"Chaos",3:"Wyld",4:"Frog",5:"Elemental",6:"Angel",7:"Undead",8:"Void",9:"Dragon",10:"Avian",11:"Goblin",12:"Seafolk",13:"Insect",14:"Bear",15:"Token",16:"Mecha",17:"Knight",999:"Tower"},IDs:{Factionless:0,Aether:1,Chaos:2,Wyld:3,Frog:4,Elemental:5,Angel:6,Undead:7,Void:8,Dragon:9,Avian:10,Goblin:11,Seafolk:12,Insect:13,Bear:14,Token:15,Mecha:16,Knight:17,Tower:999}}),define("skillApi",function(){function s(e,t){var a=t.id;switch(SKILL_DATA[a].type){case"toggle":return void(e[a]=!0);case"passive":e[t.id]=(0|e[t.id])+t.x;break;case"flurry":e[t.id]=t;break;case"onDeath":e.onDeathSkills.push(t);break;case"earlyActivation":e.earlyActivationSkills.push(t);break;case"activation":default:e.skill.push(t)}}function c(e){var t={};return t.id=e.id,t.x=e.x,t.mult=e.mult,t.on_delay_mult=e.on_delay_mult,t.all=e.all,t.y=e.y,t.z=e.z,t.c=e.c,t.s=e.s,t}return{setSkill:s,copySkill:c,copySkills:function(e,t,a){e.skill=[],e.earlyActivationSkills=[],e.onDeathSkills=[];var r=[],n=!0;for(var i in t){var o=t[i];if(o.c){var l=c(o);s(e,l),r.push(l),n=!1}else if(a){var l=c(o);l.x=Math.ceil(l.x*a),s(e,l)}else s(e,o)}e.reusableSkills=n,e.skillTimers=r},nameFromId:function(e){var t=SKILL_DATA[e];return t?t.name:e}}}),define("runeApi",function(){function s(e){return RUNES[e]}return{addRunes:function(e,t){e.runes||(e.runes=[]);for(var a=0,r=t.length;a<r;a++){var n=t[a].id,i=s(n).stat_boost;for(var o in e.runes.push({id:n,stat_boost:i}),i){var l=i[o];"skill"===o||(isNaN(l)&&(l=Math.max(Math.ceil(e[o]*l.mult),l.min_bonus||1)),e[o]+=parseInt(l))}}},canUseRune:function(e,t){var a=s(t),r=a.stat_boost;if(a.faction_req&&!e.isInFaction(a.faction_req))return!1;for(var n in r)if("skill"===n){var i=r[n],o=i.all?1:0;if(!e.hasSkill(i.id,o))return!1}return!0},getRune:s}}),define("cardInfo",function(){function a(e){return CARDS[e]}return{loadCard:a,isCommander:function(e){var t=a(e);return t&&"1"==t.card_type},isAssault:function(e){var t=a(e);return t&&"2"==t.card_type},isTrap:function(e){var t=a(e);return t&&"3"==t.card_type}}}),define("matchTimer",function(){function a(e,t){return((t-e)/1e3).toFixed(3)}return{elapsed:function(){var e=this.timeStop||Date.now();return a(this.timeStart,e)},batchElapsed:function(e){return t=e||this.batchStarted,a(t,Date.now());var t},startBatch:function(){this.batchStarted=Date.now()},stop:function(){this.timeStop=Date.now()},reset:function(){this.timeStart=Date.now(),this.timeStop=0}}}),define("urlHelpers",function(){return{paramDefined:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var r=t[a].split("=");if(decodeURIComponent(r[0])==e)return!0}return!1},paramValue:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var r=t[a].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1]?r[1]:"")}return},getCurrentPage:function(){var e=window.location.href,t=e.indexOf(".html"),a=(e=e.substring(0,t)).lastIndexOf("/")+1;return e=e.substring(a).toLowerCase()}}}),define("base64",function(){"use strict";var i=require("cardInfo"),e={encodeHash:function(e){var t=[];e.commander&&t.push(e.commander);return t.concat(e.deck).map(r).join("")},decodeHash:function(e){for(var t,a={deck:[]},r=0;r<e.length;r+=5){var n=e.substr(r,5);(t=c(n))&&(i.loadCard(t.id)?!a.commander&&i.isCommander(t.id)?a.commander=t:a.deck.push(t):console.log("Could not decode '"+n+"' ("+t.id+")"))}a.commander||(a.commander=elariaCaptain);return a},fromDecimal:d,toDecimal:u,fromUnitInfo:r},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!~",l={};for(var t in CARDS)if(t<1e4){var a=FUSIONS[t];(!a||Number(a)<1e4)&&(l[t]=!0)}var s=1e3;function r(e){var t=parseInt(e.id),a=parseInt(e.level)-1;if(l[t]){var r=Math.floor(a/7);a=a%7}else{r=Math.floor(t/1e4);t%=1e4}var n=0;e.runes.length&&(n=parseInt(e.runes[0].id),n%=5e3);var i=t;return d(i=(i=7*(i=3*i+r)+a)*s+n,5)}function c(e){var t=u(e),a=t%s,r=(t=(t-a)/s)%7,n=(t=(t-r++)/7)%3,i=t=(t-n)/3;l[i]?r+=7*n:0<n&&(i=Number(n+""+i));var o=makeUnitInfo(i,r);return 0<a&&o.runes.push({id:a+5e3}),o}function d(e,t){for(var a="",r=0;r<t;r++){var n=e%64;a+=o[n],e=(e-n)/64}return a}function u(e){for(var t=0,a=e.length-1;0<=a;a--){t*=64,t+=o.indexOf(e[a])}return t}return e}),define("cardApi",function(){var e={byId:n,byIdSlim:function(e,t){var a=l.loadCard(e.id),r={};"1"==a.card_type?(r.isCommander=function(){return!0},r.isAssault=function(){return!1}):(r.isCommander=function(){return!1},r.isAssault=function(){return!0});if(a){if(r.id=a.id,r.name=a.name,r.rarity=a.rarity,r.maxLevel=a.maxLevel,e.level?(r.level=e.level,r.level>r.maxLevel&&(r.level=r.maxLevel)):r.level=1,t){if(r.attack=a.attack,r.health=a.health,r.cost=a.cost,r.set=a.set,r.card_type=a.card_type,r.type=a.type,r.sub_type=a.sub_type||[],r.skill=a.skill,1<r.level)for(var n in a.upgrades){var i=a.upgrades[n];if(void 0!==i.cost&&(r.cost=i.cost),void 0!==i.health&&(r.health=i.health),void 0!==i.attack&&(r.attack=i.attack),void 0!==i.desc&&(r.desc=i.desc),0<i.skill.length&&(r.skill=i.skill),n==r.level)break}var o=e.runes;o&&(r.skill=r.skill.slice(),c(r,o),h(r.skill,o))}}else r.id=void 0,r.name=void 0,r.card_type=void 0,r.set=void 0,r.type=void 0,r.sub_type=[],r.level=void 0,r.maxLevel=void 0,t&&(r.skill=[]);return r},byIdWithBgeApplied:function(e,t,a){return t=t||SIMULATOR.battlegrounds.onCreate,n(e,t,null,a)},makeBattleground:t,applyDefaultStatuses:r},l=require("cardInfo"),k=require("skillApi"),s=require("runeApi"),a={attack_berserk:0,attack_valor:0,attack_rally:0,attack_weaken:0,attack_corroded:0,corrosion_timer:0,mark_target:0,barrier_ice:0,corroded:0,enfeebled:0,enraged:0,envenomed:0,heartseeker:0,imbued:0,invisible:0,nullified:0,poisoned:0,protected:0,scorched:0,warded:0,jammed:!1,jammedSelf:!1,silenced:!1,valor_triggered:!1,dualstrike_triggered:!1,ondeath_triggered:!1,reanimated:!1};function r(e){for(var t in e.removeImbue(),e.enhanced={},a)e[t]=a[t]}function c(e,t){e.runes||(e.runes=[]);for(var a=0,r=t.length;a<r;a++){var n=t[a].id,i=s.getRune(n).stat_boost;for(var o in e.runes.push({id:n,stat_boost:i}),i){var l=i[o];"skill"===o||(isNaN(l)&&(l=Math.max(Math.ceil(e[o]*l.mult),l.min_bonus||1)),e[o]+=parseInt(l))}}}function n(e,t,a,r){var n=l.loadCard(e.id);if(n){n.skill||(n.skill=[]);var i=o(n,e.level,e.runes,t,a,r);return e.priority&&(i.priority=e.priority),i}return console.log(e.id+" not found"),(n={}).id=e.id,n.level=e.level,n.name=void 0,n.health=void 0,n.skill=[],n}function h(e,t,a){if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r].id,o=RUNES[i].stat_boost;for(var l in o){var s=o[l];if("skill"===l)for(var c=s.id,d=s.x,u=s.mult,h=0;h<e.length;h++){var f=e[h];if(f.id===c&&(f.all||0)==(s.all||0)){f=k.copySkill(f),!d&&u&&(d=Math.ceil(f.x*u)),s.min_bonus&&(d=Math.max(d,s.min_bonus)),d&&(f.x+=parseInt(d)*a),s.c&&(f.c-=Math.min(f.c,parseInt(s.c)*a)),f.boosted=!0,e[h]=f;break}}}}}var i,o=function(){var u;function p(e,t){return n({id:e.id,level:e.level})[t]}function b(e,t,a){for(var r in t){var n=t[r];n.x&&((n=k.copySkill(n)).x+=Math.ceil(n.x*a),n.boosted=!0,t[r]=n,e.highlighted.push(n.id))}}for(var e in u={p:null,health_left:0,timer:0,key:void 0,isCommander:function(){return"1"==this.card_type},isAssault:function(){return"2"==this.card_type},isTrap:function(){return"3"==this.card_type},isAlive:function(){return 0<this.health_left},isDamaged:function(){return this.health_left<this.health},isActive:function(){return 0==this.timer},isActiveNextTurn:function(){return this.timer<=1},isInactive:function(){return 1<=this.timer},isUnjammed:function(){return!this.jammed},isUnsilenced:function(){return!this.silenced},imbue:function(e){this.imbued||(this.imbued={});var t,a=this.imbued,r=e.id;switch(SKILL_DATA[r].type){case"toggle":return this[r]=!0,void(this.imbued[r]=1);case"passive":return this[r]+=parseInt(e.x),void(this.imbued[r]=(this.imbued[r]||0)+e.x);case"flurry":return void(this.flurry||(this.flurry=e,this.flurry.countdown=0,this.imbued.flurry=!0));case"onDeath":t="onDeathSkills";break;case"earlyActivation":t="earlyActivationSkills";break;case"activation":default:t="skill"}if(void 0===a[t]){var n=this[t];a[t]=n.length,this[t]=n.slice()}this[t].push(e)},scorch:function(e){var t=this.scorched;t?(t.amount+=e,t.timer=2):this.scorched={amount:e,timer:2}},removeImbue:function(){var e=this.imbued;if(e){for(var t in e){var a=e[t];"skill"===t||"earlyActivationSkills"===t||"onDeathSkills"===t?this[t]=this[t].slice(0,a):this[t]-=a}this.imbued=0}},hasSkill:function(e,t){var a;switch(SKILL_DATA[e].type){case"toggle":case"passive":case"flurry":return this[e];case"onDeath":a=this.onDeathSkills;break;case"earlyActivation":a=this.earlyActivationSkills;break;case"activation":default:a=this.skill}for(var r in a){var n=a[r];if(n.id===e&&(void 0===t||(n.all||0)==t))return!0}return!1},hasAttack:function(){return 0<this.adjustedAttack()},attackPlusBuffs:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor},adjustedAttack:function(){return this.attack+this.attack_rally+this.attack_berserk+this.attack_valor-this.attack_weaken-this.attack_corroded},permanentAttack:function(){return this.attack+this.attack_berserk+this.attack_valor},isInFaction:function(e){if(void 0===e)return 1;var t=e.split(",");if(t.length<=1)return this.type==e?1:0<=this.sub_type.indexOf(e.toString())?1:0;for(var a=0;a<t.length;a++)if(!this.isInFaction(t[a]))return 0;return 1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0},addRunes:function(e){c(this,e)}},SKILL_DATA){var t=SKILL_DATA[e].type;"passive"===t?u[e]=0:"toggle"===t&&(u[e]=!1)}return r(u),function(e,t,a,r,n,i){t||(t=1);var o=Object.create(u);o.id=e.id,o.name=e.name,o.attack=e.attack,o.health=e.health,o.maxLevel=e.maxLevel,o.level=t>o.maxLevel?o.maxLevel:t,o.cost=e.cost,o.rarity=e.rarity,o.card_type=e.card_type,o.type=e.type,o.sub_type=e.sub_type||[],o.set=e.set;var l,s=e.skill;if(1<o.level)for(var c in e.upgrades)if(void 0!==(l=e.upgrades[c]).cost&&(o.cost=l.cost),void 0!==l.health&&(o.health=l.health),void 0!==l.attack&&(o.attack=l.attack),void 0!==l.desc&&(o.desc=l.desc),0<l.skill.length&&(s=l.skill),c==o.level)break;if(s=s.slice(),r&&r.length&&function(t,e,a,r){t.highlighted=[];for(var n=0;n<a.length;n++){var i=a[n];if("statChange"==i.modifierType&&!r)for(var o=0;o<i.effects.length;o++){var l=i.effects[o];t.isInFaction(l.y)&&Object.keys(l).forEach(function(e){t[e]=l[e]})}}}(o,0,r,i),a){o.addRunes(a);var d=1;r&&r.forEach(function(e){"runeMultiplier"==e.modifierType&&e.effects.forEach(function(e){o.isInFaction(e.y)&&(d=parseInt(e.mult))})}),h(s,a,d)}else o.runes=[];return r&&r.length&&function(e,t,a,r){e.highlighted=[];for(var n=0;n<a.length;n++){var i=a[n];if("evolve_skill"===i.modifierType)for(var o=0;o<i.effects.length;o++){var l=i.effects[o];for(var s in t){var c=t[s];c.id==l.id&&c.all==l.all&&((c=k.copySkill(c)).id=l.s,c.boosted=!0,t[s]=c,e.highlighted.push(c.id))}}else if("add_skill"===i.modifierType)for(o=0;o<i.effects.length;o++){var d=i.effects[o];if(e.isInFaction(d.y)){if(d.rarity&&e.rarity!=d.rarity)continue;var u={};if(u.id=d.id,u.x=d.x||0,d.mult)if(d.base){var h=p(e,d.base);u.x+=Math.ceil(d.mult*h)}else u.mult=d.mult;if(u.z=d.z,u.c=d.c,u.s=d.s,u.all=d.all,d.card&&(u.card=d.card),d.level&&(u.level=d.level),u.boosted=!0,d.mult&&d.base&&0==u.x)continue;t.push(u),e.highlighted.push(u.id)}}else if("scale_attributes"!==i.modifierType||r){if("scale_stat"===i.modifierType&&!r)for(o=0;o<i.effects.length;o++)f=i.effects[o],e.isInFaction(f.y)&&(e[i.scaledStat]+=Math.ceil(p(e,f.base)*f.mult))}else for(var o=0;o<i.effects.length;o++){var f=i.effects[o];if(e.isInFaction(f.y)){var m=f.mult,g=Math.ceil(e.attack*m);e.attack+=g;var v=Math.ceil(e.health*m);e.health+=v,b(e,t,m)}}}}(o,s,r,i),n&&b(o,s,n),k.copySkills(o,s),o}}(),t=((i=function(e,t,a){this.name=e,k.copySkills(this,[t],a)}).prototype={p:null,name:null,runes:[],isCommander:function(){return!1},isAssault:function(){return!1},resetTimers:function(){for(var e=0,t=this.skillTimers.length;e<t;e++)this.skillTimers[e].countdown=0}},function(e,t,a){return new i(e,t,a)});return e}),define("unitInfo",function(){var e={areEqual:function(e,t){if(!e!=!t)return!1;var a=n.fromUnitInfo(e),r=n.fromUnitInfo(t);return a===r},getEnhancement:function(e,t,a){var r=e.enhanced,n=r&&r[t]||0;n<0&&(n=Math.ceil(a*-n));return n},initializeUnit:function(e,t,a){e.owner=t,e.timer=e.cost,e.health_left=e.health,r.applyDefaultStatuses(e),e.key=a,e.reusableSkills||e.resetTimers()},isImbued:function(e,t,a){var r;switch(SKILL_DATA[t].type){case"flurry":case"toggle":return e.imbued[t];case"passive":return e[t]===e.imbued[t];case"onDeath":r="onDeathSkills";break;case"earlyActivation":r="earlyActivationSkills";break;case"activation":default:r="skill"}return void 0!==e.imbued[r]&&a>=e.imbued[r]}},n=require("base64"),r=require("cardApi");return e}),define("bgeApi",function(){var e={getBattlegrounds:function(e,t,a,r,n,i,o,l){var s={onCreate:[],onTurn:[],onCardPlayed:[]};c(s,e),c(s,t,"player"),c(s,a,"cpu"),function(e,t,a){if(t)for(var r=t.split(","),n=0;n<r.length;n++){var i=r[n].split("-"),o=i[0],l=i[1],s=i[2],c=Object.keys(MAP_BATTLEGROUNDS).filter(function(e){return MAP_BATTLEGROUNDS[e].location_id==o})[0],d=(c=MAP_BATTLEGROUNDS[c]).effects[l].upgrades[s];g(e,d,a)}}(s,r,"player"),n?function(e,t,a){var r=CAMPAIGNS[t];if(r){var n=r.battleground_id;if(n){var i=BATTLEGROUNDS[n];if(a=Number(a)-1,!i.starting_level||Number(i.starting_level)<=a){if(i.scale_with_level){i=JSON.parse(JSON.stringify(i));for(var o=a-Number(i.starting_level),l=0;l<i.effect.length;l++){var s=i.effect[l];s.mult=s.base_mult+s.mult*o}}g(e,i,"cpu")}}}}(s,n,i):o&&function(e,t,a){var r=RAIDS[t].bge;if(r){var n=BATTLEGROUNDS[r];if(n&&Number(a)>=Number(n.starting_level))for(var i=n.enemy_only,o=0;o<n.effect.length;o++){var l=n.effect[o],s=l.effect_type;if("skill"===s){if(n.scale_with_level)var c=n.scale_with_level*(a-n.starting_level+1);else var c=1;var d=u.makeBattleground(n.name,l,c);d.enemy_only=i,e.onTurn.push(d)}else if(0<=["evolve_skill","add_skill","scale_attributes","statChange","runeMultiplier"].indexOf(s)){var d=h(n.name,l);d.enemy_only=i,e.onCreate.push(d)}else if(0<=["scale_attack","scale_health"].indexOf(s)){var d=f(n.name,l);d.enemy_only=i,e.onCreate.push(d)}else if("trap_card"===s){var d=m(n.name,l);d.enemy_only=i,e.onCardPlayed.push(d)}}}}(s,o,l);return s}},u=require("cardApi");function h(e,t){return{name:e,modifierType:t.effect_type,effects:[t]}}function f(e,t){return{name:e,modifierType:"scale_stat",scaledStat:t.effect_type.replace("scale_",""),effects:[t]}}var a,r,l=((a=function(e,t){this.p=null,this.name=e,this.effect=t,this.runes=[]}).prototype={onCardPlayed:function(e){SIMULATOR.onPlaySkills[this.effect.id](this,e,this.effect)},isCommander:function(){return!1},isAssault:function(){return!1}},function(e,t){return new a(e,t)}),m=((r=function(e,t){this.name=e,this.id=t.id,this.base=t.base,this.mult=t.mult,this.target_deck=t.target_deck,this.y=t.y}).prototype={onCardPlayed:function(e,t,a){var r="opponent"===this.target_deck?a:t;if(e.isInFaction(this.y)){for(var n=[],i=0;i<r.length;i++)(e=r[i]).trap||n.push(e);if(n.length){var o=Math.ceil(e[this.base]*this.mult),l=makeUnitInfo(this.id,o),s=u.byId(l);n[~~(Math.random()*n.length)].trap=s,debug&&(echo+=this.name+" inserts "+log.name(s)+" into the opposing deck.<br/>")}}}},function(e,t){return new r(e,t)});function g(e,t,a){for(var r=0;r<t.effect.length;r++){var n=t.effect[r],i=n.effect_type;if("skill"===i){var o=u.makeBattleground(t.name,n);"player"===a&&(o.ally_only=!0),"cpu"===a&&(o.enemy_only=!0),e.onTurn.push(o)}else if(0<=["evolve_skill","add_skill","scale_attributes","statChange","runeMultiplier"].indexOf(i)){o=h(t.name,n);"player"===a&&(o.ally_only=!0),"cpu"===a&&(o.enemy_only=!0),e.onCreate.push(o)}else if(0<=["scale_attack","scale_health"].indexOf(i)){o=f(t.name,n);"player"===a&&(o.ally_only=!0),"cpu"===a&&(o.enemy_only=!0),e.onCreate.push(o)}else if("trap_card"===i){o=m(t.name,n);"player"===a&&(o.ally_only=!0),"cpu"===a&&(o.enemy_only=!0),e.onCardPlayed.push(o)}else if("on_play"===i){(o=l(t.name,n.effect)).attacker=n.attacker,o.defender=n.defender,o.first_play=n.first_play,"player"===a&&(o.ally_only=!0),"cpu"===a&&(o.enemy_only=!0),e.onCardPlayed.push(o)}}}function c(e,t,a){if(!t)return null;for(var r=t.split(","),n=0;n<r.length;n++){var i=r[n];g(e,BATTLEGROUNDS[i],a)}}return e}),SKILL_DATA){var skillInfo=SKILL_DATA[skillID];"flurry"===skillID?skillInfo.type="flurry":0<=["turnStart","onAttack","onDamaged","turnEnd"].indexOf(skillInfo.type)&&(skillInfo.type="passive")}var REVERSE_FUSIONS={};for(var id in FUSIONS){var fusion=FUSIONS[id];REVERSE_FUSIONS[fusion]=id}var DATA_UPDATER=function(){var i="https://spellstone.synapse-games.com",h={},f={},o=null;var l=["cards_heroes.xml","cards_premium_aether.xml","cards_premium_chaos.xml","cards_premium_wyld.xml","cards_reward.xml","cards_shard.xml","cards_special.xml","cards_standard.xml","cards_story.xml","fusion_recipes_cj2.xml"];function m(e){var t,a,r={};if(r.id=v(e,"id"),r.name=v(e,"name"),u(r,e,"desc"),r.picture=v(e,"picture")||(t=v(e,"asset_prefab"),a="prefab_",t?a+t:t),!r.picture){var n=v(e,"portrait");r.picture=n?"portrait_"+n.toLowerCase().replace("portrait_",""):"NotFound"}var i=v(e,"hidden_until")||v(e,"hidden_until_time");i&&(r.hidden_until=i+"000"),r.rarity=v(e,"rarity"),r.set=v(e,"set"),r.card_type=v(e,"card_type"),g(r,e,"shard_card"),r.type=v(e,"type")||0,r.sub_type=p(e,"sub_type")||[],g(r,e,"health"),"1"!=r.card_type&&(g(r,e,"attack"),g(r,e,"cost"));var o=function(e){for(var t=e.getElementsByTagName("upgrade"),a={},r=0;r<t.length;r++)a[r+2]=d(t[r]);return a}(e);return r.maxLevel=1+Object.keys(o).length,r.skill=s(e),r.upgrades=o,r}function s(e){for(var t=e.childNodes,a=[],r=0;r<t.length;r++){var n=t[r];"skill"===n.nodeName&&a.push(c(n))}return a}function c(e){var t={id:v(e,"id",!0)};return g(t,e,"x",!0),g(t,e,"mult",!0),g(t,e,"on_delay_mult",!0),u(t,e,"y",!0),g(t,e,"z",!0),g(t,e,"c",!0),u(t,e,"s",!0),u(t,e,"all",!0),t}function d(e){var t={};return g(t,e,"attack"),g(t,e,"health"),g(t,e,"cost"),u(t,e,"desc"),t.skill=s(e),t}function u(e,t,a,r){var n=v(t,a,r);null!=n&&0<n.length&&(e[a]=n)}function g(e,t,a,r){var n,i=null!=(n=v(t,a,r))?Number(n):-1;0<=i&&(e[a]=i)}function v(e,t,a){if(a)return e.getAttribute(t);var r=p(e,t);return r?r[0]:null}function p(e,t){var a=null,r=$(e).children(t);if(0<r.length){a=[];for(var n=0;n<r.length;n++)a.push(r[n].textContent)}return a}return{updateData:function(e,t){$("body").addClass("loading"),$("#loadingSplash").html("Checking for New Cards...");var a=Date.now();if(!o||6e4<o-a||t){o=a,h={};var r=[];r.push(function(){for(var e=[],t=0;t<l.length;t++){var a=jQuery.ajax({url:i+"/assets/"+l[t],success:function(e){for(var t="undefined"!=typeof spoilers,a=e.getElementsByTagName("unit"),r=0;r<a.length;r++){a[r];var n=v(a[r],"id"),i=m(a[r]),o=!1;CARDS[n]?JSON.stringify(CARDS[n])!==JSON.stringify(i)&&(o=!0):o=!0,o&&(t&&(spoilers[n]=!0),h[n]=i),CARDS[n]=i}for(var l=e.getElementsByTagName("fusion_recipe"),r=0;r<l.length;r++){var s=l[r],c=v(s,"card_id",!1),d=s.getElementsByTagName("resource")[0];if(d){var u=v(d,"card_id",!0);FUSIONS[u]&&FUSIONS[u]==c||(f[u]=c,FUSIONS[u]=c)}}},async:!0,cache:!1});e.push(a)}return $.when.apply($,e)}());var n=function(){!function(){if(void 0!==storageAPI){var e=storageAPI.getField("GameData","CardCache");e?(e.newCards=e.newCards||{},e.newFusions=e.newFusions||{},$.extend(e.newCards,h),$.extend(e.newFusions,f)):e={newCards:h,newFusions:f},e.lastUpdated=Date.now(),storageAPI.setField("GameData","CardCache",e)}}(),$("body").removeClass("loading"),e&&e()};$.when.apply($,r).then(n,n)}else e&&e()}}}(),loadDeck=function(){var c=require("cardInfo"),k=require("cardApi");function _(e){for(var t=function(e){for(var t,a=e.id;void 0!==(a=REVERSE_FUSIONS[t=a]););return t}(e),a=-1;void 0!==t;)a++,t=FUSIONS[t];return a}function y(e,t,a){if(t=parseInt(t),e.mastery_level&&t<parseInt(e.mastery_level))return null;if(e.remove_mastery_level&&t>=parseInt(e.remove_mastery_level))return null;var r=e.id,n=!1;r||(r=function(e){var t=[];for(var a in CARDS)if(!REVERSE_FUSIONS[a]){var r=CARDS[a];if("1"!=r.card_type&&!(e.max_rarity&&Number(e.max_rarity)<Number(r.rarity)||e.min_rarity&&Number(e.min_rarity)>Number(r.rarity))&&(!e.type||e.type==r.type||0<=r.sub_type.indexOf(e.type.toString()))){if(e.set&&e.set.split(",").indexOf(r.set)<0)continue;t.push(a)}}return t[~~(Math.random()*t.length)]}(e),n=!0);var i=e.level||1;if(a<=t)i=7,d(r)&&(r=u(r));else if(1<t&&c.isCommander(r)){var o=(Number(c.loadCard(r).rarity)+1)/(a-1),l=t-1;i=Math.ceil(o*l)}var s=makeUnitInfo(r,i);return n&&(s.randomInfo={unitInfo:e,level:t,maxedAt:a}),s}function A(e){var t=parseInt(c.loadCard(e.id).rarity)+2;if(e.level==t){if(!d(e.id))return!1;e.id=u(e.id,1),e.level=1}else e.level++;return!0}function d(e){return!(-1<i.indexOf(e))&&(!c.isCommander(e)&&!!FUSIONS[e])}function u(e,t){if(-1==i.indexOf(e))if(t)for(var a=0;a<t;a++)e=n(e);else do{var r=n(e);e=r}while(e!==r);return e}function n(e){var t=FUSIONS[e];return t||e}var i=["8005","8006","8007","8008","8009","8010"];function o(e,t,a){var r=a+1;t||(t=r);var n=[];n.deck=[];var i=function(e,t){t=parseInt(t);var a=e.commander;if(a.card){for(var r=[],n=0;n<a.card.length;n++){var i=a.card[n],o=parseInt(i.min_mastery_level)||0,l=parseInt(i.max_mastery_level)||999;o<=t&&t<=l&&r.push(i)}(a=r[~~(Math.random()*r.length)]).possibilities=r}return a}(e,t),o=y(i,t,r);i.possibilities&&(o.randomInfo={possibilities:i.possibilities,level:t,maxedAt:r}),n.commander=o;var l=e.deck,s=n.deck;for(var c in l){var d=y(l[c],t,r);d&&s.push(d)}var u,h,f,m,g=function(e){for(var t=0,a=0;a<e.length;a++){var r=e[a],n=k.byId(r);t+=(_(n)+1)*n.maxLevel-1}return t}(s),v=(u=t,f=g,m=7==(h=r)?(u-1)/(h-1):u/h,Math.ceil(f*m));if(1<t&&t<r)for(var p=s.slice();0<v&&0<p.length;){var b=Math.floor(Math.random()*p.length);A(p[b])?v--:p.splice(b,1)}return n}return{mission:function(e,t){var a=MISSIONS[e];return a?o(a,t,6):0},raid:function(e,t,a){a||(a=25);var r=RAIDS[e];{if(r){var n={commander:r.commander,deck:r.deck.card};return o(n,t,Number(r.upgradeLevels))}return 0}}}}(),log=function(){var e={skill:function(e){var t=r.nameFromId(e.id);e.all&&(t+=" all");e.y&&(t+=" "+a.names[e.y]);e.s&&(t+=" "+r.nameFromId(e.s));e.c?t+=" every "+e.c+" turns":e.x&&(t+=" "+e.x);return t},name:function(e,t){if("cpu"===e.owner)var a="i";else var a="b";var r="<"+a+">";r+=e.name,e.runes.length&&(r+="*");1<e.maxLevel&&(r+="{"+e.level+"/"+e.maxLevel+"}");void 0!==e.key&&(r+=" ("+e.key+")");if(r+="</"+a+">",!t){if(r+="<u>",e.isCommander())r+=" [",void 0!==e.health_left?r+=i(e.health_left):r+=e.health,r+=" HP]";else if(e.isAssault()){r+=" [";var n=e.adjustedAttack();(isNaN(n)||null==n)&&(n=e.attack),r+=n,r+="/",void 0!==e.health_left?r+=i(e.health_left):r+=e.health,r+="/",void 0!==e.timer?r+=e.timer:r+=e.cost,r+="]"}r+="</u>"}return r}},a=require("factions"),r=require("skillApi");function i(e){return e>Math.floor(e)&&(e=e.toFixed(1)),e}return e}(),cardApi=require("cardApi");function parseInt(e){return e>>0}function shuffle(e){var t,a,r,n=e.length;if(0==n)return!1;for(;--n;)t=~~(Math.random()*(n+1)),a=e[n],r=e[t],e[n]=r,e[t]=a}function copy_deck(e){var t={};return t.commander=e.commander,t.deck=copy_card_list(e.deck),t}function getDeckCards(e,t){var a={};a.commander=cardApi.byId(e.commander),a.deck=[];for(var r=e.deck,n=SIMULATOR.battlegrounds.onCreate.filter(function(e){return!("player"===t&&e.enemy_only||"cpu"===t&&e.ally_only)}),i=0,o=r.length;i<o;i++)a.deck.push(cardApi.byIdWithBgeApplied(r[i],n));return a}function copy_card_list(e){for(var t=[],a=0,r=e.length;a<r;a++)t[a]=e[a];return t}function getDefaultDeck(){return{commander:elariaCaptain,deck:[]}}function makeUnitInfo(e,t,a){var r={id:Number(e),level:Number(t),runes:[]};return a&&(r.runes=a),r}window.loadCardCache=function(){var e=storageAPI.getField("GameData","CardCache");if(e&&e.lastUpdated>DataUpdated)e.newCards&&($.extend(CARDS,e.newCards),$.extend(FUSIONS,e.newFusions)),DataUpdated=e.lastUpdated;else{var t={newCards:{},newFusions:{},lastUpdated:Date.now()};storageAPI.setField("GameData","CardCache",t)}},"function"!=typeof String.prototype.format&&(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==a[t]?a[t]:e})}),"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var a=arguments[t];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}),Function.prototype.debounce=function(a){var r,n=this;return function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n.apply(e,t)},a)}},Function.prototype.throttle=function(a){var r,n=this;return function(){var e=this,t=arguments;if(!r){n.apply(e,t);r=setTimeout(function(){r=null,n.apply(e,t)},a)}}};var elariaCaptain=makeUnitInfo(202,1),SIM_CONTROLLER=function(){var r=require("matchTimer");return{getConfiguration:function(){getdeck=$("#deck1").val(),getordered=$("#ordered").is(":checked"),getexactorder=$("#exactorder").is(":checked"),getdeck2=$("#deck2").val(),getcampaign=$("#campaign").val(),getmission=$("#mission").val(),missionlevel=$("#mission_level").val(),getraid=$("#raid").val(),raidlevel=$("#raid_level").val(),getordered2=$("#ordered2").is(":checked"),getexactorder2=$("#exactorder2").is(":checked"),surge=$("#surge").is(":checked"),getsiege=$("#siege").is(":checked"),tower_level=$("#tower_level").val(),tower_type=$("#tower_type").val(),BATTLEGROUNDS&&(getbattleground=getSelectedBattlegrounds(),selfbges=getSelectedBattlegrounds("self-"),enemybges=getSelectedBattlegrounds("enemy-"),mapbges=getmission?getSelectedMapBattlegrounds():""),sims_left=$("#sims").val()||1,debug=$("#debug").is(":checked"),(play_debug=debug&&$("#play_debug").is(":checked"))&&(debug=!1),mass_debug=$("#mass_debug").is(":checked"),win_debug=$("#win_debug").is(":checked"),loss_debug=$("#loss_debug").is(":checked"),showAnimations=$("#animations").is(":checked"),$("#auto_mode").length&&(auto_mode=$("#auto_mode").is(":checked"),SIMULATOR.user_controlled=!auto_mode),tournament=$("#tournament").is(":checked")},debug_end:function(e){var t;e=SIM_CONTROLLER.processSimResult(),sims_left=0,r.stop();var a="";getdeck2&&(a=" ("+SIMULATOR.calculatePoints()+" points)"),t="draw"==e?"<br><h1>DRAW"+a+"</h1><br>":e?"<br><h1>WIN"+a+"</h1><br>":"<br><h1>LOSS"+a+"</h1><br>",echo&&outputTurns(echo),setSimStatus(t),showUI(),SIMULATOR.sendBattleUpdate&&SIMULATOR.sendBattleUpdate(SIMULATOR.simulation_turns),SIM_CONTROLLER.end_sims_callback&&SIM_CONTROLLER.end_sims_callback()},end_sims_callback:null,stop_sims_callback:null}}();!function(){var e=require("bgeApi"),o=require("matchTimer"),t=require("urlHelpers");function l(){if(SIMULATOR.user_controlled)s(!0)&&SIM_CONTROLLER.debug_end();else if(!debug&&!play_debug||mass_debug||loss_debug||win_debug)if(0<sims_left){if(d<=c){var e=0;if(0<d){c=0;var t=games/(games+sims_left)*100;t=t.toFixed(2);var a=o.elapsed(),r=o.batchElapsed();setSimStatus("Running simulations...",a,(e=0==r?0:d/r).toFixed(1)),showWinrate()}(d=1)<e&&(d=Math.ceil(e/8)),sims_left<d&&(d=sims_left),(debug||play_debug)&&(mass_debug||loss_debug||win_debug)&&(d=1),o.startBatch(),current_timeout=setTimeout(l,1);for(var n=0;n<d;n++)s()}}else{d=c=0,o.stop();a=o.elapsed();var i=games/a;i=i.toFixed(2),echo&&outp(echo),setSimStatus("Simulations complete.",a,i),showWinrate(),showUI(),SIM_CONTROLLER.end_sims_callback&&SIM_CONTROLLER.end_sims_callback()}else s(!0),SIM_CONTROLLER.debug_end()}SIM_CONTROLLER.startsim=function(){return total_turns=0,o.reset(),echo="",d=games=0,SIM_CONTROLLER.getConfiguration(),SIMULATOR.battlegrounds=e.getBattlegrounds(getbattleground,selfbges,enemybges,mapbges,getcampaign,missionlevel,getraid,raidlevel),hideUI(),SIMULATOR.setupDecks(),points=draws=losses=wins=0,outp(""),SIMULATOR.user_controlled?setSimStatus(""):(hideTable(),setSimStatus("Initializing simulations...")),window.ga("send","event","simulation","start","single-threaded",sims_left),current_timeout=setTimeout(l),!1},SIM_CONTROLLER.stopsim=function(){o.stop();var e=o.elapsed(),t=games/e;t=t.toFixed(2),SIMULATOR.simulating=!1,current_timeout&&clearTimeout(current_timeout),SIMULATOR.user_controlled||(setSimStatus("Simulations interrupted.",e,t),showWinrate()),showUI(),SIM_CONTROLLER.stop_sims_callback&&SIM_CONTROLLER.stop_sims_callback()};var a=t.paramValue("seedtest")||0;function s(e){if(a&&Math.seedrandom(a++),!SIMULATOR.simulate())return!1;e||SIM_CONTROLLER.processSimResult()}SIM_CONTROLLER.processSimResult=function(){var e;return e=!!SIMULATOR.field.player.commander.isAlive()&&(!SIMULATOR.field.cpu.commander.isAlive()||"draw"),0<d&&(0<sims_left&&sims_left--,c++),"draw"==e?draws++:e?wins++:losses++,points+=SIMULATOR.calculatePoints(),games++,total_turns+=SIMULATOR.simulation_turns,(debug||play_debug)&&(loss_debug?"draw"==e?(echo="Draw found after "+games+" games. Displaying debug output... <br><br>"+echo,echo+="<br><h1>DRAW</h1><br>",sims_left=0):e?sims_left?echo="":(echo="No losses found after "+games+" games. No debug output to display.<br><br>",sims_left=0):(echo="Loss found after "+games+" games. Displaying debug output... <br><br>"+echo,echo+="<br><h1>LOSS</h1><br>",sims_left=0):win_debug?e&&"draw"!=e?(echo="Win found after "+games+" games. Displaying debug output... <br><br>"+echo,echo+="<br><h1>WIN</h1><br>",sims_left=0):sims_left?echo="":(echo="No wins found after "+games+" games. No debug output to display.<br><br>",sims_left=0):mass_debug&&(echo+="draw"==e?"<br><h1>DRAW</h1><br>":e?"<br><h1>WIN</h1><br>":"<br><h1>LOSS</h1><br>"),mass_debug&&sims_left&&(echo+="<br><hr>NEW BATTLE BEGINS<hr><br>")),e};var c=0,d=0}();var SIMULATOR={};!function(){var m=require("cardApi"),i=require("skillApi"),e=require("base64"),T=require("unitInfo");function c(e,t,a,r){var n=K[t].assaults;if(!e.id)return 0;var i=n.length;if(T.initializeUnit(e,t,i),e.played=!0,e.isAssault()&&(n[i]=e),!debug&&!play_debug||r||(echo+=log.name(K[t].commander)+" plays "+log.name(e)+"<br>"),e.isTrap())p(e),I(e);else for(var o=0;o<W.onCardPlayed.length;o++){var l=W.onCardPlayed[o],s="player"===t?"cpu":"player";if(l.defender){if(!surge&&"cpu"!=t)continue;if(surge&&"player"!=t)continue;l.owner=s}else if(l.attacker){if(!surge&&"player"!=t)continue;if(surge&&"cpu"!=t)continue;l.owner=t}else{if(l.enemy_only&&"cpu"!=t)continue;if(l.ally_only&&"player"!=t)continue;l.owner=t}1<a&&l.first_play||l.onCardPlayed(e,z[t].deck,z[s].deck)}showAnimations&&drawField(K,null,null,a)}function v(e){for(var t=K[e].assaults,a=0,r=t.length;a<r;a++){var n=t[a];if(!n.isAlive()){debug&&(echo+=log.name(n)+" <strong>is removed from field</strong><br>");var i=a;for(a++;a<r;a++)(n=t[a]).isAlive()?(t[n.key=i]=n,i++):debug&&(echo+=log.name(n)+" <strong>is removed from field</strong><br>");t.length=i;break}}}function b(e){return[e[~~(Math.random()*e.length)]]}function k(e){return e.owner}function _(e){return"cpu"==e.owner?"player":"player"==e.owner?"cpu":void 0}function $(e,t,a,r,n){a>=t.health_left?t.health_left=0:t.health_left-=a,debug&&n(e,t,a),r&&x(t),!t.isAlive()&&e&&L(t,e)}function x(e){var t=e.barrier_ice,a=_(e),r=K[a],n=r.assaults[e.key];n&&n.isAlive()||(n=r.commander),$(e,n,t,null,function(e,t,a){echo+=log.name(e)+"'s barrier shatters and hits "+log.name(t)+" for "+a+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"})}function d(e,t){return e[t]||a}function a(e,t){if(debug){var a=SKILL_DATA[t.id]?SKILL_DATA[t.id].name:t.id;echo+=log.name(e)+" attempts to use "+a+", but it is not implemented.<br>"}return 0}function p(e){var t=e.earlyActivationSkills,a=t.length;if(0!=a)if(e.silenced)debug&&(echo+=log.name(e)+" is silenced and cannot use skills</br>");else{var r=e.dualstrike_triggered;debug&&r&&(echo+=log.name(e)+" activates dualstrike<br>");for(var n=r?2:1,i=u(e),o=0;o<n;o++)for(var l=0;l<a&&i();l++){var s=t[l];if(!s.countdown){var c=d(h,s.id)(e,s);s.c&&0<c&&(s.countdown=s.c),showAnimations&&drawField(K,null,null,Z,e)}}}}function t(){return!0}function u(e){return e.isAlive?e.isAlive.bind(e):t}function L(e,t){if(!e.ondeath_triggered){var a=e.onDeathSkills,r=a.length;if(0!=r){for(var n=0;n<r;n++){var i=a[n];o[i.id](e,t,i),showAnimations&&drawField(K,null,null,Z,e)}e.ondeath_triggered=!0}}}var r=["backlash","counter","counterburn","counterpoison","armored","evade","stasis"];function y(e){return-1===r.indexOf(e)}function A(e,t){if(e.isAssault()&&t.isAlive()){var a=t.backlash;V(e,t,"Backlash",a,T.getEnhancement(t,"backlash",a))}}function E(e){return e.isActive()&&e.isUnjammed()?0:e.stasis||0}var l={burnself:function(e,t){var a=t.x;return e.scorched?(e.scorched.amount+=a,e.scorched.timer=2):e.scorched={amount:a,timer:2},debug&&(echo+=log.name(e)+" inflicts scorch("+a+") on itself<br>"),1},scorchbreath:function(e,t){return l.burn(e,t)},burn:function(e,t){var a,r=_(e),n=K[r].assaults;switch(t.id){case"scorchbreath":var i=Math.max(0,e.key-1),o=Math.min(n.length,e.key+2);a=n.slice(i,o);break;case"burnself":a=[e];break;default:a=n.slice(e.key,e.key+1)}if(!a.length)return 0;var l=t.x;l+=T.getEnhancement(e,"burn",l);for(var s=0,c=0;c<a.length;c++){var d=a[c];d.scorched?(d.scorched.amount+=l,d.scorched.timer=2):d.scorched={amount:l,timer:2},debug&&(echo+=log.name(e)+" inflicts scorch("+l+") on "+log.name(d)+"<br>"),s++}return s},protect_ice:function(e,t){return l.protect(e,t,"barrier_ice")},protect_seafolk:function(e,t){return l.protect(e,t,null,null,!0)},evadebarrier:function(e,t){return l.protect(e,t,"invisible",function(e,t){return" and imbues it with invisible "+t})},protect:function(e,t,a,r,n){for(var i=t.y,o=k(e),l=t.x,s=t.all,c=K[o].assaults,d=[],u=0,h=c.length;u<h;u++){!(g=c[u]).isAlive()||!g.isInFaction(i)||n&&g.isActive()||d.push(u)}if(!d.length)return 0;s||(d=b(d));var f=T.getEnhancement(e,t.id,l);l+=f;var m=0;for(u=0,h=d.length;u<h;u++){var g;if((g=c[d[u]]).nullified)g.nullified--,debug&&(echo+=log.name(e)+" protects "+log.name(g)+" but it is nullified!<br>");else{m++;var v=l;if(!v){var p=t.mult;g.isActive()||(p+=t.on_delay_mult||0),v=Math.ceil(g.health*p)}g.protected+=v,a&&(g[a]=(g[a]||0)+v),debug&&(f&&(echo+="<u>(Enhance: +"+f+")</u><br>"),echo+=log.name(e)+" barriers "+log.name(g)+" by "+v,"function"==typeof r&&(echo+=r(g,v)),echo+="<br>")}}return m},heal:function(e,t){for(var a=k(e),r=t.y,n=t.x,i=t.all,o=K[a].assaults,l=[],s=0,c=o.length;s<c;s++){(h=o[s]).isAlive()&&h.isInFaction(r)&&(i||h.isDamaged())&&l.push(s)}if(!l.length)return 0;i||(l=b(l));var d=T.getEnhancement(e,t.id,n);n+=d;var u=0;for(s=0,c=l.length;s<c;s++){var h;if((h=o[l[s]]).nullified)h.nullified--,debug&&(echo+=log.name(e)+" heals "+log.name(h)+" but it is nullified!<br>");else{u++;var f=n;if(!f){var m=t.mult;f=Math.ceil(h.health*m)}f>h.health-h.health_left&&(f=h.health-h.health_left),h.health_left+=f,debug&&(d&&(echo+="<u>(Enhance: +"+d+")</u><br>"),echo+=log.name(e)+" heals "+log.name(h)+" by "+f+"<br>")}}return u},poisonstrike:function(e,t,a){return l.strike(e,t,!0)},strike:function(e,r,t){for(var a=_(e),n=r.x,i=r.y,o=r.all,l=K[a].assaults,s=[],c=0,d=l.length;c<d;c++){(f=l[c]).isAlive()&&f.isInFaction(i)&&s.push(c)}if(!s.length)return 0;o||(s=b(s));var u=T.getEnhancement(e,r.id,n);n+=u;var h=0;for(c=0,d=s.length;c<d;c++){var f;if((f=l[s[c]]).invisible)f.invisible--,debug&&(echo+=log.name(e)+" bolts "+log.name(f)+" but it is invisible!<br>");else{h++;var m=n,g=B(f,m);m=g.damage;var v=g.shatter,p=0;0<m&&t&&f.isAlive()&&n>f.poisoned&&(p=n,f.poisoned=p),$(e,f,m,v,function(e,t,a){echo+="<u>(Strike: +"+r.x,u&&(echo+=" Enhance: +"+u),echo+=g.echo,echo+=") = "+a+" damage</u><br>",echo+=log.name(e)+" bolts "+log.name(t)+" for "+a+" damage",t.isAlive()?p&&(echo+=" and inflicts poison("+p+") on it"):echo+=" and it dies",echo+="<br>"}),f.backlash&&A(e,f)}}return h},intensify:function(e,t,a){for(var r=_(e),n=t.x,i=t.y,o=t.all,l=K[r].assaults,s=[],c=0,d=l.length;c<d;c++){(h=l[c]).isAlive()&&h.isInFaction(i)&&(h.scorched||h.poisoned)&&s.push(c)}if(!s.length)return 0;o||(s=b(s)),n+=T.getEnhancement(e,t.id,n);var u=0;for(c=0,d=s.length;c<d;c++){var h,f=(h=l[s[c]]).scorched?"scorch":"";f+=h.poisoned?f?" and poison":"poison":"",h.invisible?(h.invisible--,debug&&(echo+=log.name(e)+" intensifies "+f+" on "+log.name(h)+" but it is invisible!<br>")):(u++,h.scorched&&(h.scorched.amount+=n),h.poisoned&&(h.poisoned+=n),debug&&(echo+=log.name(e)+" intensifies "+f+" on "+log.name(h)+" by "+n+"<br>"),h.backlash&&A(e,h))}return u},ignite:function(e,t,a){for(var r=_(e),n=t.x,i=t.y,o=t.all,l=K[r].assaults,s=[],c=0,d=l.length;c<d;c++){(h=l[c]).isAlive()&&h.isInFaction(i)&&s.push(c)}if(!s.length)return 0;o||(s=b(s)),n+=T.getEnhancement(e,t.id,n);var u=0;for(c=0,d=s.length;c<d;c++){var h;(h=l[s[c]]).invisible?(h.invisible--,debug&&(echo+=log.name(e)+" ignites "+log.name(h)+" but it is invisible!<br>")):(u++,h.scorch(n),debug&&(echo+=log.name(e)+" ignites("+n+") "+log.name(h)+"<br>"),h.backlash&&A(e,h))}return u},jamself:function(e,t){return e.jammed=!0,e.jammedSelf=!0,debug&&(echo+=log.name(e)+" freezes itself<br>"),1},jam:function(e,t){k(e);for(var a=_(e),r=t.all,n=K[a].assaults,i=[],o=0,l=n.length;o<l;o++){(c=n[o]).isAlive()&&(r||c.isActiveNextTurn()&&c.isUnjammed())&&i.push(o)}if(!i.length)return 0;r||(i=b(i));var s=0;for(o=0,l=i.length;o<l;o++){var c;(c=n[i[o]]).invisible?(c.invisible--,t.countdown=0,debug&&(echo+=log.name(e)+" freezes "+log.name(c)+" but it is invisible!<br>")):(s++,c.jammed=!0,debug&&(echo+=log.name(e)+" freezes "+log.name(c)+"<br>"),c.backlash&&A(e,c))}return s},frost:function(e,r){k(e);var t=_(e),a=r.x,n=T.getEnhancement(e,r.id,a);a+=n;r.all;for(var i=K[t].assaults,o=[],l=e.key-1,s=l+2;l<=s;l++){(h=i[l])&&h.isAlive()&&o.push(l)}if(!o.length)return 0;for(var c=0,d=0,u=o.length;d<u;d++){var h;if((h=i[o[d]]).invisible)h.invisible--,debug&&(echo+=log.name(e)+" breathes frost at "+log.name(h)+" but it is invisible!<br>");else{c++;var f=a,m=B(h,f);$(e,h,f=m.damage,m.shatter,function(e,t,a){echo+="<u>(Frostbreath: +"+r.x,n&&(echo+=" Enhance: +"+n),echo+=m.echo,echo+=") = "+a+" damage</u><br>",echo+=log.name(e)+" breathes frost at "+log.name(t)+" for "+a+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"}),h.backlash&&A(e,h)}}return c},heartseeker:function(e,t){t.y;var a=_(e),r=t.x,n=K[a].assaults[e.key];return n?(r+=T.getEnhancement(e,t.id,r),n.heartseeker+=r,n.enfeebled+=r,debug&&(echo+=log.name(e)+" inflicts heartseeker "+r+" on "+log.name(n)+"<br>"),1):0},enfeeble:function(e,t){for(var a=t.y,r=(k(e),_(e)),n=t.x,i=t.all,o=K[r].assaults,l=[],s=0,c=o.length;s<c;s++){(u=o[s]).isAlive()&&u.isInFaction(a)&&l.push(s)}if(!l.length)return 0;i||(l=b(l)),n+=T.getEnhancement(e,t.id,n);var d=0;for(s=0,c=l.length;s<c;s++){var u;(u=o[l[s]]).invisible?(u.invisible--,debug&&(echo+=log.name(e)+" hexes "+log.name(u)+" but it is invisible!<br>")):(d++,u.enfeebled+=n,debug&&(echo+=log.name(e)+" hexes "+log.name(u)+" by "+n+"<br>"),u.backlash&&A(e,u))}return d},weakenself:function(e,t){return l.weaken(e,t)},weaken:function(e,t){var a,n=t.y;switch(t.id){case"weakenself":a=k(e);break;default:a=_(e)}var r=t.x,i=t.all,o=K[a].assaults,l=[],s=function(e){for(var t=0,a=o.length;t<a;t++){var r=o[t];r.isAlive()&&r.isInFaction(n)&&(i||r.isActiveNextTurn()&&r.isUnjammed()&&(e||r.hasAttack()))&&l.push(t)}};if(s(!1),l.length||s(!0),!l.length)return 0;i||(l=b(l));var c=T.getEnhancement(e,t.id,r);r+=c;for(var d=0,u=0,h=l.length;u<h;u++){var f=o[l[u]];f.invisible?(f.invisible--,debug&&(echo+=log.name(e)+" weakens "+log.name(f)+" but it is invisible!<br>")):(d++,f.attack_weaken+=r,debug&&(c&&(echo+="<u>(Enhance: +"+c+")</u><br>"),echo+=log.name(e)+" weakens "+log.name(f)+" by "+r+"<br>"),f.backlash&&A(e,f))}return d}},h={enlarge:function(e,t){var a=t.y,r=k(e),n=t.x,i=T.getEnhancement(e,t.id,n);n+=i;for(var o=t.all,l=K[r].assaults,s=[],c=0,d=l.length;c<d;c++){(h=l[c]).isAlive()&&h.isInFaction(a)&&(o||h.isUnjammed()&&h.isActive())&&s.push(c)}if(!s.length)return 0;o||(s=b(s));var u=0;for(c=0,d=s.length;c<d;c++){var h=l[s[c]],f=n;if(!f){var m=t.mult;f=Math.ceil(h.attack*m)}h.attack_rally+=f,debug&&(i&&(echo+="<u>(Enhance: +"+i+")</u><br>"),echo+=log.name(e)+" enlarges "+log.name(h)+" by "+f+"<br>"),u++}return u},rally:function(e,t){for(var a=t.y,r=k(e),n=t.x,i=t.all,o=K[r].assaults,l=[],s=0,c=o.length;s<c;s++){(h=o[s]).isAlive()&&h.isInFaction(a)&&(i||h.isActive()&&h.isUnjammed())&&l.push(s)}if(!l.length)return 0;i||(l=b(l));var d=T.getEnhancement(e,t.id,n);n+=d;var u=0;for(s=0,c=l.length;s<c;s++){var h;if((h=o[l[s]]).nullified)h.nullified--,debug&&(echo+=log.name(e)+" empowers "+log.name(h)+" but it is nullified!<br>");else{u++;var f=n;if(!f){var m=t.mult;f=Math.ceil(h.attack*m)}h.attack_rally+=f,debug&&(d&&(echo+="<u>(Enhance: +"+d+")</u><br>"),echo+=log.name(e)+" empowers "+log.name(h)+" by "+f+"<br>")}}return u},legion:function(e,t){var a=k(e),r=K[a].assaults,n=t.x,i=T.getEnhancement(e,t.id,n);n+=i;var o=t.y,l=e.key-1,s=l+2;l<0&&(l+=2);for(var c=0;l<=s;){var d=r[l];d&&d.isActive()&&d.isInFaction(o)&&(d.nullified?(d.nullified--,debug&&(echo+=log.name(e)+" activates legion and empowers "+log.name(d)+" but it is nullified!<br>")):(c++,d.attack_rally+=n,debug&&(i&&(echo+="<u>(Enhance: +"+i+")</u><br>"),echo+=log.name(e)+" activates legion and empowers "+log.name(d)+" by "+n+"<br>"))),l+=2}return c},fervor:function(e,t){var a=k(e),r=K[a].assaults,n=t.x,i=T.getEnhancement(e,t.id,n);n+=i;var o=t.y,l=0,s=e.key-1,c=s+2;for(s<0&&(s+=2);s<=c;){var d=r[s];d&&d.isInFaction(o)&&(l+=n),s+=2}return l?(e.attack_rally+=l,debug&&(i&&(echo+="<u>(Enhance: +"+i+")</u><br>"),echo+=log.name(e)+" activates fervor for "+l+"<br>"),1):0},barrage:function(e,t){var a=_(e),r=t.x,n=t.y,i=t.all,o=K[a].assaults;r+=T.getEnhancement(e,t.id,r);for(var l=0;l<r;l++){for(var s=[],c=0,d=o.length;c<d;c++){(h=o[c]).isAlive()&&h.isInFaction(n)&&s.push(c)}if(!s.length)return 0;i||(s=b(s));var u=0;for(c=0,d=s.length;c<d;c++){var h;if((h=o[s[c]]).invisible)h.invisible--,debug&&(echo+=log.name(e)+" throws a bomb at "+log.name(h)+" but it is invisible!<br>");else{u++;var f=1,m=B(h,f,{enfeeble:!0});$(e,h,f=m.damage,m.shatter,function(e,t,a){echo+="<u>(Barrage: +1",echo+=m.echo,echo+=") = "+a+" damage</u><br>",echo+=log.name(e)+" throws a bomb at "+log.name(t)+" for "+a+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"})}}}return u},enhance:function(e,t){for(var a=t.y,r=k(e),n=(_(e),t.x),i=(a=t.y,t.s),o=t.mult,l=t.all,s=K[r].assaults,c=y(i),d=[],u=0,h=s.length;u<h;u++){(m=s[u]).isAlive()&&m.isInFaction(a)&&(l||!c||m.isActive()&&m.isUnjammed())&&m.hasSkill(i)&&d.push(u)}if(!d.length)return 0;l||(d=b(d));var f=0;for(u=0,h=d.length;u<h;u++){var m;if((m=s[d[u]]).nullified)m.nullified--,debug&&(echo+=log.name(e)+" enhances "+log.name(m)+" but it is nullified!<br>");else{f++;var g=m.enhanced;0<n?(g[i]=(g[i]||0)+n,debug&&(echo+=log.name(e)+" enhances "+i+" of "+log.name(m,!1)+" by "+n+"<br>")):0<o&&(g[i]=-o,debug&&(echo+=log.name(e)+" enhances "+i+" of "+log.name(m,!1)+" by "+100*o+"%<br>"))}}return f},enrage:function(e,t){for(var a=k(e),r=t.y,n=t.x,i=t.all,o=K[a].assaults,l=[],s=0,c=o.length;s<c;s++){(h=o[s]).isAlive()&&h.isInFaction(r)&&l.push(s)}if(!l.length)return 0;i||(l=b(l));var d=T.getEnhancement(e,t.id,n);n+=d;var u=0;for(s=0,c=l.length;s<c;s++){var h,f=n;(h=o[l[s]]).nullified?(h.nullified--,debug&&(echo+=log.name(e)+" enrages "+log.name(h)+" but it is nullified!<br>")):(u++,t.mult&&(f=Math.ceil(t.mult*h.health)),h.enraged+=f,debug&&(d&&(echo+="<u>(Enhance: +"+d+")</u><br>"),echo+=log.name(e)+" enrages "+log.name(h)+" by "+f+"<br>"))}return u},imbue:function(e,t){for(var a=t.y,r=k(e),n=(_(e),t.x),i=(t.c,t.s),o=t.all,l=K[r].assaults,s=y(i),c=[],d=0,u=l.length;d<u;d++){(f=l[d]).isAlive()&&f.isInFaction(a)&&(o||!s||f.isActive()&&f.isUnjammed())&&c.push(d)}if(!c.length)return 0;t={id:i,x:n};o||(c=b(c));var h=0;for(d=0,u=c.length;d<u;d++){var f;if((f=l[c[d]]).nullified)f.nullified--,debug&&(echo+=log.name(e)+" enhances "+log.name(f)+" but it is nullified!<br>");else if(h++,f.hasSkill(i)){var m=f.enhanced;m[i]=(m[i]||0)+n,debug&&(echo+=log.name(e)+" imbues "+log.name(f,!1)+" existing "+log.skill(t)+" by "+n+"<br>")}else f.imbue(t),debug&&(echo+=log.name(e)+" imbues "+log.name(f,!1)+" with "+log.skill(t)+"<br>")}return h},mark:function(e,t){for(var a=t.y,r=(k(e),_(e)),n=t.x,i=t.all,o=K[r].assaults,l=e.mark_target,s=[],c=0,d=o.length;c<d;c++){if((h=o[c]).isAlive()&&h.isInFaction(a)){if(h.uid===l){s=[c];break}s.push(c)}}if(!s.length)return 0;i||(s=b(s)),n+=T.getEnhancement(e,t.id,n);var u=0;for(c=0,d=s.length;c<d;c++){var h;u++,(h=o[s[c]]).enfeebled+=n,e.mark_target=h.uid,debug&&(echo+=log.name(e)+" marks "+log.name(h)+" by "+n+"<br>"),t.countdown=1}return u},snaretongue:function(e,t){for(var a=t.y,r=(k(e),_(e)),n=K[r].assaults,i=(e.mark_target,[]),o=0,l=n.length;o<l;o++){(s=n[o]).isAlive()&&s.isInFaction(a)&&i.push(o)}if(!i.length)return 0;var s=n[i.reduce(function(e,t){return n[t].health_left<n[e].health_left?t:e},i[0])],c=e.key,d=s.key;if(c==c)return debug&&(echo+=log.name(e)+" activates snaretongue and keeps "+log.name(s)+" in front of it<br>"),!1;if(n.splice(s.key,1),n.length<c){CARDS[0]=CARDS[0]||{id:"0",name:"Filler",picture:"",rarity:"0",set:"9999",card_type:"0",type:"0",sub_type:[],health:1,attack:0,cost:0,maxLevel:1,skill:[]};var u=m.byId({id:0,level:1});u.name="filler",u.health_left=0;for(var h=n.length;h<c;h++)n.push(u)}n.splice(c,0,s);h=Math.min(c,d);for(var f=Math.max(c,d);h<=f;h++)n[h].key=h;return debug&&(echo+=log.name(e)+" activates snaretongue and pulls "+log.name(s)+" in front of it<br>"),t.countdown=1}},n={ambush:function(e,t,a){var r=a.x,n=a.base,i=a.mult,o=r;if(!o){i=a.mult;o=Math.ceil(t[n]*i)}return $(e,t,o,null,function(e,t,a){echo+=log.name(e)+" ambushes "+log.name(t)+" for "+a+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"}),1},slow:function(e,t,a){var r=a.x,n=a.base,i=a.mult,o=r;if(!o){i=a.mult;o=Math.ceil(t[n]*i)}return t.timer+=o,debug&&(echo+=log.name(e)+" slows "+log.name(t)+" by "+o+"<br>"),1}},o={unearth:function(e,t,a){if(!e.isToken){var r=makeUnitInfo(a.card||e.id,a.level||a.x),n=m.byIdWithBgeApplied(r,null,!0);n.isToken=!0;var i=a.mult;return i&&(n.attack=Math.floor(e.attack*i),n.health=Math.floor(e.health*i)),c(n,e.owner,!0),debug&&(echo+=log.name(n)+" is unearthed</br>"),1}},reanimate:function(e,t,a){return e.reanimated?0:(e.health_left=a.x,e.reanimated=!0,debug&&(echo+=" and is reanimated</br>"),1)}};function I(e){if(e.silenced)debug&&(echo+=log.name(e)+" is silenced and cannot use skills</br>");else for(var t=e.skill,a=u(e),r=0,n=t.length;r<n&&a();r++){var i=t[r];if(!i.countdown){var o=d(l,i.id)(e,i);i.c&&0<o&&(i.countdown=i.c),showAnimations&&drawField(K,null,null,Z,e)}}}function s(){cache_player_deck=getdeck?e.decodeHash(getdeck):getDefaultDeck(),cache_player_deck_cards=getDeckCards(cache_player_deck,"player"),pvpAI=!0,getdeck2?(cache_cpu_deck=e.decodeHash(getdeck2),getmission&&(pvpAI=!1)):getmission?(cache_cpu_deck=loadDeck.mission(getmission,missionlevel),pvpAI=!1):getraid?(cache_cpu_deck=loadDeck.raid(getraid,raidlevel),pvpAI=!1):cache_cpu_deck=getDefaultDeck(),cache_cpu_deck_cards=getDeckCards(cache_cpu_deck,"cpu")}function f(s){var c=s.uids={};["player","cpu"].forEach(function(e){for(var t=z[e],a=t.deck,r="player"===e?1:101,n=0;n<a.length;n++){var i=r+n,o=a[n];o.owner=e,o.played=!1,o.uid=i,c[i]=o}var l=t.commander;l.owner=e,l.health_left=l.health,l.reusableSkills||l.resetTimers();i="player"===e?-1:-2;l.uid=i,c[i]=l,s[e].commander=l})}function g(e,t){clearFrames(),w(e,t)}function w(e,t){if(SIMULATOR.pause)return SIMULATOR.pause=!1;var a=function(e,t){var a,r;r=surge?(a="cpu","player"):(a="player","cpu");if(0<e){if(X&&(!K.player.commander.isAlive()||!K.cpu.commander.isAlive()))return!(Y=!1);if(!S(e,K,a,r,t))return!1;if(!K.player.commander.isAlive()||!K.cpu.commander.isAlive())return!(Y=!1)}else!surge&&SIMULATOR.sendBattleUpdate&&SIMULATOR.sendBattleUpdate(e);for(e++;e<=max_turns+1;e++){if(e==max_turns+1)return!(Y=!1);C(e,a,r,K);if(!S(e,K,a,r,!0))return!1;if(!K.player.commander.isAlive()||!K.cpu.commander.isAlive())return debug&&(echo+="<u>Turn "+e+" ends</u><br><br></div>"),!(Y=!1)}return!(Y=!1)}(e,t);return a&&Q&&SIM_CONTROLLER.debug_end(),a}function S(e,t,a,r,n){if(e%2)var i=a,o=r;else i=r,o=a;return closeDiv=!1,!!function(e,t,a){var r=z[e],n=r.deck,i=r.ordered;{if(X&&"cpu"===e&&a)return O(e,n,i,t,a),!1;if(n[0]){SIMULATOR.waiting=!1;var o=0;if(1==n.length)o=0;else{for(var l=0;l<n.length;l++){var s=n[l];if(s.trap&&(c(s.trap,e,t),s.trap=!1),2===l)break}o=r.chooseCard(e,n,i,t,a)}if(o<0)return!1;c(n[o],e,t),function(e,t){var a=t,r=e.length-1;for(;a<r;)e[a]=e[++a];e.length=a}(n,o)}}return!0}(i,e,n)&&(function(e,t,a,r){for(var n=a[e],i=n.commander,o=n.assaults,l=a[t],s=l.commander,c=l.assaults,d=0;d<W.onTurn.length;d++){var u=W.onTurn[d];u.enemy_only&&"cpu"!==e||(u.ally_only&&"player"!==e||(u.owner=e,p(u),I(u)))}p(n.commander);for(var h=0,f=o.length;h<f;h++){var m=o[h];F(m,"evade","invisible"),F(m,"absorb","warded")}(function(e){for(var t=e.assaults,a=0,r=t.length;a<r;a++){var n=t[a];if(n.isAlive()&&n.isActive()&&n.isUnjammed()){var i=n.flurry;i&&0===i.countdown&&n.hasAttack()&&(i.countdown=i.c,n.dualstrike_triggered=!0),p(n)}}})(n),I(i);for(var h=0,f=o.length;h<f;h++){var m=o[h];if(m.isAlive()&&m.isActive())if(m.jammed)debug&&(echo+=log.name(m)+" is frozen and cannot attack<br>");else{var g=1;for(m.dualstrike_triggered&&(g++,debug&&(echo+=log.name(m)+" activates dualstrike<br>"));0<g;g--)if(I(m),m.isAlive())if(m.hasAttack()){if(q(m,c,s),!s.isAlive()||!i.isAlive())return;if(!m.isAlive())break}else debug&&0<m.permanentAttack()&&(echo+=log.name(m)+" is weakened and cannot attack<br>")}}(function(e){for(var t=0,a=e.length;t<a;t++){var r=e[t];if(r.jammedSelf?r.jammedSelf=!1:r.jammed=!1,r.attack_rally=0,r.attack_weaken=0,r.nullified=0,r.dualstrike_triggered=!1,r.silenced=!1,r.regenerate&&r.isDamaged()){var n=r.regenerate,i=T.getEnhancement(r,"regenerate",n);n+=i;var o=r.health-r.health_left;o<=n&&(n=o),r.health_left+=n,debug&&(echo+=log.name(r)+" regenerates "+n+" health<br>")}var l=r.poisoned;if(l){var s=r.warded;s&&(l-=H(r,"warded",l)),$(null,r,l,null,function(e,t,a){echo+=log.name(t)+" takes "+a,s&&(echo+=" (Poison: +"+r.poisoned+" Ward: -"+s+")"),echo+=" poison damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"})}var l=r.envenomed;if(l){var s=r.warded;s&&(l-=H(r,"warded",l)),$(null,r,l,null,function(e,t,a){echo+=log.name(t)+" takes "+a,s&&(echo+=" (Venom: +"+r.envenomed+" Ward: -"+s+")"),echo+=" venom damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"})}var c=r.scorched;if(c){l=c.amount;var s=r.warded;s&&(l-=H(r,"warded",l)),$(null,r,l,null,function(e,t,a){echo+=log.name(t)+" takes "+a,s&&(echo+=" (Scorch: +"+c.amount+" Ward: -"+s+")"),echo+=" scorch damage",t.isAlive()?t.scorched||(echo+=" and scorch wears off"):echo+=" and it dies",echo+="<br>"}),1<c.timer?c.timer--:r.scorched=0}var d=r.corroded;if(d)if(d.timer--,d.timer<0)r.corroded=!1,r.attack_corroded=0,debug&&(echo+=log.name(r)+" recovers from corrosion<br>");else{var u=d.amount;r.attack_corroded=u,debug&&(echo+=log.name(r)+" loses "+u+" attack to corrosion<br>")}r.isAlive()||L(r,null)}})(o),v("player"),v("cpu"),debug&&(echo+="<u>Turn "+r+" ends</u><br><br></div>")}(i,o,t,e),!0)}function D(e,t,a){var r=t[a];return r?e+" draws "+log.name(r,!0)+"<br/>":""}function C(e,t,a,r){if(choice=void 0,(J=e)%2)var n=t,i=a;else n=a,i=t;if(debug){var o=log.name(r[n].commander),l=z[n].deck;echo+='<div id="turn_"'+e+' class="turn-info"><hr/><br/><u>Turn '+e+" begins for "+o+"</u><br>",e<=2&&(echo+=D(o,l,0),echo+=D(o,l,1)),echo+=D(o,l,2)}var s=r[n],c=r[i],d=s.assaults,u=c.assaults;j(s.commander);for(var h=0,f=d.length;h<f;h++){var m=d[h];if(0<m.timer&&(3===e&&tournament||(m.timer--,debug&&(echo+=log.name(m)+" reduces its timer<br>"))),m.valor){var g=u[h];g&&m.adjustedAttack()<g.adjustedAttack()?(m.attack_valor+=m.valor,debug&&(echo+=log.name(m)+" activates valor, boosting its attack by "+m.valor+"<br/>")):debug&&(echo+=log.name(m)+" activates valor but ",echo+=g?"enemy is not strong enough.<br/>":"there is no opposing enemy.<br/>")}m.enfeebled=m.envenomed+m.heartseeker,m.enraged=0,m.invisible=0,m.protected=0,m.barrier_ice=0,m.warded=0,m.enhanced={},m.removeImbue(),j(m)}}function O(e,t,a,r,n){return SIMULATOR.waiting=!0,closeDiv=!0,n&&(hideTable(),outputTurns(echo),drawField(K,null,w,r),SIMULATOR.sendBattleUpdate(r)),-1}function R(e,t,a,r,n){var i=t.slice(0,3);closeDiv=!0;for(var o=[],l=[],s=0,c=i.length;s<c;s++){var d=i[s],u=s+": "+d.name;1<d.maxLevel&&(u+="{"+d.level+"/"+d.maxLevel+"}"),o.push(u),l.push(d)}if(n&&(hideTable(),outputTurns(echo),drawField(K,l,g,r)),void 0===choice)return-1;var h=choice;return h||(h=0),h}function M(e,t,a,r,n){if(void 0===a)return 0;for(var i=t.slice(0,3),o=!1,l=0,s=a.length;l<s;l++){for(var c,d=a[l],u=d.priority,h=-1,f=0,m=i.length;f<m;f++){var g=(c=i[f]).priority;if(T.areEqual(d,c)){o=!0;break}0<u&&u==g&&(h=f)}if(!o&&0<=h&&(o=!0,c=i[f=h]),o){for(var v=a.length-1;l<v;l++)a[l]=a[l+1];return a.length=l,f}}return-1}function N(e,t,a,r,n){var i=t.slice(0,3);return~~(Math.random()*i.length)}function U(e,t,a,r,n){for(var i,o,l,s,c,d=t.slice(0,3),u=-1,h=-1,f=0;f<d.length;f++){var m=d[f],g=(void 0,o=(i=m).id.toString(),l=6*parseInt(i.rarity),s=3*(4<o.length?parseInt(o[0]):0),c=parseInt(i.level)-parseInt(i.maxLevel),l+s+c);h<g&&(h=g,u=f)}return u}function P(e,t,a,r,n){return 0}function F(e,t,a){var r=0;e[t]&&(r=e[t],r+=T.getEnhancement(e,t,r));e[a]=r}function B(e,t,a){var r=(a=a||{}).enfeeble?0:e.enfeebled||0,n=a.stasis?0:E(e),i=a.protect?0:e.protected||0,o=a.ward?0:e.warded||0;t+=r-n;var l=!1;o&&(t-=H(e,"warded",t)),i&&(t-=H(e,"protected",t),0==e.protected&&(l=e.barrier_ice)),n&&(t-=n);var s="";return debug&&(r&&(s+=" Enfeeble: +"+r),n&&(s+=" Stasis: -"+n),i&&(s+=" Barrier: -"+i),o&&(s+=" Ward: -"+o)),t<0&&(t=0),{damage:t,shatter:l,echo:s}}function H(e,t,a){var r=e[t];return r<=a?(e[t]=0,r):(e[t]-=a,a)}function j(e){G(e,e.skill),G(e,e.earlyActivationSkills);var t=e.flurry;t&&t.countdown&&(t.countdown--,debug&&(t.countdown?echo+=log.name(e)+" charges  dualstrike (ready in "+t.countdown+" turns)<br/>":echo+=log.name(e)+" readies dualstrike<br/>"))}function G(e,t){for(var a=0,r=t.length;a<r;a++){var n=t[a];n.countdown&&(n.countdown--,debug&&(n.countdown?echo+=log.name(e)+" charges "+i.nameFromId(n.id)+" (ready in "+n.countdown+" turns)<br/>":echo+=log.name(e)+" readies "+i.nameFromId(n.id)+"<br/>"))}}function q(e,t,a){var r=t[e.key];if(r&&r.isAlive()){var n,i=!1;if(!r.taunt)if((n=t[e.key-1])&&n.taunt)r=n,i=!0;else(n=t[e.key+1])&&n.taunt&&(r=n,i=!0);i&&debug&&(echo+=log.name(r)+" taunts "+log.name(e))}else r=a;var o=e.adjustedAttack(),l=r.enfeebled;o+=l,debug&&(echo+="<u>(Attack: +"+e.attack,e.attack_berserk&&(echo+=" Berserk: +"+e.attack_berserk),e.attack_valor&&(echo+=" Valor: +"+e.attack_valor),e.attack_rally&&(echo+=" Rally: +"+e.attack_rally),e.attack_weaken&&(echo+=" Weaken: -"+e.attack_weaken),e.attack_corroded&&(echo+=" Corrosion: -"+e.attack_corroded),l&&(echo+=" Enfeeble: +"+l));var s=e.pierce;s?s+=T.getEnhancement(e,"pierce",s):s=0;var c=r.protected,d=!1,u=r.armored,h=E(r);if(c&&(debug&&(echo+=" Barrier: -"+c),s&&(c<=s?(debug&&(echo+=" Pierce: +"+c),s-=c,c=0,r.protected=0):(debug&&(echo+=" Pierce: +"+s),c-=s,r.protected-=s,s=0)),c&&(c<=o?(d=r.barrier_ice,o-=c,r.protected=0):(r.protected-=o,o=0))),h&&(h+=T.getEnhancement(r,"stasis",h),debug&&(echo+=" Shroud: -"+h),s&&(h<s?(debug&&(echo+=" Pierce: +"+h),h=0):(debug&&(echo+=" Pierce: +"+s),h-=s)),o-=h),u&&(u+=T.getEnhancement(r,"armored",u),debug&&(echo+=" Armor: -"+u),s&&(u<s?(debug&&(echo+=" Pierce: +"+u),u=0):(debug&&(echo+=" Pierce: +"+s),u-=s)),o-=u),o<0&&(o=0),debug&&(echo+=") = "+o+" damage</u><br>"),$(e,r,o,null,function(e,t,a){echo+=log.name(e)+" attacks "+log.name(t)+" for "+a+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"}),showAnimations&&drawField(K,null,null,Z,e),a.isAlive()){if(0<o&&r.isAssault()&&r.isAlive()){if(e.poison){var f=e.poison;(f+=T.getEnhancement(e,"poison",f))>r.poisoned&&(r.poisoned=f,debug&&(echo+=log.name(e)+" inflicts poison("+f+") on "+log.name(r)+"<br>"))}if(e.venom){var m=e.venom;if((m+=T.getEnhancement(e,"venom",m))>r.envenomed){var g=m-r.envenomed;r.envenomed=m,r.enfeebled+=g,debug&&(echo+=log.name(e)+" inflicts venom("+m+") on "+log.name(r)+"<br>")}}if(e.nullify){var v=e.nullify;v+=T.getEnhancement(e,"nullify",v),r.nullified+=v,debug&&(echo+=log.name(e)+" inflicts nullify("+v+") on "+log.name(r)+"<br>")}if(e.silence&&(r.silenced=!0,debug&&(echo+=log.name(e)+" inflicts silence on "+log.name(r)+"<br>")),e.daze){var p=e.daze;p+=T.getEnhancement(e,"daze",p),r.attack_weaken+=p,debug&&(echo+=log.name(e)+" dazed "+log.name(r)+" for "+p+"<br>")}}if(d&&x(r),0<o&&e.isAlive()){if(e.leech&&e.isDamaged()){var b=e.leech;b+=T.getEnhancement(e,"leech",b);var k=e.health-e.health_left;k<=b&&(b=k),e.health_left+=b,debug&&(echo+=log.name(e)+" siphons "+b+" health<br>")}if(e.reinforce){var _=e.reinforce;_+=T.getEnhancement(e,"reinforce",_),e.protected+=_,debug&&(echo+=log.name(e)+" reinforces itself with barrier "+_+"<br>")}if(r.counter){var y=0+r.counter;V(e,r,"Vengance",y,T.getEnhancement(r,"counter",y))}if(r.counterburn){var A=r.counterburn||0;A+=T.getEnhancement(r,"counterburn",A),e.scorched?(e.scorched.amount+=A,e.scorched.timer=2):e.scorched={amount:A,timer:2},debug&&(echo+=log.name(r)+" inflicts counterburn("+A+") on "+log.name(e)+"<br>")}if(r.counterpoison){f=r.counterpoison||0;(f+=T.getEnhancement(r,"counterpoison",f))>e.poisoned&&(e.poisoned=f,debug&&(echo+=log.name(r)+" inflicts counterpoison("+f+") on "+log.name(e)+"<br>"))}if(r.fury){var I=r.fury,w=T.getEnhancement(r,"counter",I);if(r.isAlive()){var S=I+w;r.attack_berserk+=S,debug&&(echo+=log.name(r)+" activates fury and gains "+S+" attack<br>")}V(e,r,"Fury",I,w)}if(0<r.enraged&&(r.attack_berserk+=r.enraged,debug&&(echo+=log.name(r)+" is enraged and gains "+r.enraged+" attack!</br>")),e.berserk){var D=e.berserk;D+=T.getEnhancement(e,"berserk",D),e.attack_berserk+=D,debug&&(echo+=log.name(e)+" activates berserk and gains "+D+" attack<br>")}}if(r.corrosive){var C=r.corrosive||0;C+=T.getEnhancement(r,"corrosive",C),e.corroded?(e.corroded.amount+=C,e.corroded.timer=2):e.corroded={amount:C,timer:2},debug&&(echo+=log.name(r)+" inflicts corrosion("+C+") on "+log.name(e)+"<br>"),e.attack_corroded=C,debug&&(echo+=log.name(e)+" loses "+C+" attack to corrosion<br>")}e.isAlive()||L(e,r),showAnimations&&drawField(K,null,null,Z,e)}}function V(e,t,r,a,n){var i=a+n,o=B(e,i,{enfeeble:!0});i=o.damage;o.shatter;debug&&(echo+="<u>("+r+": +"+a,n&&(echo+=" Enhance: +"+n),echo+=o.echo,echo+=") = "+i+" damage</u><br>"),$(t,e,i,null,function(e,t,a){echo+=log.name(t)+" takes "+a+" "+r.toLowerCase()+" damage",echo+=(t.isAlive()?"":" and it dies")+"<br>"})}SIMULATOR.pause=!1,SIMULATOR.performTurns=w,SIMULATOR.waitForOpponent=O;var W,z={},K={},J=0,Y=!1,Q=!1,X=!1,Z=0,ee=0,te=0;SIMULATOR.simulate=function(){if(Y=!0,function(){SIMULATOR.simulation_turns=0;var e={cpu:{deck:[]},player:{deck:[]}};SIMULATOR.deck=e,SIMULATOR.field={cpu:{assaults:[]},player:{assaults:[]}},cache_player_deck_cards&&(e.player=copy_deck(cache_player_deck_cards)),getmission&&1<missionlevel&&missionlevel<7?(cache_cpu_deck=loadDeck.mission(getmission,missionlevel),cache_cpu_deck_cards=getDeckCards(cache_cpu_deck,"cpu")):getraid&&(cache_cpu_deck=loadDeck.raid(getraid,raidlevel),cache_cpu_deck_cards=getDeckCards(cache_cpu_deck,"cpu")),cache_cpu_deck_cards&&(e.cpu=copy_deck(cache_cpu_deck_cards)),getordered&&!getexactorder&&(e.player.ordered=copy_card_list(e.player.deck)),getordered2&&!getexactorder2&&(e.cpu.ordered=copy_card_list(e.cpu.deck)),e.player.chooseCard=Q?R:getordered?M:N,e.cpu.chooseCard=getordered2?M:pvpAI?U:getexactorder2?N:P}(),getexactorder?getordered||(z.player.shuffleHand=!0):shuffle(z.player.deck),getexactorder2?getordered2||(z.cpu.shuffleHand=!0):shuffle(z.cpu.deck),f(K),getsiege){var e=BATTLEGROUNDS[tower_type].effect[tower_level];if(e){e=makeUnitInfo(e.id,e.level);var t=m.byIdWithBgeApplied(e);t.uid=150,c(K.uids[150]=t,"cpu",-1,!0)}}return w(0)},SIMULATOR.onPlaySkills=n,SIMULATOR.calculatePoints=function(e){var t=K.uids,a={player:{total:0,taken:0},cpu:{total:0,taken:0}};for(var r in t){var n=t[r],i=a[n.owner];i&&(i.total+=n.health,(n.played||n.isCommander())&&(i.taken+=n.health-n.health_left))}a.player.percent=i.taken/i.total,a.cpu.percent=i.taken/i.total;var o=K.cpu.commander;if(getdeck2)if(o.isAlive()&&!e)var l=Math.floor(25*a.cpu.percent);else l=130-Math.floor(15*a.player.percent);else l=o.isAlive()&&!e?(l=Math.floor(a.cpu.percent/.02),Math.max(5,l)):200-Math.floor(a.player.percent/.02);return l},Object.defineProperties(SIMULATOR,{setupDecks:{get:function(){return s},set:function(e){s=e}},setupField:{get:function(){return f},set:function(e){f=e}},deck:{get:function(){return z},set:function(e){z=e}},field:{get:function(){return K},set:function(e){K=e}},battlegrounds:{get:function(){return W},set:function(e){W=e}},simulation_turns:{get:function(){return J},set:function(e){J=e}},simulating:{get:function(){return Y},set:function(e){Y=e}},totalDeckHealth:{get:function(){return ee},set:function(e){ee=e}},totalCpuDeckHealth:{get:function(){return te},set:function(e){te=e}},user_controlled:{get:function(){return Q},set:function(e){Q=e}},livePvP:{get:function(){return X},set:function(e){X=e}}})}(),function(e){"use strict";var t=function(e,t,a){return e.filter(function(e){return e[a]==t})},a=function(e,t,a,r,n){var i=a.filter(function(e){return e.id==t})[0];if(i){var o=i[r];return e.filter(function(e){var t=e[n];return 0<=o.indexOf(t)})}return[]};e.module("core",[]).filter("forMissions",function(){return function(e,t){if(!e||!t)return e;for(var a=[],r=0,n=e.length;r<n;r++){for(var i=e[r],o=i.missions,l=!0,s=0;s<o.length;s++){if(!t[o[s]]){l=!1;break}}l&&a.push(i)}return a}}).filter("filterByParent",function(){return t}).filter("filterChildren",function(){return a}),e.module("simulatorApp",["core"]).controller("SimulatorCtrl",["$scope","$window",function(n,e){function t(e){var t=Object.keys(e);t.sort(function(e,t){return Number(e)-Number(t)});for(var a=[],r=0;r<t.length;r++){var n=t[r],i=e[n];a.push(i)}return a}function a(e){var t=[];for(var a in e)t.push(e[a]);return t}n.locations=[],n.campaigns=[],n.missions=e.TITANS,n.raids=e.RAIDS,n.battlegrounds=e.BATTLEGROUNDS,n.mapBattlegrounds=a(e.MAP_BATTLEGROUNDS),n.campaignBGEs=[],n.tower=!1,n.auto=!1,n.debugMode=!1,n.selections={location:"",campaign:"",mission:"",raid:""},n.titans=function(){n.campaigns=a(e.CAMPAIGNS),n.missions=e.TITANS},n.campaignSections=function(){n.locations=t(e.LOCATIONS).sort(function(e,t){return Number(e.id)-Number(t.id)}),n.missions=t(e.MISSIONS),n.campaigns=t(e.CAMPAIGNS)},n.filteredRaids=function(){var t={};return a(n.raids).sort(function(e,t){return Number(t.id)-Number(e.id)}).forEach(function(e){t[e.name]||(t[e.name]=e)}),a(t).sort(function(e,t){return Number(e.id)-Number(t.id)})},n.getLocationClass=function(e){if(!e){var t=n.selections.location;e=n.locations.filter(function(e){return e.id==t})[0]}if(e){var a=Number(e.id);return 0===a?"heroUpgrade":100<=a?"event":"black"}return"grey"},n.getCampaignClass=function(e){if(!e){var t=n.selections.campaign;e=n.campaigns.filter(function(e){return e.id==t})[0]}return e?e.side_mission?0==e.location_id?"heroUpgrade":"mythic":e.isLocation?"location":"black":"grey"},n.$watch("selections.location",function(e,t){n.selections.campaign=""}),n.$watch("selections.campaign",function(e,t){n.selections.mission=""}),n.towerTypes=["Castle Tower","Cannon Tower","Tree of Life"],n.selectableBattlegrounds=function(){var e=[];for(var t in n.battlegrounds){var a=n.battlegrounds[t];a.hidden||a.isTower||e.push(a)}return e.sort(function(e,t){return e.id-t.id}),e},n.personalBattlegrounds=function(){var e=[];for(var t in n.battlegrounds){var a=n.battlegrounds[t],r=Number(a.id);1e3<r&&r<2e3&&e.push(a)}return e.sort(function(e,t){return e.id-t.id}),e},n.towerTypes=function(){var e=[];for(var t in n.battlegrounds){var a=n.battlegrounds[t];a.isTower&&e.push(a)}return e.sort(function(e,t){return e.id-t.id}),e},n.$watch("debugMode",function(e,t){})}])}(angular);var loadDeckDialog,mapBGEDialog,storageAPI={};function doneLoading(){$("body").removeClass("loading"),checkTutorial()}function updateGameData(e){var t=doneLoading;e&&(t=function(){doneLoading(),e()}),DATA_UPDATER.updateData(t,!0)}function setDeckSortable(e,s){$(e).sortable({items:".card:not(.commander):not(.blank)",tolerance:"intersect",helper:function(e,t){return t.clone()},start:function(e,t){var a=t.placeholder.index()-1;t.item.data("origPos",a),$(t.item).hide()},stop:function(e,t){var a=t.item.data("origPos")-1,r=t.item.index()-1,n=$(s),i=base64.decodeHash(n.val()),o=i.deck;o.splice(r,0,o.splice(a,1)[0]);var l=base64.encodeHash(i);n.val(l)}})}function showMapBGEs(){mapBGEDialog.dialog("open"),mapBGEDialog.dialog("option","position",{my:"center",at:"center",of:window})}function loadDeck(e){$('label[for="loadDeckName"]').html("<strong>Deck:</strong>"),loadDeckDialog.dialog("open"),loadDeckDialog.dialog("option","position",{my:"center",at:"center",of:window}),loadDeckDialog.hashField=e}function onDeckLoaded(e,t){$(t).val(e).change()}!function(t){"use strict";var a;try{a=t.module("simulatorApp")}catch(e){a=t.module("simulatorApp",[])}a.controller("DeckStorageCtrl",["$scope","$window",function(e,t){e.getSavedDecks=t.storageAPI.getSavedDecks,e.keys=function(e){return e?Object.keys(e):[]}}])}(angular),function(e){try{var t=window.localStorage,a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(e){return!1}}()?function(){var n=require("urlHelpers"),i="SavedDecks",o="Tutorial";function l(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){t={}}else t={};return storageAPI.data[e]=t}storageAPI.initialize=function(){var e,t=n.getCurrentPage();void 0===(e=l(i)).savedDecks&&storageAPI.setField(i,"savedDecks",e),storageAPI.getField(i,"savedDecks",{}),storageAPI.shouldShowTutorial=storageAPI.getField(o,t,!0)[t];var a=storageAPI.onUpdateDecks;storageAPI.onUpdateDecks=function(e){a(),storageAPI.setField(i,"savedDecks",e)};var r=storageAPI.setShowTutorial;storageAPI.setShowTutorial=function(e){r(e),storageAPI.setField(o,t,e)}},storageAPI.getField=function(e,t,a){var r=l(e)[t];return void 0===r&&(r=a,storageAPI.setField(e,t,r)),r},storageAPI.setField=function(e,t,a){var r=l(e);r[t]=a,localStorage.setItem(e,JSON.stringify(r))},window.addEventListener("storage",function(e){"__storage_test__"!==e.key&&(localStorage.getItem(e.key)!==e.newValue&&angular.element("#loadDeckDialog").scope().$apply(localStorage.setItem(e.key,e.newValue)))})}():function(){storageAPI.initialize=function(){storageAPI.getSavedDecks=function(){return{}},storageAPI.loadDeck=e,storageAPI.deleteDeck=e,storageAPI.clearDecks=e,storageAPI.getField=function(e,t,a){return a},storageAPI.setField=function(){},storageAPI.savedDecks={},storageAPI.shouldShowTutorial=!0};var e=function(e,t){alert("Your browser does not support this feature.")}}(),function(){var e,t="SavedDecks";storageAPI.data={},storageAPI.getSavedDecks=function(){return storageAPI.getField(t,"savedDecks",{})},storageAPI.saveDeck=function(e,t){var a=storageAPI.getSavedDecks();a[e]=t,storageAPI.onUpdateDecks(a)},storageAPI.loadDeck=function(e){return storageAPI.getSavedDecks()[e]},storageAPI.deleteDeck=function(e){var t=storageAPI.getSavedDecks();delete t[e],storageAPI.onUpdateDecks(t)},storageAPI.clearDecks=function(e){var t=storageAPI.getSavedDecks();for(var e in t)delete t[e];storageAPI.onUpdateDecks(t)},storageAPI.onUpdateDecks=function(){e||(e=angular.element("#loadDeckDialog").scope()),e.$apply()},storageAPI.setShowTutorial=function(e){shouldShowTutorial=e},storageAPI.initialize()}(),$(function(){var i=require("bgeApi"),r=require("base64"),o=require("urlHelpers");$("#deck1").change(function(){this.value=this.value.trim(),l("attack_deck",r.decodeHash(this.value),"player")}),$("#deck2").change(function(){this.value=this.value.trim(),l("defend_deck",r.decodeHash(this.value),"cpu")}),$("#battleground").change(function(){$("#deck1").change(),$("#deck2").val()?$("#deck2").change():$("#mission").val()?$("#mission").change():$("#raid").val()&&$("#raid").change()});for(var e=$("label[bge-desc]"),t=0;t<e.length;t++){$(e[t]).hover(a,n)}function a(e){var t=$("#tooltip"),a=$("#tooltip-text");a.html($(e.target).attr("bge-desc")),a.width(200),t.show(),$("#tooltip .arrow").css("borderTopWidth",0).css("borderBottomWidth",0);var r=$(e.target).offset();r.left-=230,r.top-=t.outerHeight()/2-10,t.offset(r);var n=a.innerHeight()/2-4;$("#tooltip .arrow").css("borderTopWidth",n).css("borderBottomWidth",n)}function n(e){$("#tooltip").hide()}function l(e,t,a){var r=$("#"+e);if(r.children().remove(),!o.paramDefined("seedtest")){SIM_CONTROLLER.getConfiguration();var n=i.getBattlegrounds(getbattleground,selfbges,enemybges,mapbges,getcampaign,missionlevel,getraid,raidlevel);n=n.onCreate.filter(function(e){return!("player"===a&&e.enemy_only||"cpu"===a&&e.ally_only)}),r.append(CARD_GUI.makeDeckHTML(t,!1,n))}}$(".accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}).filter(".start-open").accordion("option","active",0);if($("#raid, #raid_level").change(function(){var e,t=$("#raid").val(),a=$("#raid_level");t?(e=loadDeck.raid(t,a.val()),"Dungeon"===RAIDS[t].type?a.attr("max",150):a.attr("max",40)):(e=r.decodeHash(""),a.attr("max",40)),l("defend_deck",e,"cpu")}),$("#location, #campaign").change(function(){$("#mission").change()}),$("#mission, #mission_level").change(function(){var e,t=$("#mission").val();if(t){var a=$("#mission_level").val();e=loadDeck.mission(t,a)}else e=r.decodeHash("");l("defend_deck",e,"cpu")}),loadDeckDialog=$("#loadDeckDialog").dialog({autoOpen:!1,minWidth:320,modal:!0,resizable:!1,buttons:{Delete:function(){var e=$("#loadDeckName").val();storageAPI.deleteDeck(e)},Load:function(){var e=$("#loadDeckName").val();onDeckLoaded(storageAPI.loadDeck(e),loadDeckDialog.hashField),loadDeckDialog.dialog("close")},Cancel:function(){loadDeckDialog.dialog("close")}}}),mapBGEDialog=$("#bgeDialog").dialog({autoOpen:!1,minWidth:320,modal:!0,resizable:!1,buttons:{OK:function(){mapBGEDialog.dialog("close")},Cancel:function(){mapBGEDialog.dialog("close")}}}),l("attack_deck",r.decodeHash("")),l("defend_deck",r.decodeHash("")),setDeckSortable("#attack_deck","#deck1"),setDeckSortable("#defend_deck","#deck2"),o.paramDefined("latestCards")){var s=null;o.paramDefined("autostart")&&(s=function(){SIM_CONTROLLER.startsim(1)}),updateGameData(s)}else loadCardCache();processQueryString()});var dark=!1;function toggleTheme(){dark?($("#theme").attr("href","dist/light.min.css"),$("#toggleTheme").val("Dark Theme")):($("#theme").attr("href","dist/dark.min.css"),$("#toggleTheme").val("Light Theme")),dark=!dark}var frames=[],frameInterval=null;function drawField(e,t,a,r,n){var i=CARD_GUI.doDrawField(e,t,a,r,n);frames.push(i),frameInterval||(drawFrames(),frameInterval=setInterval(drawFrames,500))}function clearFrames(){frames=[],clearInterval(frameInterval),frameInterval=null}var deckPopupDialog,disabledInterval=!1;function drawFrames(){if(0===frames.length)disabledInterval?(clearInterval(frameInterval),frameInterval=null):disabledInterval=!0;else{var e=frames.splice(0,1)[0];$("#cardSpace").children().remove().end().append(e),disabledInterval=!1}}var style,base64=require("base64"),urlHelpers=require("urlHelpers");function processQueryString(){if($("#header").load("templates/header.html",function(){"undefined"!=typeof showTutorial&&$("#help").click(showTutorial)}),$.holdReady(!0),$("#footer").load("templates/footer.html",function(){$.holdReady(!1)}),!document.getElementById("ui"))return 0;angular.element(document.getElementById("ui")).scope();$("#generate_link").on("click",display_generated_link),$("#btn_simulate").on("click",SIM_CONTROLLER.startsim),$("#btnStop").on("click",SIM_CONTROLLER.stopsim),$("#display_history").on("click",display_history),$("#deck1").val(urlHelpers.paramValue("deck1")).change(),$("#deck2").val(urlHelpers.paramValue("deck2")).change(),$("#surge").prop("checked",urlHelpers.paramDefined("surge")),$("#siege").prop("checked",urlHelpers.paramDefined("siege"));var e=Math.min(Math.max(urlHelpers.paramValue("tower_level")||18,0),18);$("#tower_level").val(e);var t=urlHelpers.paramValue("tower_type")||501;$("#tower_type").val(t),$("#auto_mode").prop("checked",urlHelpers.paramDefined("auto_mode")),$("#tournament").prop("checked",urlHelpers.paramDefined("tournament")),$("#ordered").prop("checked",urlHelpers.paramDefined("ordered")),$("#exactorder").prop("checked",urlHelpers.paramDefined("exactorder")),$("#ordered2").prop("checked",urlHelpers.paramDefined("ordered2")),$("#exactorder2").prop("checked",urlHelpers.paramDefined("exactorder2")),urlHelpers.paramDefined("randomAI")&&(pvpAI=!1);var a=urlHelpers.paramValue("location"),r=urlHelpers.paramValue("campaign"),n=urlHelpers.paramValue("mission"),i=urlHelpers.paramValue("raid");if(a&&$("#location").val(a).change(),r&&(a||(a=CAMPAIGNS[r].location_id,$("#location").val(a).change()),$("#campaign").val(r).change()),n&&($("#mission_level").val(urlHelpers.paramValue("mission_level")||7),$("#mission").val(n).change()),i&&($("#raid_level").val(urlHelpers.paramValue("raid_level")||25),$("#raid").val(i).change()),urlHelpers.paramDefined("bges"))for(var o=urlHelpers.paramValue("bges"),l=0;l<o.length;l+=2){var s=base64.toDecimal(o.substring(l,l+2));$("#battleground_"+s).prop("checked",!0)}else for(document.getElementsByName("battleground"),l=0;l<current_bges.length;l++)$("#battleground_"+current_bges[l]).prop("checked",!0);if(o=urlHelpers.paramValue("selfbges"))for(l=0;l<o.length;l+=2){s=base64.toDecimal(o.substring(l,l+2))+1e4;$("#self-battleground_"+s).prop("checked",!0)}if(o=urlHelpers.paramValue("enemybges"))for(l=0;l<o.length;l+=2){s=base64.toDecimal(o.substring(l,l+2))+1e4;$("#enemy-battleground_"+s).prop("checked",!0)}var c=urlHelpers.paramValue("mapBges");if(c&&setSelectedMapBattlegrounds(c),$("#battleground").change(),$("#sims").val(urlHelpers.paramValue("sims")||1e4),urlHelpers.paramDefined("debug")&&$("#debug").click(),urlHelpers.paramDefined("mass_debug")&&$("#mass_debug").click(),urlHelpers.paramDefined("loss_debug")&&$("#loss_debug").click(),urlHelpers.paramDefined("win_debug")&&$("#win_debug").click(),urlHelpers.paramDefined("play_debug")&&$("#play_debug").click(),document.title="SimSpellstone "+text_version+" - The Spellstone Simulator that runs from your browser!",urlHelpers.paramDefined("autostart")&&!urlHelpers.paramDefined("latestCards"))SIM_CONTROLLER.startsim(1);else if(urlHelpers.paramDefined("unit_tests")){var d=document.getElementsByTagName("body")[0],u=document.createElement("script");u.src="scripts/unit_tests.js",d.appendChild(u),u.onload=function(){var e=document.createElement("script");e.src="scripts/unit_test_runner.js",d.appendChild(e)}}document.getElementById("missionDeckDialog")&&(deckPopupDialog=$("#missionDeckDialog").dialog({autoOpen:!1,minWidth:500,minHeight:20,modal:!0,resizable:!1,draggable:!1,buttons:{Close:function(){deckPopupDialog.dialog("close")}},open:function(e,t){$(".ui-dialog-titlebar-close",t.dialog|t).hide()}}))}window.addEventListener("error",function(e,t,a){var r="JavaScript error:\n "+e+"\n on line "+a+"\n for "+t;if(window.sa("send","exception",{exDescription:r,exFatal:!1}),0===a){var n="<br><br><i>Error Message:</i><br><br><i>It appears you're having trouble loading SimSpellstone. Thanks.</i><br><br>";return outp?outp(n):document.write(n),1}r+="\n",r+="Browser CodeName: "+navigator.appCodeName+"\n",r+="Browser Name: "+navigator.appName+"\n",r+="Browser Version: "+navigator.appVersion+"\n",r+="Cookies Enabled: "+navigator.cookieEnabled+"\n",r+="Platform: "+navigator.platform+"\n",r+="User-agent header: "+navigator.userAgent+"\n",r+="SimSpellstone version: "+text_version+"\n",getdeck&&(r+="Deck hash: "+getdeck+"\n"),getcardlist&&(r+="Card list: "+getcardlist+"\n"),getordered&&(r+="Ordered: Yes\n"),getexactorder&&(r+="Exact-order: Yes\n"),surge&&(r+="Surge: Yes\n"),getdeck2&&(r+="Enemy deck hash: "+getdeck2+"\n"),getcardlist2&&(r+="Enemy Card list: "+getcardlist2+"\n"),getordered2&&(r+="Enemy Ordered: Yes\n"),getexactorder2&&(r+="Enemy Exact-order: Yes\n"),getmission&&(r+="Mission ID: "+getmission+"\n"),getraid&&(r+="Raid ID: "+getraid+"\n"),getbattleground&&(r+="Battleground ID: "+getbattleground+"\n"),games&&(r+="Sims run so far: "+games+"\n"),outp('<br><br><i>Error Message:</i><br><textarea cols=50 rows=6 onclick="this.select()"><blockquote>'+r+"</blockquote></textarea>"+echo),current_timeout&&clearTimeout(current_timeout)});var u_black=!1;function toggle_u(){var e=!1;if(void 0===style)e=!0,style=document.createElement("style");else for(;style.hasChildNodes();)style.removeChild(style.firstChild);var t,a=document.getElementsByTagName("head")[0];t=u_black?(u_black=!1,document.createTextNode("u { text-decoration: none; font-style:normal; color: #dddddd; font-weight: normal; }")):(u_black=!0,document.createTextNode("u { text-decoration: none; font-style:normal; color: #000000; font-weight: normal; }")),style.type="text/css",style.styleSheet?style.styleSheet.cssText=t.nodeValue:style.appendChild(t),!0===e&&a.appendChild(style)}function toggleUI(e){e?$("#ui").show():$("#ui").hide()}function showUI(){toggleUI(!0),document.getElementById("stop").style.display="none"}function hideUI(){$(".accordion").accordion("option","active",null),toggleUI(!1),document.getElementById("stop").style.display="block"}function getSelectedBattlegrounds(e){e=e||"";for(var t=[],a=document.getElementsByName(e+"battleground"),r=0;r<a.length;r++){var n=a[r];n&&n.checked&&t.push(n.value)}return t=t.join()}function getSelectedMapBattlegrounds(){for(var e=[],t=$("#location").val(),a=document.getElementsByName("map-battleground"),r=0;r<a.length;r++){var n=a[r];0<n.value&&e.push(t+"-"+r+"-"+n.value)}return e=e.join()}function setSelectedMapBattlegrounds(e){for(var t=document.getElementsByName("map-battleground"),a=0;a<e.length&&a<t.length;a++)t[a].value=e[a]}function outp(e){$("#content").html(e)}function outputTurns(e){closeDiv&&(e+="</div>",closeDiv=!1),outp(e="<input id='show-turns' type='button' value='Show All' /> <div id='turn-container'>Turn: <select id='turn-picker'></select></div> <div>"+e+"</div>");for(var t=$(".turn-info").hide().length,a=[],r=0;r<t;r++){var n=r+1;a.push("<option value='"+r+"'>"+n+"</option>")}var i=r-1;i&&closeDiv&&i--,$("#turn-picker").append(a).change(function(e){var t=e.target.selectedIndex;$(".turn-info").hide().eq(t).show()}).val(i).change();var o=!0;$("#show-turns").click(function(){if(o=!o){var e=$("#turn-picker").val();$(".turn-info").hide().eq(e).show(),$("#turn-container").show(),this.value="Show All"}else $(".turn-info").show(),$("#turn-container").hide(),this.value="Show One"})}function showWinrate(){if(suppressOutput);else if(debug||0==sims_left){var e="";if(e+='<br><br><i>Non-autostart link</i><br><a href="'+generate_link()+'">'+generate_link()+'</a><br><br><i>Autostart link</i><br><a href="'+generate_link(1)+'">'+generate_link(1)+"</a><br><br>",debug)return e}var t=(100*(wins/games)).toFixed(2)+"%";$("#wins").html(wins),$("#winrate").html(t);var a=losses/games*100;a=a.toFixed(2)+"%",$("#losses").html(losses),$("#lossrate").html(a);var r=draws/games*100;r=r.toFixed(2)+"%",$("#draws").html(draws),$("#drawrate").html(r);var n=marginOfError(wins,games);$("#marginGames").html((n*games).toFixed(0)),n=n.toFixed(2)+"%",$("#marginPercent").html(n);var i=(100*games/(games+sims_left)).toFixed("2")+"%";$(".battleCount").html(games),$("#percentComplete").html(i),$("#avgLength").html((total_turns/games).toFixed(1)),$("#avgPoints").html((points/games).toFixed(2)),$("#winrateTable").show();var o="";if(0==sims_left){o+=e;var l="",s=[],c=document.getElementById("deck1").value;c&&(s.player=base64.decodeHash(c)),s.player&&(l=base64.encodeHash(s.player)),battle_history+=t+" (+/- "+n+") &nbsp; &nbsp; "+l+"<br>"}return o}function hideTable(){$("#winrateTable").hide()}function setSimStatus(e,t,a){if($("#simStatusMsg").html(e),t&&a){var r=games+sims_left,n=(100*games/r).toFixed("2")+"%",i="("+games+"/"+r+") "+n;$("#progress").html(i),$("#speed").show(),$("#elapsed").html(t),$("#simsPerSec").html(a)}else $("#progress").html(""),$("#speed").hide();$("#simulationStatus").show()}function winrateDev(e,t){if(t<=1)return 1;var a=e/t,r=t;return Math.sqrt(r*a*(1-a))}function marginOfError(e,t){if(t<=1)return 1;var a=e/t,r=t;return 100*(1.96*Math.sqrt(a*(1-a)/r)+.5/r)}function generate_link(e){var t=0,a=document.URL,r=a.indexOf("?");0<r&&(a=a.substring(0,r));var n=[];addValueParam(n,"deck1"),addValueParam(n,"deck2"),addValueParam(n,"location"),addValueParam(n,"campaign"),addValueParam(n,"mission"),addValueParam(n,"mission_level"),addValueParam(n,"raid"),addValueParam(n,"raid_level");var i=$("select[name=map-battleground]").toArray().reduce(function(e,t){return e+t.value},"");i.length&&n.push("mapBges="+i),addBoolParam(n,"surge"),addBoolParam(n,"siege")&&(addValueParam(n,"tower_level"),addValueParam(n,"tower_type")),addBoolParam(n,"auto_mode"),addBoolParam(n,"tournament"),addBoolParam(n,"ordered"),addBoolParam(n,"exactorder"),addBoolParam(n,"ordered2"),addBoolParam(n,"exactorder2");for(var o="",l=document.getElementsByName("battleground"),s=0;s<l.length;s++)(t=l[s]).checked&&(o+=base64.fromDecimal(t.value,2));n.push("bges="+o);for(o="",l=document.getElementsByName("self-battleground"),s=0;s<l.length;s++)(t=l[s]).checked&&(o+=base64.fromDecimal(t.value-1e4,2));o&&n.push("selfbges="+o);for(o="",l=document.getElementsByName("enemy-battleground"),s=0;s<l.length;s++)(t=l[s]).checked&&(o+=base64.fromDecimal(t.value-1e4,2));return o&&n.push("enemybges="+o),addValueParam(n,"sims"),addBoolParam(n,"debug"),addBoolParam(n,"mass_debug"),addBoolParam(n,"loss_debug"),addBoolParam(n,"win_debug"),addBoolParam(n,"play_debug"),e&&n.push("autostart"),0<n.length?a+"?"+n.join("&"):a}function addValueParam(e,t,a){var r=$("#"+(a||t)).val();return!!r&&(e.push(t+"="+r),!0)}function addBoolParam(e,t){return!!$("#"+t).is(":checked")&&(e.push(t),!0)}function load_deck_builder_for_field(e){var t=$("#"+e),a=t.val();a||(a=base64.encodeHash({commander:elariaCaptain,deck:[]})),open_deck_builder("Card Hash",a,null,t)}var deckBuilders={};function load_deck_builder(e){if("player"===e)var t=$("#deck1").val();else{t=$("#deck2").val();var a=$("#mission").val(),r=$("#mission_level").val(),n=$("#raid").val(),i=$("#raid_level").val()}var o,l={commander:elariaCaptain,deck:[]};t?l=base64.decodeHash(t):a?l=loadDeck.mission(a,r):n&&(l=loadDeck.raid(n,i)),l&&(o=base64.encodeHash(l));var s="player"==e?"Player Deck":"Enemy Deck",c=e?$("#"+("player"==e?"deck1":"deck2")):null,d=deckBuilders[e];null==d||d.closed?deckBuilders[e]=open_deck_builder(s,o,null,c):d.focus()}function open_deck_builder(e,t,a,r){var n=["nosort"];t&&n.push("hash="+t),a&&n.push("inventory="+a),e&&n.push("name="+e),urlHelpers.paramDefined("ajax")&&n.push("ajax"),n.push("fromSim");var i,o="DeckBuilder.html?"+n.join("&"),l=Math.min(screen.width,1e3),s=Math.min(screen.height,700),c=Number((screen.width-l)/2),d=Number((screen.height-s)/2),u="scrollbars,left="+c+"top="+d+",width="+l+",height="+s+",top="+d+",left="+c,h=window.open(o,"",u);return $(h).load((i=r,function(){i&&(h.updateSimulator=function(e){i.val(e).change()})})),h}function display_generated_link(){outp('<br><i>Non-autostart link</i><br><a href="'+generate_link()+'">'+generate_link()+'</a><br><br><i>Autostart link</i><br><a href="'+generate_link(1)+'">'+generate_link(1)+"</a><br><br>")}function clear_history(){battle_history="",display_history()}function display_history(){outp("<br><hr>"+(battle_history||"No history available.")+'<hr><br><br><input type="button" value="Clear History" onclick="clear_history();" style="text-align: center; font-weight: normal;"><br><br>')}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}var current_timeout,cache_player_deck,cache_cpu_deck,cache_player_deck_cards,cache_cpu_deck_cards,battle_history="",max_turns=100,debug=!1,mass_debug=!1,loss_debug=!1,win_debug=!1,found_desired=!1,play_debug=!1,showAnimations=!1,getdeck="",getdeck2="",getcardlist="",getcardlist2="",getordered=!1,getordered2=!1,getexactorder=!1,getexactorder2=!1,getcampaign=0,getmission=0,missionlevel=0,getraid=!1,raidlevel=0,getbattleground="",enemybges="",selfbges="",mapbges="",getsiege=0,tower_level=0,tower_type=0,pvpAI=!0,echo="",closeDiv=!1,wins=0,losses=0,draws=0,games=0,points=0,num_sims=0,last_games=[],sims_left=0,surge=!1,battleground=[],total_turns=0,choice=void 0,auto_mode=!1,tournament=!1,suppressOutput=!1,orders={},cardStats={},CARD_GUI={};function createImg(e,t){return $("<img>").addClass(t).attr("src",e)[0]}function createDiv(e,t){return $("<div>").addClass(e).html(t)[0]}function createSpan(e,t){return $("<span>").addClass(e).html(t)[0]}function getTutorialScript(){for(var e=[{msg:"Welcome to SIM Spellstone!  This is a brief tutorial of how to use the Simulator."},{ui:"#setup-container",msg:"Here is where you set everything up for a simulation.",actions:[i]},{ui:"#setup-container",msg:'When you are done, you can click the "Setup" bar to hide this section.',actions:[n]},{ui:"#setup-container",msg:"Clicking it again will open it back up.",actions:[i]},{ui:"#attacker-container",msg:"Use this section to set up the deck for the attacker."},{ui:"#edit-player",msg:'Click "Edit" to open the DeckBuilder and create a deck.'},{ui:"#load-player",msg:'Click "Load" to choose a deck from the ones you have saved in the DeckBuilder.'},{ui:"#attacker-hash-container",msg:"If you have a deck hash, you can simply paste it here as well."},{ui:"#attacker-advanced",msg:"This section contains some additional settings for the attacker that determine how their deck is played."},{ui:"#auto-container",msg:"Check this to have fights run on auto, rather than playing them yourself.",showFor:"battle"},{ui:"#auto-container",msg:'Setting the attacker to "auto" also enables the "Ordered" and "Do Not Shuffle" options.',showFor:"battle"},{ui:"#ordered-container",msg:"Check this to have the AI attempt to play the attacker's deck as close as possible to the order that the cards are listed."},{ui:"#exactorder-container",msg:"Check this to disable shuffling of the attacker's deck."},{ui:"#defender-container",msg:"Use this section to set up the deck for the defender."},{ui:"#defender-hash-container",msg:"You can manually create a deck for the defender here."},{ui:"#pve-container",msg:"Or you can choose a PvE deck to sim against.",actions:[s]},{ui:"#campaign-container",msg:"To choose a campaign mission, first pick a Campaign from the dropdown...",actions:[l]},{ui:"#mission-container",msg:"... then pick a Mission from the mission dropdown.",actions:[c,l,function(){$("#mission").val(11).change()}]},{ui:"#raid-container",msg:"To fight against a raid boss, pick the desired Raid from the dropdown",actions:[s,function(){$("#raid").val(24005).change()}]},{ui:"#defender-advanced",msg:"This section contains some additional settings for the defender that determine how their deck is played.",actions:[c]},{ui:"#surge-container",msg:"Check this to have the defender go first.",showFor:"battle"},{ui:"#tower-container",msg:"Use these fields to set up a tower for the defender."},{ui:"#siege-container",msg:"Check this field to turn the tower on."},{ui:"#tower_level",msg:"This field determines the BR of the defender.  The tower's level is one less than the defender's BR."},{ui:"#tower_type",msg:"This field determines which type of tower the defender will have."},{ui:"#bge-container",msg:"Check/uncheck boxes here to set active battleground effects.",actions:[o,i]},{ui:"#view-container",msg:'Click "View" to display the currently set decks for the attacker and defender.',actions:[n,function(){$("#view-container").accordion("option","active",0)}]},{ui:"#view-container",msg:"Click it again to hide it.",actions:[o]},{ui:"#sims-container",msg:"This field determines how many fights to run.",showFor:"titans"},{ui:"#btn_simulate",msg:'Click "Simulate" to run a batch of fights.',showFor:"titans"},{ui:"#btn_simulate",msg:'Click "Battle" to start a fight.',showFor:"battle"},{ui:"#generate_link",msg:'Click "Generate Link" to create a link that will open this tool with all of the current settings.'},{msg:'To view this tutorial again at any time, you can click the "Help" button.  (Note: this will reset the Simulator.)'}],t=require("urlHelpers").getCurrentPage(),a=0;a<e.length;a++){var r=e[a];r.showFor&&r.showFor!==t&&e.splice(a--,1)}function n(){$("#setup-container").accordion("option","active",null)}function i(){$("#setup-container").accordion("option","active",0)}function o(){$("#view-container").accordion("option","active",null)}function l(){$("#campaign").val(1).change()}function s(){$("#campaign").val("").change()}function c(){$("#raid").val("").change()}return e}!function(){var g=require("cardApi"),P=require("cardInfo"),F=require("runeApi"),B=require("factions"),v=require("unitInfo"),t="";function r(e,t,a){var r=[],n=g.byId(e.commander);r.push(b(n,!1,!1));for(var i=0,o=e.deck.length;i<o;i++){var l=e.deck[i];if(a)var s=g.byIdWithBgeApplied(l,a);else s=g.byId(l);r.push(b(s,!1,!1))}if(!t)for(;i<15;i++)r.push(createDiv("card blank"));return r}function s(e,t,a,r,n,i){var o,l,s;n=n||0;for(var c=0,d=[],u=0,h=e.length;u<h&&(!i||c<i);u++){var f=e[u],m=g.byId(f);v.areEqual(m,l)?s++:(n<=c&&(p(o,s),(o=b(m,t,!(s=1),a,r,null,u)).setAttribute("data-i",u),void 0!==f.index&&o.setAttribute("data-index",f.index),d.push(o)),l=m,c++)}return p(o,s),d}function i(e,t,a,r,n){t||(t=[]);var i=[];if(r){var o=document.createElement("h1");o.innerHTML="Turn: "+r+" (Currently at "+SIMULATOR.calculatePoints(!0)+" points)",i.push(o)}var l=createDiv("field"),s=null;if(n){s=n.owner;n=n.isCommander()?-1:n.key}return"player"===s?(l.appendChild(c(e.cpu)),l.appendChild(c(e.player,n))):(l.appendChild(c(e.cpu,n)),l.appendChild(c(e.player))),i.push(l),i.push(d(t,a,r)),i.push(document.createElement("br")),i.push(document.createElement("br")),i}function c(e,t){var a=createDiv("float-left"),r=b(e.commander,!1,!0);-1===t&&u(r),a.appendChild(r);var n=e.assaults;if(n)for(var i=0,o=n.length;i<o;i++){var l=n[i];r=b(l,!1,!0);l.timer&&r.classList.add("inactive"),t===i&&u(r),a.appendChild(r)}return a}function d(e,t,a){for(var r=createDiv("float-left hand"),n=0,i=e.length;n<i;n++){var o=e[n];if(o){var l=b(o,!1);0===n?l.classList.add("left"):2===n?l.classList.add("right"):2<n&&l.classList.add("inactive");t&&l.addEventListener("click",function(e){return function(){choice=e,t(a)}}(n)),r.appendChild(l)}}return r}function u(e){e.style.outline="5px solid LawnGreen"}function p(e,t){var a=parseInt(t);if(a==t&&(t=1<a?a:null),t){var r=createDiv("multiplier","x"+t);r.setAttribute("data-count",t);var n=createImg(W("cardAssets")+"multiplier.png","multiplier");e.appendChild(n),e.appendChild(r)}}function b(e,t,a,r,n,i,o){var l=createDiv("card");l.setAttribute("data-id",e.id),l.setAttribute("data-level",e.level);for(var s=e.runes,c=[],d={},u=0,h=s.length;u<h;u++){var f=s[u].id;c.push(s[u].id);var m=F.getRune(f);for(var g in m.stat_boost)"skill"==g&&(g=m.stat_boost.skill.id),d[g]=!0}var v=e.highlighted;if(v)for(u=0;u<v.length;u++){d[g=v[u]]=!0}l.setAttribute("data-runeids",c.join(","));var p=P.loadCard(e.id).picture;if(p){var b=document.createElement("i");0==p.indexOf("portrait_")?b.className="portrait portrait-"+p:b.className="sprite sprite-"+p,l.appendChild(b)}e.isCommander()&&l.classList.add("commander"),l.classList.add(B.names[e.type].toLowerCase());var k=createDiv("card-name",(void 0!==e.uid?"("+e.uid+") ":"")+e.name),_=createDiv("card-id","("+e.id+")");if(k.appendChild(_),l.appendChild(k),!e.isCommander()){if(0<=e.attack){if(a){e.isUnjammed()||l.classList.add("frozen");var y=createDiv("card-attack",e.adjustedAttack().toString());e.adjustedAttack()>e.attack?y.classList.add("increased"):e.adjustedAttack()<e.attack?y.classList.add("decreased"):d.attack&&y.classList.add("increased")}else y=createDiv("card-attack",e.attack.toString());l.appendChild(createImg(W("cardAssets")+"Attack.png","attack")),l.appendChild(y)}0<=e.cost&&(a?e.timer&&(l.appendChild(createDiv("delay",e.timer)),l.appendChild(createImg(W("cardAssets")+"Timer.png","timer"))):(l.appendChild(createDiv("delay",e.cost)),l.appendChild(createImg(W("cardAssets")+"Timer.png","timer"))))}if(0<=e.health){if(a){var A=createDiv("card-health",e.health_left.toString());e.health_left<e.health?A.classList.add("decreased"):d.health&&A.classList.add("increased")}else{A=createDiv("card-health",e.health.toString());d.health&&A.classList.add("increased")}l.appendChild(createImg(W("cardAssets")+"Health.png","health")),l.appendChild(A)}var I=createDiv("card-skills"),w=createDiv("card-skills-short");e.earlyActivationSkills&&H(e,I,w,e.earlyActivationSkills,a),H(e,I,w,e.skill,a),e.onDeathSkills&&H(e,I,w,e.onDeathSkills,a),function(t,a,r,n,i){Object.getOwnPropertyNames(SKILL_DATA).filter(function(e){return 0<=["passive","toggle"].indexOf(SKILL_DATA[e].type)}).forEach(function(e){!function(e,t,a,r,n,i){var o=r[n];if(o){var l={id:n,x:o,boosted:i[n]};e.appendChild(j(r,l,a)),e.appendChild(document.createElement("br")),t.appendChild(G(l.id))}}(t,a,n,r,e,i)});var e=r.flurry;e&&(t.appendChild(j(r,e,n)),t.appendChild(document.createElement("br")),a.appendChild(G(e.id)))}(I,w,e,a,d);var S,D,C=I.cloneNode(!0);if(C.className="card-skills-detailed",w.hasChildNodes()&&(t?(l.appendChild(w),l.appendChild(I)):l.appendChild(C)),l.appendChild(createDiv("faction")),a){var T=function(e){var t=[];if(e.enfeebled){var a=q("enfeeble",e.enfeebled);t.push(a)}if(e.marked){var a=q("enfeeble",e.marked);t.push(a)}if(e.nullified){var a=q("nullify",e.nullified);t.push(a)}if(e.poisoned){var a=q("poison",e.poisoned);t.push(a)}if(e.scorched&&e.scorched.amount){var a=q("burn",e.scorched.amount);t.push(a)}var r=[];if(e.enraged){var a=q("enrage",e.enraged);t.push(a)}if(e.protected){var a=q("protect",e.protected);r.push(a)}if(e.invisible){var a=q("evade",e.invisible);r.push(a)}var n=[];if(0<t.length){for(var i=createDiv("card-debuffs"),o=0,l=t.length;o<l;o++)i.appendChild(t[o]);n.push(i)}if(0<r.length){for(var s=createDiv("card-buffs"),o=0,l=r.length;o<l;o++)s.appendChild(r[o]);n.push(s)}return n}(e);if(0<T.length){l.appendChild(createDiv("hidden","..."));var $=createDiv("card-statuses");for(u=0;u<T.length;u++){var x=T[u];$.appendChild(x)}l.appendChild($)}}if(e.set){var L=(S=e.set,D=z[S],createImg(W("cardAssets")+D+".png"));L.className="set",l.appendChild(L)}var E=e.sub_type;if(E.length){var O=createDiv("subfaction");for(u=0;u<E.length;u++){var R=E[u];if(R){var M=V(R);O.appendChild(M)}}l.appendChild(O)}if(0<e.rarity){if(e.maxLevel>Number(e.rarity)+2)var N=createImg(W("cardAssets")+"Level_"+e.rarity+"_"+e.maxLevel+"_"+e.level+".png");else N=createImg(W("cardAssets")+"Level_"+e.rarity+"_"+e.level+".png");if(N.className="level",9999<e.id){var U="1"==e.id.toString()[0]?"Dualfuse":"Quadfuse";(U=createImg(W("cardAssets")+U+".png")).className="fusion",l.appendChild(U)}l.appendChild(N)}else if(1<e.maxLevel){(N=createImg(W("cardAssets")+e.maxLevel+"_"+e.level+".png")).className="level",l.appendChild(N)}return r&&l.addEventListener("click",function(){return r(l,o)}),n&&(l.oncontextmenu=function(){return n(l,o)}),i&&(l.onmouseover=function(){return i(l,o)}),l}function H(e,t,a,r,n){for(var i=0;i<r.length;i++){var o=r[i];t.appendChild(j(e,o,n,i)),t.appendChild(document.createElement("br")),a.appendChild(G(o.id))}}function j(e,t,a,r){var n=document.createElement("span");n.className="skill",n.appendChild(G(t.id));var i=v.isImbued(e,t.id,r),o=v.getEnhancement(e,t.id,t.x);i?n.classList.add("imbued"):(t.boosted||o)&&n.classList.add("increased"),t.all&&(n.innerHTML+=" All "),t.y&&n.appendChild(V(t.y)),t.s&&n.appendChild(G(t.s));var l=(0|t.x)+o;return l&&(n.innerHTML+=" "+l+" "),t.c&&(n.innerHTML+=t.c,a&&(n.innerHTML+=" ("+(t.countdown?t.countdown:"0")+")")),n}function G(e){var t=W("skills"),a=SKILL_DATA[e],r=createImg(t+=(a?a.icon:e)+".png");switch(e){case"weakenself":case"enlarge":r.classList.add("affect-self")}return r.title=a?a.name:e,r}function q(e,t){var a=document.createElement("span");return a.appendChild(G(e)),t&&(a.innerHTML+=t),a}function V(e){var t=B.names[e];return createImg(W("factions")+t+".png")}function W(e){return t+"res/"+e+"/"}var z={1e3:"Basic",1100:"Legacy",7e3:"Basic",2e3:"Reward",2100:"Reward",3e3:"Premium",4e3:"BoxOnly",5e3:"Champion",5100:"Champion",9999:"StoryElements"};CARD_GUI.clearCardSpace=function(){$("#cardSpace").empty()},CARD_GUI.clearDeckSpace=function(){document.getElementById("deck").innerHTML=""},CARD_GUI.draw_deck=function(e,t){var a=$("#deck");return a.children().remove(),a.append(r(e,t)),a},CARD_GUI.create_card_html=b,CARD_GUI.makeDeckHTML=r,CARD_GUI.makeCardListHTML=function(e,t,a){for(var r=createDiv("float-left"),n=0,i=e.deck.length;n<i;n++){var o=e.deck[n],l=b(g.byId(o),!1,!1,t,a,null,n);void 0!==o.index&&l.setAttribute("data-index",o.index),r.appendChild(l)}return r},CARD_GUI.draw_card_list=function(e,t,a,r,n,i){var o=s(e,t,null,null,n,i),l=$("#cardSpace");return l.empty(),l.append(o),l},CARD_GUI.draw_cards=function(e,t,a,r){var n=i(e,t,a,r);$("#cardSpace").children().remove().end().append(n)},CARD_GUI.doDrawField=i,CARD_GUI.draw_inventory=function(e){var t=s(e.deck),a=$("#deck");return a.children().remove(),a.append(s([e.commander])),a.append(t),a},CARD_GUI.draw_hand=d,CARD_GUI.createItemHTML=function(e,t,a){var r=createDiv("card item"),n=document.createElement("i");n.className="sprite sprite-Item",r.appendChild(n),a&&((a=createImg(W("items")+a+".png")).className="item-image",r.appendChild(a));var i=createDiv("card-name",e);return r.appendChild(i),r.classList.add("factionless"),r.appendChild(createDiv("faction")),p(r,t),r},CARD_GUI.addMult=p,CARD_GUI.addWeight=function(e,t){if(0<t){var a=createDiv("weight",(100*t).toFixed(2)+"%");a.setAttribute("data-count",t);var r=createImg(W("cardAssets")+"multiplier.png","weight");e.appendChild(r),e.appendChild(a)}},Object.defineProperties(CARD_GUI,{assetsRoot:{get:function(){return t},set:function(e){t=e}}})}(),$(document).ready(function(){var o=getTutorialScript(),e=$("<div></div>");function t(){storageAPI.shouldShowTutorial?a():i()}function a(){s=0,c();$("#tutorial").show()}$(document.body).append(e),e.load("templates/tutorial-overlay.html",null,function(){e.replaceWith(function(){return $(this).contents()}),$("#tutorial-show").prop("checked",storageAPI.shouldShowTutorial).change(function(e){storageAPI.setShowTutorial(this.checked)}),$("#help").click(a),$("#tutorial-close, #tutorial-skip").click(i),$("#tutorial-next").click(r),$("#tutorial-prev").click(n),"undefined"==typeof delayTutorial&&t()});var l,s=0;function r(){s++,c()}function n(){s--,c()}function i(){$("#tutorial").hide(),$("#tutorial-permahide").is(":checked")&&storageAPI.hideTutorial()}function c(){clearTimeout(l);var e=o[s],t=e.actions;if(t)for(var a=0;a<t.length;a++)t[a]();var r=e.msg,n=e.ui;if(n){var i=$(n);e.dialog&&(i=i.parent()),d(i),t&&(l=setTimeout(d,500,i)),r.indexOf(!1)&&(r=r.replace(/\{0\}/g,i.text()))}else $(".overlay-fog").width(0).height(0);$("#tutorialMessage").text(r),s<o.length-1?($("#tutorial-next").show(),$("#tutorial-close").hide()):($("#tutorial-next").hide(),$("#tutorial-close").show()),0<s?$("#tutorial-prev").removeClass("disabled"):$("#tutorial-prev").addClass("disabled")}function d(e){var t=e.offset();$(".overlay-fog").css({top:t.top-2+"px",left:t.left-2+"px"}).width(e.outerWidth()+4+"px").height(e.outerHeight()+4+"px")}window.showTutorial=a,window.checkTutorial=t}),function(){function e(){CARD_GUI.draw_cards(SIMULATOR.field)}SIM_CONTROLLER.end_sims_callback=function(){hideUI(),e()},SIM_CONTROLLER.stop_sims_callback=e}();var battle_sim=!0;
//# sourceMappingURL=practice.min.js.map